import{b as ne,a0 as ie,G as v,o as f,c as _,w as p,a as e,f as o,aM as k,q as fe,z as ve,I as J,Y as Ue,a5 as se,aD as Ae,i as ae,F as Re,ak as Ne,J as T,k as Y,e as D,t as E,R,V as ee,U as q,O as $e,N as Ie,S as te}from"./index-Boy7RURc.js";import{V as re,r as P}from"./VForm-DS0kAiBG.js";import{a as pe,b as Ve,c as ye}from"./VCard-CLg_0_q0.js";import{V as H,m as Oe,a as ue,e as Pe}from"./VTextField-2VV2Y3Ax.js";import{V as be}from"./VSwitch-BxHZfHYd.js";import{d as ge}from"./forwardRefs-DpLIx09u.js";import{V as Fe}from"./VSpacer-CMIrGfop.js";import{h as S,i as De}from"./index-D1ibh7w-.js";import{m as Te,a as oe,b as qe,c as je}from"./VChip-qls-6apb.js";import{u as ke}from"./tag-D_adDfUM.js";import{V as z}from"./VSelect-8OQrJhsc.js";import{V as Ge}from"./VCheckbox-DusztoEn.js";import{_ as de}from"./MenuItems-COSLslFB.js";import{V as Be}from"./VToolbar-COzDZIcY.js";import{V as Ee}from"./VDataTable-BX8DPycj.js";import{V as me}from"./VDialog-x9Cz3ROb.js";import{V as Le}from"./VAutocomplete-Dq2Ooir2.js";import{V as ce}from"./VMenu-Bob0AvfG.js";import{V as Me}from"./VTextarea-CiTmsnhN.js";import"./VAvatar-BgJfG1wg.js";import"./dimensions-BG_mhZfX.js";import"./ssrBoot-B_CqNgto.js";/* empty css              */import"./filter-Dlu2jFuL.js";const Je={__name:"FilterSetForm",emits:["close"],setup(V,{emit:U}){const{$gettext:m}=ne(),F=U,n=ie(),a=v({}),h=v(),y=v(!1);function l(){h.value.reset(),a.value={},F("close")}async function A(){const{valid:r}=await h.value.validate();if(r){y.value=!0;try{await k.createFilterSet(a.value),n.displayNotification({msg:m("Filter set created")}),l()}finally{y.value=!1}}}return(r,w)=>(f(),_(ye,{title:o(m)("Create a new filter set")},{default:p(()=>[e(pe,null,{default:p(()=>[e(re,{ref_key:"formRef",ref:h},{default:p(()=>[e(H,{modelValue:a.value.name,"onUpdate:modelValue":w[0]||(w[0]=C=>a.value.name=C),label:o(m)("Name"),variant:"outlined",rules:[o(P).required]},null,8,["modelValue","label","rules"]),e(be,{label:o(m)("Active"),modelValue:a.value.active,"onUpdate:modelValue":w[1]||(w[1]=C=>a.value.active=C),color:"primary"},null,8,["label","modelValue"])]),_:1},512)]),_:1}),e(ge),e(Ve,null,{default:p(()=>[e(Fe),e(S,{text:o(m)("Cancel"),variant:"plain",onClick:l},null,8,["text"]),e(S,{color:"primary",text:o(m)("Create"),onClick:A},null,8,["text"])]),_:1})]),_:1},8,["title"]))}},ze=fe({...Te({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),le=ve()({name:"VRadio",props:ze(),setup(V,U){let{slots:m}=U;return ke(()=>{const F=oe.filterProps(V);return e(oe,J(F,{class:["v-radio",V.class],style:V.style,type:"radio"}),m)}),{}}}),Ye=fe({height:{type:[Number,String],default:"auto"},...Oe(),...Ue(qe(),["multiple"]),trueIcon:{type:se,default:"$radioOn"},falseIcon:{type:se,default:"$radioOff"},type:{type:String,default:"radio"}},"VRadioGroup"),He=ve()({name:"VRadioGroup",inheritAttrs:!1,props:Ye(),emits:{"update:modelValue":V=>!0},setup(V,U){let{attrs:m,slots:F}=U;const n=Ae(),a=ae(()=>V.id||`radio-group-${n}`),h=Re(V,"modelValue");return ke(()=>{const[y,l]=Ne(m),A=ue.filterProps(V),r=oe.filterProps(V),w=F.label?F.label({label:V.label,props:{for:a.value}}):V.label;return e(ue,J({class:["v-radio-group",V.class],style:V.style},y,A,{modelValue:h.value,"onUpdate:modelValue":C=>h.value=C,id:a.value}),{...F,default:C=>{let{id:N,messagesId:I,isDisabled:$,isReadonly:x}=C;return e(T,null,[w&&e(Pe,{id:N.value},{default:()=>[w]}),e(je,J(r,{id:N.value,"aria-describedby":I.value,defaultsTarget:"VRadio",trueIcon:V.trueIcon,falseIcon:V.falseIcon,type:V.type,disabled:$.value,readonly:x.value,"aria-labelledby":w?N.value:void 0,multiple:!1},l,{modelValue:h.value,"onUpdate:modelValue":L=>h.value=L}),F)])}})}),{}}}),Ke={class:"bg-grey-lighten-4 rounded pa-3"},Qe={class:"mt-4 bg-grey-lighten-4 rounded pa-3"},We={class:"mx-2 d-flex flex-column flex-grow-1"},Xe={__name:"FilterForm",props:{filterSet:{type:String,default:null},filter:{type:Object,required:!1,default:null}},emits:["close"],setup(V,{emit:U}){const m=V,F=U,n=ie(),{$gettext:a}=ne(),h=v({}),y=v([]),l=v([]),A=v(),r=v(x()),w=v(!1),C=ae(()=>m.filter?a("Edit filter"):a("New filter")),N=ae(()=>m.filter?a("Update"):a("Create"));let I;Y(()=>m.filter,c=>{c?(r.value=JSON.parse(JSON.stringify(c)),I=c.name):r.value=x()},{immediate:!0});function $(){F("close"),r.value=x()}function x(){return{match_type:"anyof",conditions:[{}],actions:[{args:{}}]}}function L(c){for(const b of y.value)if(b.name===c)return b.operators;return[]}function K(c){for(const b of y.value)if(b.name===r.value.conditions[c].name){for(const s of b.operators)if(s.name===r.value.conditions[c].operator)return s.type==="string"?"text":"number"}}function Q(c){for(const b of l.value)if(b.name===c)return b.args;return[]}function W(){r.value.conditions.push({name:y.value[0].name,operator:y.value[0].operators[0].name})}function M(c){r.value.conditions.splice(c,1)}function O(){r.value.actions.push({name:l.value[0].name,args:{}})}function X(c){r.value.actions.splice(c,1)}async function Z(){const{valid:c}=await A.value.validate();if(!c)return;w.value=!0;let b;const s=JSON.parse(JSON.stringify(r.value));for(const g of s.actions)for(const[d,B]of Object.entries(g.args))typeof B=="boolean"&&!B&&delete g.args[d];try{m.filter?(await k.updateFilter(m.filterSet,I,s),b=a("Filter updated")):(await k.createFilter(m.filterSet,s),b=a("Filter added"))}catch(g){g.response.status===400&&g.response.data&&(h.value=g.response.data);return}finally{w.value=!1}n.displayNotification({msg:b}),$()}return k.getFilterConditionTemplates().then(c=>{y.value=c.data,m.filter||(r.value.conditions[0].name=y.value[0].name,r.value.conditions[0].operator=y.value[0].operators[0].name)}),k.getFilterActionTemplates().then(c=>{l.value=c.data,m.filter||(r.value.actions[0].name=l.value[0].name)}),(c,b)=>(f(),_(ye,{title:C.value},{default:p(()=>[e(pe,null,{default:p(()=>[e(re,{ref_key:"formRef",ref:A},{default:p(()=>[e(H,{modelValue:r.value.name,"onUpdate:modelValue":b[0]||(b[0]=s=>r.value.name=s),label:o(a)("Name"),variant:"outlined",density:"compact",rules:[o(P).required],"error-messages":h.value.name?h.value.name:[]},null,8,["modelValue","label","rules","error-messages"]),D("div",Ke,[D("h4",null,E(o(a)("Conditions")),1),e(He,{modelValue:r.value.match_type,"onUpdate:modelValue":b[1]||(b[1]=s=>r.value.match_type=s),color:"primary",inline:""},{default:p(()=>[e(le,{label:o(a)("All of the following"),value:"allof"},null,8,["label"]),e(le,{label:o(a)("Any of the following"),value:"anyof"},null,8,["label"]),e(le,{label:o(a)("All messages"),value:"all"},null,8,["label"])]),_:1},8,["modelValue"]),r.value.match_type!=="all"?(f(!0),R(T,{key:0},ee(r.value.conditions,(s,g)=>(f(),R("div",{key:`condition-${g}`,class:"d-flex align-start"},[e(z,{modelValue:s.name,"onUpdate:modelValue":d=>s.name=d,label:o(a)("Choose a header"),items:y.value,"item-title":"label","item-value":"name",variant:"outlined",density:"compact",rules:[o(P).required]},null,8,["modelValue","onUpdate:modelValue","label","items","rules"]),e(z,{modelValue:s.operator,"onUpdate:modelValue":d=>s.operator=d,label:o(a)("Choose an operator"),items:L(s.name),"item-title":"label","item-value":"name",variant:"outlined",class:"ml-2",density:"compact",rules:[o(P).required]},null,8,["modelValue","onUpdate:modelValue","label","items","rules"]),e(H,{modelValue:s.value,"onUpdate:modelValue":d=>s.value=d,label:o(a)("Value"),variant:"outlined",class:"ml-2",density:"compact",type:K(g),rules:[o(P).required]},null,8,["modelValue","onUpdate:modelValue","label","type","rules"]),g===0?(f(),_(S,{key:0,icon:"mdi-plus",variant:"text",title:o(a)("Add condition"),color:"primary",onClick:W},null,8,["title"])):(f(),_(S,{key:1,icon:"mdi-trash-can",variant:"text",title:o(a)("Remove condition"),color:"error",onClick:d=>M(g)},null,8,["title","onClick"]))]))),128)):q("",!0)]),D("div",Qe,[D("h4",null,E(o(a)("Actions")),1),(f(!0),R(T,null,ee(r.value.actions,(s,g)=>(f(),R("div",{key:`action-${g}`,class:"d-flex align-start mt-2"},[e(z,{modelValue:s.name,"onUpdate:modelValue":d=>s.name=d,label:o(a)("Choose an action"),items:l.value,"item-title":"label","item-value":"name",variant:"outlined",density:"compact",class:"flex-grow-0"},null,8,["modelValue","onUpdate:modelValue","label","items"]),D("div",We,[(f(!0),R(T,null,ee(Q(s.name),(d,B)=>(f(),R(T,{key:`arg-${g}-${B}`},[d.type==="list"?(f(),_(z,{key:0,modelValue:s.args[d.name],"onUpdate:modelValue":j=>s.args[d.name]=j,items:d.choices,"item-title":"label",density:"compact",variant:"outlined",rules:[o(P).required]},null,8,["modelValue","onUpdate:modelValue","items","rules"])):q("",!0),d.type==="string"?(f(),_(H,{key:1,modelValue:s.args[d.name],"onUpdate:modelValue":j=>s.args[d.name]=j,density:"compact",variant:"outlined",rules:[o(P).required]},null,8,["modelValue","onUpdate:modelValue","rules"])):q("",!0),d.type==="boolean"?(f(),_(Ge,{key:2,modelValue:s.args[d.name],"onUpdate:modelValue":j=>s.args[d.name]=j,label:d.label,color:"primary",value:d.value,density:"compact"},null,8,["modelValue","onUpdate:modelValue","label","value"])):q("",!0)],64))),128))]),g===0?(f(),_(S,{key:0,icon:"mdi-plus",variant:"text",title:o(a)("Add action"),color:"primary",onClick:O},null,8,["title"])):(f(),_(S,{key:1,icon:"mdi-trash-can",variant:"text",title:o(a)("Remove action"),color:"error",onClick:d=>X(g)},null,8,["title","onClick"]))]))),128))])]),_:1},512)]),_:1}),e(ge),e(Ve,null,{default:p(()=>[e(Fe),e(S,{text:o(a)("Cancel"),variant:"elevated",onClick:$},null,8,["text"]),e(S,{color:"primary",variant:"elevated",text:N.value,loading:w.value,onClick:Z},null,8,["text","loading"])]),_:1})]),_:1},8,["title"]))}},Ze={class:"pa-4"},et={class:"text-h6 font-weight-regular mb-4"},tt={key:0,class:"bg-white mt-4 pa-2"},lt={class:"d-flex align-center"},xt={__name:"FiltersView",setup(V){const U=$e(),m=Ie(),F=ie(),{$gettext:n}=ne(),a=v([]),h=v([]),y=v(""),l=v(),A=v(!1),r=v([]),w=v(),C=v(!1),N=v(!1),I=v(null),$=v(!1),x=v(!1),L=[{title:n("Name"),key:"name"},{title:n("Active"),key:"enabled"},{title:"",key:"filter_actions",align:"end"}];Y(l,t=>{t?(O(t.name),m.params.filterset!==t.name&&U.push({name:"AccountFilters",params:{filterset:t.name}})):U.push({name:"AccountFilters"})}),Y(C,t=>{t?k.downloadFilterSet(l.value.name).then(i=>{y.value=i.data}):O(l.value.name)}),Y(y,()=>{r.value.length&&(r.value=[])});function K(t){let i=t.name;return t.active&&(i+=" ("+n("active")+")"),i}function Q(){$.value=!1,M()}function W(){x.value=!1,I.value=null,O(l.value.name)}function M(){k.getFilterSets().then(t=>{if(a.value=t.data,!l.value&&m.params.filterset){for(const i of a.value)if(i.name===m.params.filterset){l.value=i;break}}})}function O(t){A.value=!0,k.getFilters(t).then(i=>{h.value=i.data,A.value=!1})}function X(t){I.value=t,x.value=!0}function Z(t){k.enableFilter(l.value.name,t.name).then(()=>{t.enabled=!0,F.displayNotification({msg:n("Filter enabled")})})}function c(t){k.disableFilter(l.value.name,t.name).then(()=>{t.enabled=!1,F.displayNotification({msg:n("Filter disabled")})})}function b(t){k.deleteFilter(l.value.name,t.name).then(()=>{F.displayNotification({msg:n("Filter removed")}),O(l.value.name)})}async function s(t){await k.moveFilterDown(l.value.name,t.name),O(l.value.name)}async function g(t){await k.moveFilterUp(l.value.name,t.name),O(l.value.name)}async function d(t){await k.activateFilterSet(t.name),F.displayNotification({msg:n("Filter set activated")})}async function B(t){await k.deleteFilterSet(t.name),F.displayNotification({msg:n("Filter set removed")}),l.value=null,M()}async function j(){const{valid:t}=await w.value.validate();if(!t)return;const i={content:y.value};N.value=!0;try{await k.saveFilterSet(l.value.name,i),F.displayNotification({msg:n("Filter set updated")})}catch(u){u.response.status===400&&u.response.data.content&&(r.value=u.response.data.content)}finally{N.value=!1}}async function he(t){const i=await k.downloadFilterSet(t.name),u=new Blob([i.data],{type:"text/plain"}),G=document.createElement("a");G.href=URL.createObjectURL(u),G.download=`${t.name}.txt`,G.click(),URL.revokeObjectURL(G.href)}const we=[{label:n("Edit"),icon:"mdi-circle-edit-outline",onClick:X},{label:n("Delete"),icon:"mdi-delete-outline",onClick:b,color:"red"}];function Ce(t,i){const u=[...we];return t.enabled?u.push({label:n("Disable"),icon:"mdi-stop",color:"red",onClick:c}):u.push({label:n("Enable"),icon:"mdi-check",color:"success",onClick:Z}),i!==h.value.length-1&&u.push({label:n("Move down"),icon:"mdi-arrow-down",onClick:s}),i!==0&&u.push({label:n("Move up"),icon:"mdi-arrow-up",onClick:g}),u}const Se=[{label:n("Download filter set"),icon:"mdi-download",onClick:he},{label:n("Delete filter set"),color:"error",icon:"mdi-trash-can",onClick:B}];function _e(){const t=[];return l.value.active||t.push({label:n("Activate filter set"),color:"success",icon:"mdi-check",onClick:d}),t.concat(Se)}return M(),(t,i)=>(f(),R(T,null,[D("div",Ze,[D("div",et,E(o(n)("Message filters")),1),e(Be,{dense:"",floating:"",color:"white"},{default:p(()=>[e(Le,{modelValue:l.value,"onUpdate:modelValue":i[0]||(i[0]=u=>l.value=u),label:o(n)("Select a filter set"),items:a.value,"item-title":K,"return-object":"",variant:"outlined","hide-details":"",class:"flex-grow-0",style:{width:"200px"},density:"compact"},null,8,["modelValue","label","items"]),e(S,{color:"primary",icon:"mdi-plus",size:"small",class:"mx-4",onClick:i[1]||(i[1]=u=>$.value=!0),title:o(n)("Add filter set")},null,8,["title"]),l.value?(f(),_(ce,{key:0},{activator:p(({props:u})=>[e(S,J({icon:"mdi-dots-vertical"},u,{size:"small",color:"default"}),null,16)]),default:p(()=>[e(de,{items:_e(),obj:l.value},null,8,["items","obj"])]),_:1})):q("",!0),l.value?(f(),_(be,{key:1,modelValue:C.value,"onUpdate:modelValue":i[2]||(i[2]=u=>C.value=u),label:o(n)("Raw mode"),color:"primary",class:"ml-4","hide-details":""},null,8,["modelValue","label"])):q("",!0)]),_:1}),l.value?(f(),R("div",tt,[C.value?(f(),R(T,{key:1},[e(re,{ref_key:"rawFormRef",ref:w},{default:p(()=>[e(Me,{modelValue:y.value,"onUpdate:modelValue":i[4]||(i[4]=u=>y.value=u),variant:"outlined","auto-grow":"",rules:[o(P).required],"error-messages":r.value},null,8,["modelValue","rules","error-messages"])]),_:1},512),e(S,{color:"success",onClick:j,loading:N.value,class:"mt-2"},{default:p(()=>[te(E(o(n)("Save")),1)]),_:1},8,["loading"])],64)):(f(),R(T,{key:0},[D("div",lt,[e(S,{color:"primary",title:o(n)("Add new filter"),onClick:i[3]||(i[3]=u=>x.value=!0),class:"mx-auto"},{default:p(()=>[e(De,{icon:"mdi-plus"}),te(" "+E(o(n)("Add")),1)]),_:1},8,["title"])]),e(Ee,{headers:L,items:h.value,loading:A.value},{"item.enabled":p(({item:u})=>[te(E(t.$yesno(u.enabled)),1)]),"item.filter_actions":p(({index:u,item:G})=>[e(ce,{"offset-y":""},{activator:p(({props:xe})=>[e(S,J({icon:"mdi-dots-horizontal",variant:"text"},xe),null,16)]),default:p(()=>[e(de,{items:Ce(G,u),obj:G},null,8,["items","obj"])]),_:2},1024)]),_:2},1032,["items","loading"])],64))])):q("",!0)]),e(me,{modelValue:$.value,"onUpdate:modelValue":i[5]||(i[5]=u=>$.value=u),"max-width":"600"},{default:p(()=>[e(Je,{onClose:Q})]),_:1},8,["modelValue"]),e(me,{modelValue:x.value,"onUpdate:modelValue":i[6]||(i[6]=u=>x.value=u),"max-width":"800"},{default:p(()=>[l.value?(f(),_(Xe,{key:0,"filter-set":l.value.name,filter:I.value,onClose:W},null,8,["filter-set","filter"])):q("",!0)]),_:1},8,["modelValue"])],64))}};export{xt as default};
