{"version":3,"file":"js/module_users.personal_data.90d7f0b9.bundle.js","mappings":"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","sources":["webpack:///indico/modules/users/client/js/PersonalDataForm.jsx"],"sourcesContent":["// This file is part of Indico.\n// Copyright (C) 2002 - 2024 CERN\n//\n// Indico is free software; you can redistribute it and/or\n// modify it under the terms of the MIT License; see the\n// LICENSE file for more details.\n\nimport emailsURL from 'indico-url:users.user_emails';\nimport saveURL from 'indico-url:users.user_profile_update';\n\nimport _ from 'lodash';\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport {Field, Form as FinalForm} from 'react-final-form';\nimport {Form} from 'semantic-ui-react';\n\nimport {\n  SyncedFinalAffiliationDropdown,\n  SyncedFinalInput,\n  SyncedFinalTextArea,\n} from 'indico/react/components/syncedInputs';\nimport {\n  FinalDropdown,\n  FinalSubmitButton,\n  getChangedValues,\n  handleSubmitError,\n  parsers as p,\n} from 'indico/react/forms';\nimport {Translate, Param} from 'indico/react/i18n';\nimport {indicoAxios} from 'indico/utils/axios';\nimport {renderPluginComponents} from 'indico/utils/plugins';\n\nfunction PersonalDataForm({\n  userId,\n  userValues,\n  currentAffiliation,\n  titles,\n  syncedValues,\n  lockedFields,\n  lockedFieldMessage,\n  hasPredefinedAffiliations,\n}) {\n  const userIdArgs = userId !== null ? {user_id: userId} : {};\n\n  const handleSubmit = async (data, form) => {\n    const changedValues = getChangedValues(data, form);\n    if (!hasPredefinedAffiliations) {\n      // value.affiliation is already there and used\n      delete changedValues.affiliation_data;\n    } else if (changedValues.affiliation_data) {\n      changedValues.affiliation = changedValues.affiliation_data.text.trim();\n      changedValues.affiliation_id = changedValues.affiliation_data.id;\n      delete changedValues.affiliation_data;\n    }\n    try {\n      await indicoAxios.patch(saveURL(userIdArgs), changedValues);\n    } catch (e) {\n      return handleSubmitError(e);\n    }\n    location.reload();\n    // never finish submitting to avoid fields being re-enabled\n    await new Promise(() => {});\n  };\n\n  const titleOptions = titles.map(t => ({key: t.name, value: t.name, text: t.title}));\n\n  return (\n    <div>\n      <FinalForm\n        onSubmit={handleSubmit}\n        initialValues={userValues}\n        initialValuesEqual={_.isEqual}\n        subscription={{}}\n      >\n        {fprops => (\n          <Form onSubmit={fprops.handleSubmit}>\n            <Field name=\"synced_fields\" isEqual={_.isEqual} render={() => null} />\n            <FinalDropdown\n              name=\"title\"\n              options={titleOptions}\n              selection\n              parse={p.nullIfEmpty}\n              label={Translate.string('Title', 'Salutation')}\n              placeholder={Translate.string('None')}\n            />\n            <Form.Group widths=\"equal\">\n              <SyncedFinalInput\n                name=\"first_name\"\n                label={Translate.string('First name')}\n                required\n                syncedValues={syncedValues}\n                lockedFields={lockedFields}\n                lockedFieldMessage={lockedFieldMessage}\n              />\n              <SyncedFinalInput\n                name=\"last_name\"\n                label={Translate.string('Last name')}\n                required\n                syncedValues={syncedValues}\n                lockedFields={lockedFields}\n                lockedFieldMessage={lockedFieldMessage}\n              />\n            </Form.Group>\n            {hasPredefinedAffiliations ? (\n              <SyncedFinalAffiliationDropdown\n                name=\"affiliation_data\"\n                syncName=\"affiliation\"\n                currentAffiliation={currentAffiliation}\n                syncedValues={syncedValues}\n                lockedFields={lockedFields}\n                lockedFieldMessage={lockedFieldMessage}\n              />\n            ) : (\n              <SyncedFinalInput\n                name=\"affiliation\"\n                label={Translate.string('Affiliation')}\n                syncedValues={syncedValues}\n                lockedFields={lockedFields}\n                lockedFieldMessage={lockedFieldMessage}\n              />\n            )}\n            <SyncedFinalTextArea\n              name=\"address\"\n              label={Translate.string('Address')}\n              syncedValues={syncedValues}\n              lockedFields={lockedFields}\n              lockedFieldMessage={lockedFieldMessage}\n            />\n            <SyncedFinalInput\n              name=\"phone\"\n              label={Translate.string('Phone number')}\n              syncedValues={syncedValues}\n              lockedFields={lockedFields}\n              lockedFieldMessage={lockedFieldMessage}\n            />\n            <SyncedFinalInput\n              name=\"email\"\n              label={Translate.string('Email address')}\n              syncedValues={syncedValues}\n              lockedFields={lockedFields}\n              lockedFieldMessage={lockedFieldMessage}\n              readOnly\n            >\n              <Translate>\n                You can manage your email addresses{' '}\n                <Param name=\"link\" wrapper={<a href={emailsURL(userIdArgs)} />}>\n                  here\n                </Param>\n                .\n              </Translate>\n            </SyncedFinalInput>\n            {renderPluginComponents('user-personal-data-form-inputs', {\n              userValues,\n              syncedValues,\n              lockedFields,\n              lockedFieldMessage,\n            })}\n            <FinalSubmitButton label={Translate.string('Save changes')} className=\"submit-button\" />\n          </Form>\n        )}\n      </FinalForm>\n    </div>\n  );\n}\n\nPersonalDataForm.propTypes = {\n  userId: PropTypes.number,\n  userValues: PropTypes.object.isRequired,\n  currentAffiliation: PropTypes.object,\n  titles: PropTypes.arrayOf(\n    PropTypes.shape({\n      name: PropTypes.string.isRequired,\n      title: PropTypes.string.isRequired,\n    })\n  ).isRequired,\n  syncedValues: PropTypes.objectOf(PropTypes.string).isRequired,\n  lockedFields: PropTypes.arrayOf(PropTypes.string).isRequired,\n  lockedFieldMessage: PropTypes.string.isRequired,\n  hasPredefinedAffiliations: PropTypes.bool.isRequired,\n};\n\nPersonalDataForm.defaultProps = {\n  userId: null,\n  currentAffiliation: null,\n};\n\nwindow.setupPersonalDataForm = function setupPersonalDataForm(\n  userId,\n  userValues,\n  currentAffiliation,\n  titles,\n  syncedValues,\n  lockedFields,\n  lockedFieldMessage,\n  hasPredefinedAffiliations\n) {\n  document.addEventListener('DOMContentLoaded', () => {\n    ReactDOM.render(\n      <PersonalDataForm\n        userId={userId}\n        userValues={userValues}\n        currentAffiliation={currentAffiliation}\n        titles={titles}\n        syncedValues={syncedValues}\n        lockedFields={lockedFields}\n        lockedFieldMessage={lockedFieldMessage}\n        hasPredefinedAffiliations={hasPredefinedAffiliations}\n      />,\n      document.querySelector('#personal-details-form-container')\n    );\n  });\n};\n"],"names":["emailsURL","_buildFlaskURL","bind","endpoint","rules","args","converters","user_id","defaults","trace","data","isDynamic","saveURL","PersonalDataForm","userId","userValues","currentAffiliation","titles","syncedValues","lockedFields","lockedFieldMessage","hasPredefinedAffiliations","userIdArgs","titleOptions","map","t","key","name","value","text","title","React","FinalForm","onSubmit","async","form","changedValues","getChangedValues","affiliation_data","affiliation","trim","affiliation_id","id","indicoAxios","patch","e","handleSubmitError","location","reload","Promise","initialValues","initialValuesEqual","_","subscription","fprops","Form","handleSubmit","Field","isEqual","render","FinalDropdown","options","selection","parse","p","nullIfEmpty","label","Translate","string","placeholder","Group","widths","SyncedFinalInput","required","SyncedFinalAffiliationDropdown","syncName","SyncedFinalTextArea","readOnly","Param","wrapper","href","renderPluginComponents","FinalSubmitButton","className","propTypes","PropTypes","isRequired","defaultProps","window","setupPersonalDataForm","document","addEventListener","ReactDOM","querySelector"],"sourceRoot":""}