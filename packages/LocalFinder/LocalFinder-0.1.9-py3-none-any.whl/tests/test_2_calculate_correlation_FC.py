import unittest
import argparse
import os
from LocalFinder.commands.calculate_correlation_FC import main as calc_corr_main
import tempfile

class TestCalculateCorrelationFC(unittest.TestCase):
    def test_calculate_correlation_FC(self):
        # Input files generated by test_bin_tracks.py
        track1 = 'tests/data_bin_tracks/E071-H3K4me1.pval.signal.chr20.binSize1000000.bedgraph'
        track2 = 'tests/data_bin_tracks/E100-H3K4me1.pval.signal.chr20.binSize1000000.bedgraph'
        output_dir = 'tests/data_calculate_correlation_FC'  # Output directory in tests/data

        args = argparse.Namespace(
            track1=track1,
            track2=track2,
            method='localPearson_and_FC',
            method_params='{}',
            bin_number_of_window=11,
            step=1,
            output_dir=output_dir,
            chroms=['chr20']
        )

        # Run the command
        calc_corr_main(args)

        # Check that output files exist
        self.assertTrue(os.path.exists(os.path.join(output_dir, 'tracks_pearson.bedgraph')))
        self.assertTrue(os.path.exists(os.path.join(output_dir, 'tracks_log_Wald_pValue.bedgraph')))

    # @classmethod
    # def tearDownClass(cls):
    #     # Remove the generated output files after tests
    #     files_to_remove = [
    #         'tests/data/tracks_pearson.bedgraph',
    #         'tests/data/tracks_log_Wald_pValue.bedgraph'
    #     ]
    #     for file_path in files_to_remove:
    #         if os.path.exists(file_path):
    #             os.remove(file_path)

if __name__ == '__main__':
    unittest.main()
