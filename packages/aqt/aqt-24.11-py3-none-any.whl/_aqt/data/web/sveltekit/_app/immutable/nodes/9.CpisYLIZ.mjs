var jt=Object.defineProperty;var At=(a,t,e)=>t in a?jt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var N=(a,t,e)=>At(a,typeof t!="symbol"?t+"":t,e);import{o as kt,p as Ft,q as Ht,r as Lt,u as Gt,C as Q,v as vt,w as Nt,s as Vt,d as Ut}from"../chunks/backend.AWOyeTAw.mjs";import{av as zt,aw as bt,ax as wt,ay as Wt,az as qt,aA as Bt,aB as Kt,aC as Yt,aD as Jt,aE as Qt,aF as Xt,aG as Zt,aH as te,aI as ee,aJ as ae,aK as le,aL as se,aM as oe,aN as re,aO as Ct,aP as ie,aQ as ne,aR as ue,aS as de,aT as ce,aU as pe,aV as $e,aW as me,aX as ge,aY as ve,K as It}from"../chunks/runtime-require.B9u3s4Mi.mjs";import{w as ct,r as Ot}from"../chunks/index.BB25h7Qo.mjs";import{c as et}from"../chunks/cloneDeep.D7QE-BLU.mjs";import{i as dt,S as fe}from"../chunks/Select.B1NjCE1_.mjs";import{a as $,d as D,F as A,t as U,r as T,s as d,D as ht,e as at}from"../chunks/disclose-version.CXWUuFGG.mjs";import{p as q,l as he,a as ye,t as E,g as y,b as B,m as J,s as rt,N as Pt,E as C,a0 as S,ag as V}from"../chunks/runtime.BJSnJeWl.mjs";import{i as K}from"../chunks/lifecycle.DW1_rEFA.mjs";import{p as M,i as yt}from"../chunks/props.fkJSEmZ6.mjs";import{R as ot}from"../chunks/Row.OQ_EW2O_.mjs";import{I as be}from"../chunks/ImportPage.O1UBRZFH.mjs";import{a as _e}from"../chunks/await.BrCVEzOe.mjs";import{e as pt,i as $t}from"../chunks/theme.BMK9KvBa.mjs";import{s as it,m as z,a as j,b as xt}from"../chunks/store.CAPRemx4.mjs";import{T as _t}from"../chunks/TitledContainer.CoHyBpMI.mjs";import{s as R}from"../chunks/render.CQvFnAiW.mjs";import{c as X}from"../chunks/Container.C09jAWYp.mjs";import{C as mt}from"../chunks/Col.BQP6lpt8.mjs";import{H as G,E as st,a as W,S as ke,b as Et,C as Ne,R as Ce}from"../chunks/EnumSelectorRow.CB7WI00X.mjs";import{T as Ie}from"../chunks/TagEditor.DXDzFiWM.mjs";function Tt(){}function Y(a){return a.notetype.case==="globalNotetype"?a.notetype.value:null}function ft(a){return a.deck.case==="deckId"?a.deck.value:null}class Oe{constructor(t,e,s,l){N(this,"path");N(this,"deckNameIds");N(this,"notetypeNameIds");N(this,"defaultDelimiter");N(this,"defaultIsHtml");N(this,"defaultNotetypeId");N(this,"defaultDeckId");N(this,"metadata");N(this,"globalNotetype");N(this,"deckId");N(this,"fieldNames");N(this,"columnOptions");N(this,"lastMetadata");N(this,"lastGlobalNotetype");N(this,"lastDeckId");N(this,"fieldNamesSetter",Tt);N(this,"columnOptionsSetter",Tt);var r;this.path=t,this.deckNameIds=s.entries,this.notetypeNameIds=e.entries,this.lastMetadata=et(l),this.metadata=ct(l),this.metadata.subscribe(this.onMetadataChanged.bind(this));const o=Y(l);this.lastGlobalNotetype=et(Y(l)),this.globalNotetype=ct(et(o)),this.globalNotetype.subscribe(this.onGlobalNotetypeChanged.bind(this)),this.lastDeckId=ft(l),this.deckId=ct(ft(l)),this.deckId.subscribe(this.onDeckIdChanged.bind(this)),this.fieldNames=Ot(o===null?Promise.resolve([]):kt({ntid:o.id}).then(i=>i.vals),i=>{this.fieldNamesSetter=i}),this.columnOptions=Ot(St(l),i=>{this.columnOptionsSetter=i}),this.defaultDelimiter=l.delimiter,this.defaultIsHtml=l.isHtml,this.defaultNotetypeId=((r=this.lastGlobalNotetype)==null?void 0:r.id)||null,this.defaultDeckId=this.lastDeckId}doImport(){return Ft({path:this.path,metadata:{...this.lastMetadata,preview:[]}},{alertOnError:!1})}async onMetadataChanged(t){var l,o,r;if(dt(t,this.lastMetadata))return;const e=this.shouldRefetchMetadata(t);e&&(t=await Ht({path:this.path,delimiter:t.delimiter,notetypeId:(l=Y(t))==null?void 0:l.id,deckId:(o=ft(t))!=null?o:void 0,isHtml:t.isHtml}));const s=Y(t);this.globalNotetype.set(s),s!==null&&s.id!==((r=Y(this.lastMetadata))==null?void 0:r.id)&&this.fieldNamesSetter(kt({ntid:s.id}).then(i=>i.vals)),this.shouldRebuildColumnOptions(t)&&this.columnOptionsSetter(St(t)),this.lastMetadata=et(t),e&&this.metadata.set(t)}shouldRefetchMetadata(t){var e,s;return t.delimiter!==this.lastMetadata.delimiter||t.isHtml!==this.lastMetadata.isHtml||((e=Y(t))==null?void 0:e.id)!==((s=Y(this.lastMetadata))==null?void 0:s.id)}shouldRebuildColumnOptions(t){return!dt(t.columnLabels,this.lastMetadata.columnLabels)||!dt(t.preview[0],this.lastMetadata.preview[0])}onGlobalNotetypeChanged(t){dt(t,this.lastGlobalNotetype)||(this.lastGlobalNotetype=et(t),t!==null&&this.metadata.update(e=>(e.notetype.value=t,e)))}onDeckIdChanged(t){t!==this.lastDeckId&&(this.lastDeckId=t,t!==null&&this.metadata.update(e=>(e.deck.value=t,e)))}}function St(a){const t=Te(a),e=Pe(a);return[{label:zt(),value:0,disabled:!1}].concat(a.columnLabels.map((s,l)=>(l+=1,l===t?lt(bt(),!0,l):l===e?lt(wt(),!0,l):l===a.guidColumn?lt("GUID",!0,l):s===""?lt(a.preview[0].vals[l-1],!1,l,!0):lt(s,!1,l))))}function lt(a,t,e,s){return{label:a?`${e}: ${a}`:e.toString(),shortLabel:s?e.toString():void 0,value:e,disabled:t}}function Pe(a){return a.deck.case==="deckColumn"?a.deck.value:null}function Te(a){return a.notetype.case==="notetypeColumn"?a.notetype.value:null}const Se=async({params:a})=>{const[t,e,s]=await Promise.all([Lt({}),Gt({skipEmptyDefault:!1,includeFiltered:!1}),Ht({path:a.path},{alertOnError:!1})]);return{state:new Oe(a.path,t,e,s)}},fa=Object.freeze(Object.defineProperty({__proto__:null,load:Se},Symbol.toStringTag,{value:"Module"}));var Me=D('<div style="display: contents"><!></div> <div style="display: contents"><!></div>',1),De=D('<div style="display: contents"><!></div>',1);function Mt(a,t){q(t,!1);const e=J();let s=M(t,"label"),l=M(t,"columnOptions"),o=M(t,"value",4);he(()=>(Pt(l()),Pt(o())),()=>{var g;rt(e,(g=l().find(c=>c.value===o()))==null?void 0:g.label)}),ye(),K();var r=De(),i=A(r);X(i,()=>({"--cols":2})),ot(i.lastChild,{children:(g,c)=>{var n=Me(),P=A(n);X(P,()=>({"--col-size":1})),mt(P.lastChild,{children:(b,m)=>{var u=U();E(()=>R(u,s())),$(b,u)},$$slots:{default:!0},$$legacy:!0}),T(P);var h=d(d(P,!0));X(h,()=>({"--col-size":1})),mt(h.lastChild,{children:(b,m)=>{fe(b,{get value(){return o()},set value(u){o(u)},get label(){return y(e)},get list(){return l()},parser:u=>({content:u.label,value:u.value,disabled:u.disabled}),$$legacy:!0})},$$slots:{default:!0},$$legacy:!0}),T(h),$(g,n)},$$slots:{default:!0},$$legacy:!0}),T(i),$(a,r),B()}var He=D("<!> <!>",1);function we(a,t){q(t,!1);const e=it(),s=()=>j(c,"$globalNotetype",e),l=()=>j(n,"$fieldNamesPromise",e),o=()=>j(P,"$columnOptions",e),r=()=>j(g,"$metadata",e);let i=M(t,"state");const g=i().metadata,c=i().globalNotetype,n=i().fieldNames,P=i().columnOptions;K();var h=S(()=>Wt());_t(a,{get title(){return y(h)},children:(b,m)=>{var u=He(),_=A(u);yt(_,()=>s()!==null,p=>{var H=ht(),F=A(H);_e(F,l,null,(Z,L)=>{var nt=ht(),ut=A(nt);pt(ut,1,()=>y(L),$t,(gt,v,w)=>{var f=S(()=>V(w)===0?o().slice(1):o());Mt(gt,{get label(){return V(v)},get columnOptions(){return y(f)},get value(){return s().fieldColumns[V(w)]},set value(x){z(c,C(s).fieldColumns[V(w)]=x,C(s))},$$legacy:!0})}),$(Z,nt)}),$(p,H)});var I=d(d(_,!0)),k=S(()=>qt());Mt(I,{get label(){return y(k)},get columnOptions(){return o()},get value(){return r().tagsColumn},set value(p){z(g,C(r).tagsColumn=p,C(r))},$$legacy:!0}),$(b,u)},$$slots:{default:!0},$$legacy:!0}),B()}function xe(){return[{label:Bt(),value:Q.TAB},{label:Kt(),value:Q.PIPE},{label:Yt(),value:Q.SEMICOLON},{label:Jt(),value:Q.COLON},{label:Qt(),value:Q.COMMA},{label:Xt(),value:Q.SPACE}]}function Ee(){return[{label:Zt(),value:vt.UPDATE},{label:te(),value:vt.PRESERVE},{label:ee(),value:vt.DUPLICATE}]}function Re(){return[{label:bt(),value:Nt.NOTETYPE},{label:ae(),value:Nt.NOTETYPE_AND_DECK}]}var je=D('<th class="svelte-13c6kdp"> </th>'),Ae=D('<td class="svelte-13c6kdp"> </td>'),Fe=D('<tr class="svelte-13c6kdp"></tr>'),Le=D('<div class="outer svelte-13c6kdp"><table class="preview svelte-13c6kdp"><thead><tr class="svelte-13c6kdp"></tr></thead><tbody></tbody></table></div>');function Ge(a,t){q(t,!1);const e=it(),s=()=>j(y(i),"$columnOptions",e),l=()=>j(y(r),"$metadata",e);let o=M(t,"state");const r=J(o().metadata),i=J(o().columnOptions);K();var g=Le(),c=at(g),n=at(c),P=at(n);pt(P,9,()=>s().slice(1),$t,(b,m,u)=>{let _=()=>V(V(m)).label,I=()=>V(V(m)).shortLabel;var k=je(),p=at(k);T(k),E(()=>R(p,I()||_())),$(b,k)}),T(P),T(n);var h=d(n);pt(h,9,()=>l().preview,$t,(b,m,u)=>{var _=Fe();pt(_,9,()=>V(m).vals,$t,(I,k,p)=>{var H=Ae(),F=at(H);T(H),E(()=>R(F,V(k))),$(I,H)}),T(_),$(b,_)}),T(h),T(c),T(g),$(a,g),B()}var Ve=D("<!> <!> <!>",1);function Ue(a,t){q(t,!1);const e=it(),s=()=>j(o,"$metadata",e);let l=M(t,"state");const o=l().metadata,r={delimiter:{title:le(),help:se(),url:G.TextImporting.root},isHtml:{title:oe(),help:re(),url:G.TextImporting.html}},i=Object.values(r);let g=J(),c=J();function n(h){y(g).show(),y(c).to(h)}K();var P=S(()=>Ct());_t(a,{get title(){return y(P)},children:(h,b)=>{var m=Ve(),u=A(m),_=S(xe);st(u,{get value(){return s().delimiter},set value(p){z(o,C(s).delimiter=p,C(s))},get defaultValue(){return l().defaultDelimiter},get choices(){return y(_)},get disabled(){return s().forceDelimiter},children:(p,H)=>{W(p,{$$events:{click:()=>n(Object.keys(r).indexOf("delimiter"))},children:(F,Z)=>{var L=U();E(()=>R(L,r.delimiter.title)),$(F,L)},$$slots:{default:!0},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0});var I=d(d(u,!0));ke(I,{get value(){return s().isHtml},set value(p){z(o,C(s).isHtml=p,C(s))},get defaultValue(){return l().defaultIsHtml},get disabled(){return s().forceIsHtml},children:(p,H)=>{W(p,{$$events:{click:()=>n(Object.keys(r).indexOf("isHtml"))},children:(F,Z)=>{var L=U();E(()=>R(L,r.isHtml.title)),$(F,L)},$$slots:{default:!0},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0});var k=d(d(I,!0));Ge(k,{get state(){return l()},$$legacy:!0}),$(h,m)},$$slots:{default:!0,tooltip:(h,b)=>{var m=S(()=>Ct());Et(h,{get title(){return y(m)},get url(){return G.TextImporting.root},slot:"tooltip",helpSections:i,$$events:{mount:u=>{rt(g,u.detail.modal),rt(c,u.detail.carousel)}},$$legacy:!0})}},$$legacy:!0}),B()}var ze=D('<div style="display: contents"><!></div> <div style="display: contents"><!></div>',1),We=D('<div style="display: contents"><!></div>',1);function Dt(a,t){q(t,!1);const e=it(),s=()=>j(i,"$tagsWritable",e);let l=M(t,"tags",4),o=M(t,"keyCombination",0,void 0),r=M(t,"breakpoint",0,"md");const i=ct(l());K();var g=We(),c=A(g);X(c,()=>({"--cols":13})),ot(c.lastChild,{children:(n,P)=>{var h=ze(),b=A(h);X(b,()=>({"--col-size":7})),mt(b.lastChild,{get breakpoint(){return r()},children:(u,_)=>{var I=ht(),k=A(I);Vt(k,Ut(t),{}),$(u,I)},$$slots:{default:!0},$$legacy:!0}),T(b);var m=d(d(b,!0));X(m,()=>({"--col-size":6})),mt(m.lastChild,{get breakpoint(){return r()},children:(u,_)=>{Ne(u,{children:(I,k)=>{Ie(I,{tags:i,get keyCombination(){return o()},$$events:{tagsupdate:({detail:p})=>l(p.tags)},$$legacy:!0})},$$slots:{default:!0,revert:(I,k)=>{Ce(I,{slot:"revert",get value(){return s()},set value(p){xt(i,p)},defaultValue:[],$$legacy:!0})}},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0}),T(m),$(n,h)},$$slots:{default:!0},$$legacy:!0}),T(c),$(a,g),B()}var qe=D("<!> <!> <!> <!> <!> <!>",1);function Be(a,t){q(t,!1);const e=it(),s=()=>j(g,"$globalNotetype",e),l=()=>j(c,"$deckId",e),o=()=>j(i,"$metadata",e);let r=M(t,"state");const i=r().metadata,g=r().globalNotetype,c=r().deckId,n={notetype:{title:bt(),help:ie(),url:G.TextImporting.root},deck:{title:wt(),help:ne(),url:G.TextImporting.root},dupeResolution:{title:ue(),help:de(),url:G.TextImporting.updating},matchScope:{title:ce(),help:pe(),url:G.TextImporting.updating},globalTags:{title:$e(),help:me(),url:G.TextImporting.root},updatedTags:{title:ge(),help:ve(),url:G.TextImporting.root}},P=Object.values(n);let h=J(),b=J();function m(_){y(h).show(),y(b).to(_)}K();var u=S(()=>It());_t(a,{get title(){return y(u)},children:(_,I)=>{var k=qe(),p=A(k);yt(p,()=>s()!==null,v=>{var w=S(()=>r().notetypeNameIds.map(({id:f,name:x})=>({label:x,value:f})));st(v,{get value(){return s().id},set value(f){z(g,C(s).id=f,C(s))},get defaultValue(){return r().defaultNotetypeId},get choices(){return y(w)},children:(f,x)=>{W(f,{$$events:{click:()=>m(Object.keys(n).indexOf("notetype"))},children:(O,Rt)=>{var tt=U();E(()=>R(tt,n.notetype.title)),$(O,tt)},$$slots:{default:!0},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0})});var H=d(d(p,!0));yt(H,()=>l()!==null,v=>{var w=S(()=>r().deckNameIds.map(({id:f,name:x})=>({label:x,value:f})));st(v,{get value(){return l()},set value(f){xt(c,f)},get defaultValue(){return r().defaultDeckId},get choices(){return y(w)},children:(f,x)=>{W(f,{$$events:{click:()=>m(Object.keys(n).indexOf("deck"))},children:(O,Rt)=>{var tt=U();E(()=>R(tt,n.deck.title)),$(O,tt)},$$slots:{default:!0},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0})});var F=d(d(H,!0)),Z=S(Ee);st(F,{get value(){return o().dupeResolution},set value(v){z(i,C(o).dupeResolution=v,C(o))},defaultValue:0,get choices(){return y(Z)},children:(v,w)=>{W(v,{$$events:{click:()=>m(Object.keys(n).indexOf("dupeResolution"))},children:(f,x)=>{var O=U();E(()=>R(O,n.dupeResolution.title)),$(f,O)},$$slots:{default:!0},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0});var L=d(d(F,!0)),nt=S(Re);st(L,{get value(){return o().matchScope},set value(v){z(i,C(o).matchScope=v,C(o))},defaultValue:0,get choices(){return y(nt)},children:(v,w)=>{W(v,{$$events:{click:()=>m(Object.keys(n).indexOf("matchScope"))},children:(f,x)=>{var O=U();E(()=>R(O,n.matchScope.title)),$(f,O)},$$slots:{default:!0},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0});var ut=d(d(L,!0));Dt(ut,{get tags(){return o().globalTags},set tags(v){z(i,C(o).globalTags=v,C(o))},keyCombination:"Control+T",children:(v,w)=>{W(v,{$$events:{click:()=>m(Object.keys(n).indexOf("globalTags"))},children:(f,x)=>{var O=U();E(()=>R(O,n.globalTags.title)),$(f,O)},$$slots:{default:!0},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0});var gt=d(d(ut,!0));Dt(gt,{get tags(){return o().updatedTags},set tags(v){z(i,C(o).updatedTags=v,C(o))},keyCombination:"Control+Shift+T",children:(v,w)=>{W(v,{$$events:{click:()=>m(Object.keys(n).indexOf("updatedTags"))},children:(f,x)=>{var O=U();E(()=>R(O,n.updatedTags.title)),$(f,O)},$$slots:{default:!0},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0}),$(_,k)},$$slots:{default:!0,tooltip:(_,I)=>{var k=S(()=>It());Et(_,{get title(){return y(k)},get url(){return G.TextImporting.root},slot:"tooltip",helpSections:P,$$events:{mount:p=>{rt(h,p.detail.modal),rt(b,p.detail.carousel)}},$$legacy:!0})}},$$legacy:!0}),B()}var Ke=D("<!> <!> <!>",1);function Ye(a,t){q(t,!1);let e=M(t,"state");K(),be(a,{get path(){return e().path},get importer(){return e()},children:(s,l)=>{var o=Ke(),r=A(o);ot(r,{children:(c,n)=>{Ue(c,{get state(){return e()},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0});var i=d(d(r,!0));ot(i,{children:(c,n)=>{Be(c,{get state(){return e()},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0});var g=d(d(i,!0));ot(g,{children:(c,n)=>{we(c,{get state(){return e()},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0}),$(s,o)},$$slots:{default:!0},$$legacy:!0}),B()}function ha(a,t){q(t,!1);let e=M(t,"data");K(),Ye(a,{get state(){return e().state},$$legacy:!0}),B()}export{ha as component,fa as universal};
