import{n as Ie,R as q}from"../chunks/backend.AWOyeTAw.mjs";import{a as L,d as F,r as n,e as v,s,D as Re,F as ce,M as je}from"../chunks/disclose-version.CXWUuFGG.mjs";import{p as U,t as h,b as X,l as fe,a as ge,g as A,m as pe,s as be,N as _e,ag as E}from"../chunks/runtime.BJSnJeWl.mjs";import{i as Z}from"../chunks/lifecycle.DW1_rEFA.mjs";import{p as K,i as J}from"../chunks/props.fkJSEmZ6.mjs";import{s as De,b as le,a as Le}from"../chunks/store.CAPRemx4.mjs";import{p as Pe}from"../chunks/stores.Bozhusqs.mjs";import{c as Ke,C as Be}from"../chunks/Container.C09jAWYp.mjs";import{R as ue}from"../chunks/Row.OQ_EW2O_.mjs";import{s as x}from"../chunks/render.CQvFnAiW.mjs";import{V as Oe,W as We,X as Ye,Y as Ge,Z as ze,_ as Ve,$ as Fe,a0 as Te,a1 as He,a2 as ke,a3 as Ce,a4 as Je,a5 as Ue,a6 as Xe,a7 as Ze,a8 as Qe,a9 as et,aa as tt,ab as at,ac as rt,ad as st,ae as it,af as lt,ag as nt,ah as ot,q as $e,ai as vt,aj as ct,ak as dt,al as ut,am as mt,an as ft,ao as gt,ap as pt,aq as ne,ar as bt,as as _t,at as ht,v as yt,au as St}from"../chunks/runtime-require.B9u3s4Mi.mjs";import{e as Y,i as G}from"../chunks/theme.BMK9KvBa.mjs";import{t as N,D as $t,T as Ee}from"../chunks/time.c7TpusB-.mjs";import{y as wt,z as we,A as xt,B as Rt,C as Dt,D as Lt,E as Ft,F as Tt,G as kt,H as Ct,I as Et,J as qt,K as At,N as Nt,L as Mt}from"../chunks/HoverColumns.DcrenFWk.mjs";import{m as It,I as jt}from"../chunks/InputBox.DOsvhiCa.mjs";import{t as Pt}from"../chunks/time.D7gIuuTU.mjs";import{b as oe}from"../chunks/input.DyT1M9sw.mjs";import{b as Kt}from"../chunks/this.C9pg2j_S.mjs";import{w as Bt}from"../chunks/index.BB25h7Qo.mjs";const Ot=async({params:o})=>({info:await Ie({cid:BigInt(o.cardId)})}),qa=Object.freeze(Object.defineProperty({__proto__:null,load:Ot},Symbol.toStringTag,{value:"Module"}));var Wt=F('<div class="card-info-placeholder svelte-1k3aa26"> </div>');function Yt(o,m){U(m,!1),Z();var l=Wt(),t=v(l);h(()=>x(t,Oe())),n(l),L(o,l),X()}var Gt=F('<tr><th class="align-start svelte-1ws7hzc"> </th><td> </td></tr>'),zt=F('<table class="stats-table align-start svelte-1ws7hzc"><tbody></tbody></table>');function Vt(o,m){U(m,!1);let l=K(m,"stats");function t(e){return new Ee(Number(e)).dateString()}function u(e){const a=[];if(a.push({label:We(),value:t(e.added)}),e.firstReview!=null&&a.push({label:Ye(),value:t(e.firstReview)}),e.latestReview!=null&&a.push({label:Ge(),value:t(e.latestReview)}),e.dueDate!=null&&a.push({label:ze(),value:t(e.dueDate)}),e.duePosition!=null&&a.push({label:Ve(),value:e.duePosition}),e.interval&&a.push({label:Fe(),value:N(e.interval*$t)}),e.memoryState){let c=N(e.memoryState.stability*86400,!1,!1);if(e.memoryState.stability>31){const d=e.memoryState.stability.toFixed(0);c+=` (${d})`}a.push({label:Te(),value:c});const r=((e.memoryState.difficulty-1)/9*100).toFixed(0);if(a.push({label:He(),value:`${r}%`}),e.fsrsRetrievability){const d=(e.fsrsRetrievability*100).toFixed(0);a.push({label:ke(),value:`${d}%`})}}else e.ease&&a.push({label:Ce(),value:`${e.ease/10}%`});a.push({label:Je(),value:e.reviews}),a.push({label:Ue(),value:e.lapses}),e.totalSecs&&(a.push({label:Xe(),value:N(e.averageSecs)}),a.push({label:Ze(),value:N(e.totalSecs)})),a.push({label:Qe(),value:e.cardType}),a.push({label:et(),value:e.notetype});let $;if(e.originalDeck?$=`${e.deck} (${e.originalDeck})`:$=e.deck,a.push({label:tt(),value:$}),a.push({label:at(),value:e.preset}),a.push({label:rt(),value:e.cardId}),a.push({label:st(),value:e.noteId}),e.customData){let c;try{const r=JSON.parse(e.customData);c=Object.entries(r).map(([d,f])=>`${d}=${f}`).join(" ")}catch{c=e.customData}a.push({label:it(),value:c})}return a}let p=pe();fe(()=>_e(l()),()=>{be(p,u(l()))}),ge(),Z();var y=zt(),S=v(y);Y(S,9,()=>A(p),G,(e,a,$)=>{var c=Gt(),r=v(c),d=v(r);n(r);var f=s(r),i=v(f);n(f),n(c),h(()=>{x(d,E(a).label),x(i,E(a).value)}),L(e,c)}),n(S),n(y),L(o,y),X()}const Ht=19/81,Jt=-.5,ve=100;function xe(o,m){return Math.pow(m/o*Ht+1,Jt)}var R=(o=>(o[o.Week=0]="Week",o[o.Month=1]="Month",o[o.Year=2]="Year",o[o.AllTime=3]="AllTime",o))(R||{});function Ut(o,m){const l={0:7,1:30,2:365,3:1/0}[m];return o.filter(t=>t.daysSinceFirstLearn<=l)}function me(o){return o.reviewKind!==q.MANUAL&&(o.reviewKind!==q.FILTERED||o.ease!==0)}function qe(o,m){const l=[];let t=0,u=0;if(o.filter(a=>me(a)).toReversed().forEach((a,$)=>{var f,i;const c=Number(a.time);if($===0){t=c,u=((f=a.memoryState)==null?void 0:f.stability)||0,l.push({date:new Date(c*1e3),daysSinceFirstLearn:0,elapsedDaysSinceLastReview:0,retrievability:100,stability:u});return}const r=(c-t)/(24*60*60),d=Math.min(1,r/ve);for(let g=0;g<Math.max(ve,r);g++){const w=(g+1)*d,D=xe(u,w);l.push({date:new Date((t+w*86400)*1e3),daysSinceFirstLearn:l[l.length-1].daysSinceFirstLearn+d,elapsedDaysSinceLastReview:w,retrievability:D*100,stability:u})}l.push({date:new Date((t+r*86400)*1e3),daysSinceFirstLearn:l[l.length-1].daysSinceFirstLearn,retrievability:100,elapsedDaysSinceLastReview:0,stability:u}),t=c,u=((i=a.memoryState)==null?void 0:i.stability)||0}),l.length===0)return[];const p=Date.now()/1e3,y=Math.floor((p-t)/(24*60*60)),S=Math.min(1,y/ve);for(let a=0;a<Math.max(ve,y);a++){const $=(a+1)*S,c=xe(u,$);l.push({date:new Date((t+$*86400)*1e3),daysSinceFirstLearn:l[l.length-1].daysSinceFirstLearn+S,elapsedDaysSinceLastReview:$,retrievability:c*100,stability:u})}return Ut(l,m)}function Xt(o,m,l,t){const u=qe(o,m),p=wt(l),y=p.transition().duration(600);if(u.length===0){we(p,!1);return}else we(p,!0);p.select(".forgetting-curve-line").remove(),p.select(".hover-columns").remove();const S=It(u,i=>i.date),e=xt(u,i=>i.date),a=Pt().domain([S,e]).range([t.marginLeft,t.width-t.marginRight]),$=Math.max(0,100-1.2*(100-Math.min(...u.map(i=>i.retrievability)))),c=Rt().domain([$,100]).range([t.height-t.marginBottom,t.marginTop]);p.select(".x-ticks").call(i=>i.transition(y).call(Dt(a).ticks(5).tickSizeOuter(0))).attr("direction","ltr"),p.select(".y-ticks").attr("transform",`translate(${t.marginLeft},0)`).call(i=>i.transition(y).call(Lt(c).tickSizeOuter(0))).attr("direction","ltr");const r=Ft().x(i=>a(i.date)).y(i=>c(i.retrievability));p.append("path").datum(u).attr("class","forgetting-curve-line").attr("fill","none").attr("stroke","steelblue").attr("stroke-width",1.5).attr("d",r);const d=p.append("line").attr("class","focus-line").attr("y1",t.marginTop).attr("y2",t.height-t.marginBottom).attr("stroke","black").attr("stroke-width",1).style("opacity",0);function f(i){return`Date: ${i.date.toLocaleString()}<br>
        ${lt()}: ${N(i.elapsedDaysSinceLastReview*86400)}<br>${ke()}: ${i.retrievability.toFixed(2)}%<br>${Te()}: ${N(i.stability*86400)}`}p.append("g").attr("class","hover-columns").selectAll("rect").data(u).join("rect").attr("x",i=>a(i.date)-1).attr("y",t.marginTop).attr("width",2).attr("height",t.height-t.marginTop-t.marginBottom).attr("fill","transparent").on("mousemove",(i,g)=>{const[w,D]=Tt(i,document.body);d.attr("x1",a(g.date)-1).attr("x2",a(g.date)+1).style("opacity",1),kt(f(g),w,D)}).on("mouseout",()=>{d.style("opacity",0),Ct()})}var Zt=F('<div class="svelte-1bf093q"><b> </b> <span class="hidden-xs svelte-1bf093q"> </span></div>'),Qt=F("<div> </div>"),ea=F("<div> </div>"),ta=F('<div class="svelte-1bf093q"> </div>'),aa=F('<div class="svelte-1bf093q"> </div>'),ra=F('<div class="svelte-1bf093q"> </div>'),sa=F('<div class="revlog-table svelte-1bf093q"><div class="column svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content svelte-1bf093q"></div></div> <div class="column hidden-xs svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content svelte-1bf093q"></div></div> <div class="column svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content svelte-1bf093q"></div></div> <div class="column svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content right svelte-1bf093q"></div></div> <div class="column hidden-xs svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content svelte-1bf093q"></div></div> <div class="column svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content right svelte-1bf093q"></div></div> <!></div>');function ia(o,m){U(m,!1);const l=pe();let t=K(m,"revlog"),u=K(m,"fsrsEnabled",0,!1);function p(r){switch(r.reviewKind){case q.LEARNING:return"revlog-learn";case q.REVIEW:return"revlog-review";case q.RELEARNING:return"revlog-relearn"}return""}function y(r){switch(r.reviewKind){case q.LEARNING:return gt();case q.REVIEW:return ft();case q.RELEARNING:return mt();case q.FILTERED:return ut();case q.MANUAL:return dt()}}function S(r){return r.buttonChosen===1?"revlog-ease1":""}function e(r,d){var i;const f=new Ee(Number(r.time));return{date:f.dateString(),time:f.timeString(),reviewKind:y(r),reviewKindClass:p(r),rating:r.buttonChosen,ratingClass:S(r),interval:N(r.interval),ease:a(r.ease),takenSecs:N(r.takenSecs,!0),elapsedTime:d,stability:(i=r.memoryState)!=null&&i.stability?N(r.memoryState.stability*86400):""}}function a(r){if(r===0)return"";const d=r/10;return d<=110?`D:${(d-10).toFixed(0)}%`:`${d.toFixed(0)}%`}fe(()=>_e(t()),()=>{be(l,t().map((r,d)=>{let f,i=d+1;for(;i<t().length;){if(me(t()[i])){f=t()[i];break}i++}let g="N/A";return me(r)&&(g=f?N(Number(r.time)-Number(f.time)):"0"),e(r,g)}))}),ge(),Z();var $=Re(),c=ce($);J(c,()=>t().length>0,r=>{var d=sa(),f=v(d),i=v(f),g=v(i);h(()=>x(g,nt())),n(i);var w=s(s(i,!0));Y(w,9,()=>A(l),G,(C,T,re)=>{var b=Zt(),k=v(b),W=v(k);n(k);var ye=s(s(k,!0)),Me=v(ye);n(ye),n(b),h(()=>{var Se;x(W,E(T).date),x(Me,`@ ${(Se=E(T).time)!=null?Se:""}`)}),L(C,b)}),n(w),n(f);var D=s(s(f,!0)),j=v(D),Q=v(j);h(()=>x(Q,ot())),n(j);var z=s(s(j,!0));Y(z,9,()=>A(l),G,(C,T,re)=>{var b=Qt(),k=v(b);n(b),h(()=>{var W;$e(b,`${(W=E(T).reviewKindClass)!=null?W:""} svelte-1bf093q`),x(k,E(T).reviewKind)}),L(C,b)}),n(z),n(D);var M=s(s(D,!0)),V=v(M),de=v(V);h(()=>x(de,vt())),n(V);var ee=s(s(V,!0));Y(ee,9,()=>A(l),G,(C,T,re)=>{var b=ea(),k=v(b);n(b),h(()=>{var W;$e(b,`${(W=E(T).ratingClass)!=null?W:""} svelte-1bf093q`),x(k,E(T).rating)}),L(C,b)}),n(ee),n(M);var H=s(s(M,!0)),I=v(H),se=v(I);h(()=>x(se,Fe())),n(I);var ie=s(s(I,!0));Y(ie,9,()=>A(l),G,(C,T,re)=>{var b=ta(),k=v(b);n(b),h(()=>x(k,E(T).interval)),L(C,b)}),n(ie),n(H);var _=s(s(H,!0)),B=v(_),O=v(B);h(()=>x(O,Ce())),n(B);var te=s(s(B,!0));Y(te,9,()=>A(l),G,(C,T,re)=>{var b=aa(),k=v(b);n(b),h(()=>x(k,E(T).ease)),L(C,b)}),n(te),n(_);var ae=s(s(_,!0)),P=v(ae),Ae=v(P);h(()=>x(Ae,ct())),n(P);var he=s(s(P,!0));Y(he,9,()=>A(l),G,(C,T,re)=>{var b=ra(),k=v(b);n(b),h(()=>x(k,E(T).takenSecs)),L(C,b)}),n(he),n(ae);var Ne=s(s(ae,!0));J(Ne,u,C=>{}),n(d),L(r,d)}),L(o,$),X()}var la=F('<label class="svelte-6ja67r"><input type="radio" class="svelte-6ja67r"> </label>'),na=F('<div class="time-range-selector svelte-6ja67r"><label class="svelte-6ja67r"><input type="radio" class="svelte-6ja67r"> </label> <label class="svelte-6ja67r"><input type="radio" class="svelte-6ja67r"> </label> <!> <label class="svelte-6ja67r"><input type="radio" class="svelte-6ja67r"> </label></div>'),oa=je("<svg><!><!><!></svg>"),va=F('<div class="forgetting-curve svelte-6ja67r"><!> <!></div>');function ca(o,m){U(m,!1);const l=De(),t=()=>Le(e,"$timeRange",l),u=[];let p=K(m,"revlog"),y=pe(null);const S=Mt(),e=Bt(R.AllTime),a=pt(),$=qe(p(),R.AllTime);fe(()=>(_e(p()),t(),A(y)),()=>{Xt(p(),t(),A(y),S)}),ge(),Z();var c=va(),r=v(c);jt(r,{children:(f,i)=>{var g=na(),w=v(g),D=v(w);ne(D);var j,Q=s(D,!0);h(()=>{var _;return x(Q,` ${(_=bt())!=null?_:""}`)}),n(w);var z=s(s(w,!0)),M=v(z);ne(M);var V,de=s(M,!0);h(()=>{var _;return x(de,` ${(_=_t())!=null?_:""}`)}),n(z);var ee=s(s(z,!0));J(ee,()=>$.length>0&&$.some(_=>_.daysSinceFirstLearn>365),_=>{var B=la(),O=v(B);ne(O);var te,ae=s(O,!0);h(()=>{var P;return x(ae,` ${(P=St())!=null?P:""}`)}),n(B),h(()=>{te!==(te=R.Year)&&(O.value=(O.__value=R.Year)==null?"":R.Year)}),oe(u,[],O,()=>(R.Year,t()),P=>le(e,P)),L(_,B)});var H=s(s(ee,!0)),I=v(H);ne(I);var se,ie=s(I,!0);h(()=>{var _;return x(ie,` ${(_=ht())!=null?_:""}`)}),n(H),n(g),h(()=>{j!==(j=R.Week)&&(D.value=(D.__value=R.Week)==null?"":R.Week),V!==(V=R.Month)&&(M.value=(M.__value=R.Month)==null?"":R.Month),se!==(se=R.AllTime)&&(I.value=(I.__value=R.AllTime)==null?"":R.AllTime)}),oe(u,[],D,()=>(R.Week,t()),_=>le(e,_)),oe(u,[],M,()=>(R.Month,t()),_=>le(e,_)),oe(u,[],I,()=>(R.AllTime,t()),_=>le(e,_)),L(f,g)},$$slots:{default:!0},$$legacy:!0});var d=s(s(r,!0));Et(d,{title:a,children:(f,i)=>{var g=oa();Kt(g,Q=>be(y,Q),()=>A(y));var w=v(g);qt(w,{bounds:S,$$legacy:!0});var D=s(w);At(D);var j=s(D);Nt(j,{bounds:S,$$legacy:!0}),n(g),h(()=>yt(g,"viewBox",`0 0 ${S.width} ${S.height}`)),L(f,g)},$$slots:{default:!0},$$legacy:!0}),n(c),L(o,c),X()}var da=F("<!> <!> <!>",1),ua=F('<div style="display: contents"><!></div>',1);function ma(o,m){U(m,!1);let l=K(m,"stats",0,null),t=K(m,"showRevlog",0,!0),u=K(m,"fsrsEnabled",8,()=>{var S;return((S=l())==null?void 0:S.memoryState)!=null});Z();var p=ua(),y=ce(p);Ke(y,()=>({"--gutter-inline":"1rem","--gutter-block":"0.5rem"})),Be(y.lastChild,{breakpoint:"md",children:(S,e)=>{var a=Re(),$=ce(a);J($,l,c=>{var r=da(),d=ce(r);ue(d,{children:(g,w)=>{Vt(g,{get stats(){return l()},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0});var f=s(s(d,!0));J(f,t,g=>{ue(g,{children:(w,D)=>{ia(w,{get revlog(){return l().revlog},get fsrsEnabled(){return u()},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0})});var i=s(s(f,!0));J(i,u,g=>{ue(g,{children:(w,D)=>{ca(w,{get revlog(){return l().revlog},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0})}),L(c,r)},c=>{Yt(c,{$$legacy:!0})}),L(S,a)},$$slots:{default:!0},$$legacy:!0}),n(y),L(o,p),X()}function Aa(o,m){U(m,!1);const l=De(),t=()=>Le(Pe,"$page",l);let u=K(m,"data");const p=t().url.searchParams.get("revlog")!=="0";Z(),ma(o,{get stats(){return u().info},showRevlog:p,$$legacy:!0}),X()}export{Aa as component,qa as universal};
