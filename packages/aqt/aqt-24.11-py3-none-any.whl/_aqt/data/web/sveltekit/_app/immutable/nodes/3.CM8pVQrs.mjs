var Nt=Object.defineProperty;var bt=(o,t,e)=>t in o?Nt(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var F=(o,t,e)=>bt(o,typeof t!="symbol"?t+"":t,e);import{x as vt,y as xt,r as wt,s as It,d as Ct}from"../chunks/backend.DRML5B1x.mjs";import{av as St,v as tt,q as Pt,aZ as Ft,a_ as Tt,a$ as kt,b0 as Ot,b1 as zt,b2 as Bt,b3 as Et,U as Lt,b4 as jt,b5 as At,b6 as Dt}from"../chunks/runtime-require.XfVPIJtJ.mjs";import{r as rt}from"../chunks/index.BB25h7Qo.mjs";import{i as nt,S as et,r as qt}from"../chunks/Select.DerbYqNj.mjs";import{a as p,d as m,F as P,s as g,t as $t,D as Mt,r as $,e as k}from"../chunks/disclose-version.CXWUuFGG.mjs";import{p as D,l as S,s as b,N as L,g as l,a as J,t as E,b as q,m as I,a0 as X,ag as mt}from"../chunks/runtime.BJSnJeWl.mjs";import{i as W}from"../chunks/lifecycle.DW1_rEFA.mjs";import{p as x,i as G}from"../chunks/props.fkJSEmZ6.mjs";import{c as O,C as at}from"../chunks/Container.DdPX9a09.mjs";import{s as V,a as Z,c as yt}from"../chunks/store.CAPRemx4.mjs";import{R as U}from"../chunks/Row.COIbe2Oq.mjs";import{L as Rt,S as Wt}from"../chunks/LabelButton.B-CCQke4.mjs";import{T as ot}from"../chunks/TitledContainer.DLckdw3n.mjs";import{e as ht,i as _t}from"../chunks/theme.B6Eko5I8.mjs";import{s as A,e as lt}from"../chunks/render.CQvFnAiW.mjs";import{C as Y}from"../chunks/Col.DoKlg-nQ.mjs";import{B as Ht}from"../chunks/ButtonToolbar.DDDLkddn.mjs";import{S as Gt,g as Ut,I as st,a as Zt,c as Jt,d as Kt,m as Qt,o as Vt}from"../chunks/Shortcut.BeOdFNIa.mjs";import{t as it,s as dt}from"../chunks/index.DPGbUxyT.mjs";import{B as Xt}from"../chunks/Badge.D2YMzTXS.mjs";function ut(o){return o.map(t=>t!=null?t:-1)}function ct(o){return o.map(t=>t===-1?null:t)}class ft{constructor(t){F(this,"fields");F(this,"templates");F(this,"oldNotetypeName");F(this,"isCloze");F(this,"info");var s,r,i,d,n,a;this.info=t;const e=(r=(s=t.input)==null?void 0:s.newTemplates)!=null?r:[];this.isCloze=(d=(i=t.input)==null?void 0:i.isCloze)!=null?d:!1,e.length>0&&(this.templates=ct(e)),this.fields=ct((a=(n=t.input)==null?void 0:n.newFields)!=null?a:[]),this.oldNotetypeName=t.oldNotetypeName}mapForContext(t){var e;return t==1?(e=this.templates)!=null?e:[]:this.fields}getOldIndex(t,e){const r=this.mapForContext(t)[e];return r!=null?r:this.getOldNamesIncludingNothing(t).length-1}getOldNamesIncludingNothing(t){return[...this.getOldNames(t),St()]}getOldNames(t){return t==1?this.info.oldTemplateNames:this.info.oldFieldNames}getOldNotetypeName(){return this.info.oldNotetypeName}getNewName(t,e){return(t==1?this.info.newTemplateNames:this.info.newFieldNames)[e]}unusedItems(t){const e=new Set(this.mapForContext(t).filter(d=>d!==null)),s=this.getOldNames(t);return[...Array(s.length).keys()].filter(d=>!e.has(d)).map(d=>s[d])}unchanged(){var t,e;return this.input().newNotetypeId===this.input().oldNotetypeId&&nt(this.fields,[...Array(this.fields.length).keys()])&&nt(this.templates,[...Array((e=(t=this.templates)==null?void 0:t.length)!=null?e:0).keys()])}input(){return this.info.input}intoInput(){const t=this.info.input;return t.newFields=ut(this.fields),this.templates&&(t.newTemplates=ut(this.templates)),t}}var R=(o=>(o[o.Field=0]="Field",o[o.Template=1]="Template",o))(R||{});class Yt{constructor(t,e){F(this,"info");F(this,"notetypes");F(this,"info_");F(this,"infoSetter");F(this,"notetypeNames");F(this,"notetypesSetter");this.info_=new ft(e),this.info=rt(this.info_,s=>{this.infoSetter=s}),this.notetypeNames=t,this.notetypes=rt(this.buildNotetypeList(),s=>{this.notetypesSetter=s})}async setTargetNotetypeIndex(t){this.info_.input().newNotetypeId=this.notetypeNames.entries[t].id,this.notetypesSetter(this.buildNotetypeList());const{oldNotetypeId:e,newNotetypeId:s}=this.info_.input(),r=await vt({oldNotetypeId:e,newNotetypeId:s});this.info_=new ft(r),this.info_.unusedItems(0),this.infoSetter(this.info_)}setOldIndex(t,e,s){const r=this.info_.mapForContext(t),i=this.info_.getOldNames(t),d=s<i.length?s:null;if(!(t==0)&&d!==null)for(let a=0;a<r.length;a++)r[a]===d&&(r[a]=null);r[e]=d,this.infoSetter(this.info_)}dataForSaving(){return this.info_.intoInput()}async save(){if(this.info_.unchanged()){alert("No changes to save");return}await xt(this.dataForSaving())}buildNotetypeList(){const t=this.info_.input().newNotetypeId;return this.notetypeNames.entries.map((e,s)=>({idx:s,name:e.name,current:e.id===t}))}}const te=async({params:o})=>{const[t,e]=o.notetypeIds.split("/"),s=BigInt(t),r=e?BigInt(e):s,i=wt({}),d=vt({oldNotetypeId:s,newNotetypeId:r}),[n,a]=await Promise.all([i,d]);return{state:new Yt(n,a)}},Xe=Object.freeze(Object.defineProperty({__proto__:null,load:te},Symbol.toStringTag,{value:"Module"}));var ee=m('<div class="svelte-1xardfc"></div>');function se(o){var t=ee();p(o,t)}var ae=m("<!> <!>",1);function re(o,t){D(t,!1);const e=V(),s=()=>Z(u,"$info",e),r=I(),i=I();let d=x(t,"state"),n=x(t,"ctx"),a=x(t,"newIndex");const u=d().info;function _(v){b(r,v.detail.value),d().setOldIndex(n(),a(),l(r))}S(()=>(s(),L(n()),L(a())),()=>{b(r,s().getOldIndex(n(),a()))}),S(()=>(s(),L(n()),l(r)),()=>{b(i,s().getOldNamesIncludingNothing(n())[l(r)])}),J(),W(),U(o,{children:(v,C)=>{var f=ae(),c=P(f);Y(c,{children:(y,h)=>{var N=X(()=>s().getOldNamesIncludingNothing(n()));et(y,{get value(){return l(r)},get label(){return l(i)},get list(){return l(N)},$$events:{change:_},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0});var w=g(g(c,!0));Y(w,{children:(y,h)=>{var N=$t();E(()=>A(N,s().getNewName(n(),a()))),p(y,N)},$$slots:{default:!0},$$legacy:!0}),p(v,f)},$$slots:{default:!0},$$legacy:!0}),q()}var ne=m('<div style="display: contents"><!></div> <div style="display: contents"><!></div>',1);function gt(o,t){D(t,!1);const e=V(),s=()=>Z(l(d),"$info",e);let r=x(t,"state"),i=x(t,"ctx");const d=I(r().info);W();var n=ne(),a=P(n);O(a,()=>({"--height":"0.5rem"})),se(a.lastChild),$(a);var u=g(g(a,!0));O(u,()=>({"--gutter-inline":"0.5rem","--gutter-block":"0.15rem"})),at(u.lastChild,{children:(_,v)=>{var C=Mt(),f=P(C);ht(f,1,()=>s().mapForContext(i()),_t,(c,w,y)=>{re(c,{get state(){return r()},get ctx(){return i()},newIndex:mt(y),$$legacy:!0})}),p(_,C)},$$slots:{default:!0},$$legacy:!0}),$(u),p(o,n),q()}var oe=m('<div dir="ltr" role="group"><!></div>');function le(o,t){D(t,!1);const e=I(),s=I();let r=x(t,"id",0,void 0),i=x(t,"class",0,""),d=x(t,"size",0,void 0),n=x(t,"wrap",0,void 0),a=I();S(()=>L(d()),()=>{b(e,d()?`--buttons-size: ${d()}rem; `:"")}),S(()=>L(n()),()=>{n()===void 0?b(a,""):b(a,n()?"--buttons-wrap: wrap; ":"--buttons-wrap: nowrap; ")}),S(()=>(l(e),l(a)),()=>{b(s,l(e)+l(a))}),J();var u=oe(),_=k(u);It(_,Ct(t),{}),$(u),E(()=>{var v;tt(u,"id",r()),Pt(u,`button-group btn-group ${(v=i())!=null?v:""} svelte-svn7mu`),tt(u,"style",l(s)),u.dir=u.dir}),p(o,u),q()}var ie=m('<div class="save svelte-1polrdz"> </div>'),de=m('<div style="display: contents"><!></div> <!>',1);function ue(o,t){D(t,!1);let e=x(t,"state");function s(){document.activeElement instanceof HTMLElement&&document.activeElement.blur(),e().save()}const r="Control+Enter";W(),le(o,{children:(i,d)=>{var n=de(),a=P(n),u=X(()=>Ut(r));O(a,()=>({"--border-left-radius":"5px","--border-right-radius":"5px"})),Rt(a.lastChild,{primary:!0,get tooltip(){return l(u)},$$events:{click:s},children:(v,C)=>{var f=ie(),c=k(f);E(()=>A(c,Ft())),$(f),p(v,f)},$$slots:{default:!0},$$legacy:!0}),$(a);var _=g(g(a,!0));Gt(_,{keyCombination:r,$$events:{action:s},$$legacy:!0}),p(i,n)},$$slots:{default:!0},$$legacy:!0}),q()}var ce=m('<div class="d-flex flex-row w-100"><!> <div class="arrow-container svelte-ng49hq"><!></div> <!></div> <!>',1);function fe(o,t){D(t,!1);const e=V(),s=()=>Z(a,"$notetypes",e),r=()=>Z(u,"$info",e),i=I(),d=I();let n=x(t,"state");const a=n().notetypes,u=n().info;let _=I(s().findIndex(v=>v.current));S(()=>s(),()=>{b(i,Array.from(s(),v=>v.name))}),S(()=>(l(i),l(_)),()=>{b(d,l(i)[l(_)])}),S(()=>(L(n()),l(_)),()=>{n().setTargetNotetypeIndex(l(_))}),J(),W(),Ht(o,{class:"justify-content-between",wrap:!1,children:(v,C)=>{var f=ce(),c=P(f),w=k(c);et(w,{get label(){return r().oldNotetypeName},value:1,list:[1],disabled:!0,$$legacy:!0});var y=g(g(w,!0)),h=k(y);G(h,()=>window.getComputedStyle(document.body).direction=="rtl",z=>{st(z,{icon:Jt,$$legacy:!0})},z=>{st(z,{icon:Zt,$$legacy:!0})}),$(y);var N=g(g(y,!0));et(N,{get list(){return l(i)},get value(){return l(_)},set value(z){b(_,z)},get label(){return l(d)},$$legacy:!0}),$(c);var M=g(g(c,!0));ue(M,{get state(){return n()},$$legacy:!0}),p(v,f)},$$slots:{default:!0},$$legacy:!0}),q()}var ge=m('<div class="clickable svelte-18ivrjn" role="button" tabindex="0"><!> </div>'),pe=m("<div> <!></div>"),ve=m("<li> </li>"),$e=m("<ul></ul>"),me=m('<div class="alert alert-warning"><!> <!></div>');function ye(o,t){D(t,!1);const e=I(),s=I();let r=x(t,"unused"),i=x(t,"ctx"),d=I();const n=3;let a=I(!0);S(()=>L(i()),()=>{b(d,i()===R.Field?Tt():kt())}),S(()=>l(a),()=>{b(e,l(a)?Ot():zt())}),S(()=>l(a),()=>{b(s,l(a)?Kt:Qt)}),J(),W();var u=me();it(1,u,()=>dt),it(2,u,()=>dt);var _=k(u);G(_,()=>r().length>n,f=>{var c=ge(),w=k(c);Xt(w,{iconSize:80,children:(h,N)=>{st(h,{get icon(){return l(s)},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0});var y=g(w,!0);$(c),E(()=>{var h;tt(c,"aria-expanded",!l(a)),A(y,` ${(h=l(e))!=null?h:""}`)}),lt("click",c,()=>b(a,!l(a)),!1),lt("keydown",c,Vt(()=>b(a,!l(a))),!1),p(f,c)});var v=g(_,!0),C=g(v);G(C,()=>l(a),f=>{var c=pe(),w=k(c);E(()=>{var h;return A(w,`${(h=r().slice(0,n).join(", "))!=null?h:""} `)});var y=g(w);G(y,()=>r().length>n,h=>{var N=$t();E(()=>A(N,`... (+${r().length-n})`)),p(h,N)}),$(c),p(f,c)},f=>{var c=$e();ht(c,9,r,_t,(w,y,h)=>{var N=ve(),M=k(N);$(N),E(()=>A(M,mt(y))),p(w,N)}),$(c),p(f,c)}),$(u),E(()=>{var f;return A(v,` ${(f=l(d))!=null?f:""} `)}),p(o,u),q()}var he=m("<b> </b>"),_e=m("<b> </b>"),Ne=m('<div style="display: contents"><!></div> <div style="display: contents"><!></div>',1),be=m('<div style="display: contents"><!></div>',1),xe=m('<div style="display: contents"><!></div>',1),we=m("<!> <!>",1);function pt(o,t){D(t,!1);const e=V(),s=()=>Z(l(r),"$info",e),r=I(),i=I();let d=x(t,"state"),n=x(t,"ctx");S(()=>L(d()),()=>{yt(b(r,d().info),"$info",e)}),S(()=>(s(),L(n())),()=>{b(i,s().isCloze&&n()===R.Template?[]:s().unusedItems(n()))}),J(),W();var a=we(),u=P(a);G(u,()=>l(i).length>0,v=>{ye(v,{get unused(){return l(i)},get ctx(){return n()},$$legacy:!0})});var _=g(g(u,!0));G(_,()=>s().templates||n()===R.Field,v=>{var C=xe(),f=P(C);O(f,()=>({"--gutter-inline":"0.5rem","--gutter-block":"0.2rem"})),at(f.lastChild,{children:(c,w)=>{var y=be(),h=P(y);O(h,()=>({"--cols":2})),U(h.lastChild,{children:(N,M)=>{var z=Ne(),B=P(z);O(B,()=>({"--col-size":1})),Y(B.lastChild,{children:(H,K)=>{var T=he(),Q=k(T);E(()=>A(Q,Bt())),$(T),p(H,T)},$$slots:{default:!0},$$legacy:!0}),$(B);var j=g(g(B,!0));O(j,()=>({"--col-size":1})),Y(j.lastChild,{children:(H,K)=>{var T=_e(),Q=k(T);E(()=>A(Q,Et())),$(T),p(H,T)},$$slots:{default:!0},$$legacy:!0}),$(j),p(N,z)},$$slots:{default:!0},$$legacy:!0}),$(h),p(c,y)},$$slots:{default:!0},$$legacy:!0}),$(f),p(v,C)}),p(o,a),q()}var Ie=m("<!> <!>",1),Ce=m("<div><!></div>"),Se=m("<!> <!>",1),Pe=m('<div style="display: contents"><!></div> <div style="display: contents"><!></div>',1),Fe=m('<div style="display: contents"><!></div> <div style="display: contents"><!></div>',1);function Te(o,t){D(t,!1);const e=V(),s=()=>Z(l(r),"$info",e),r=I();let i=x(t,"state");S(()=>L(i()),()=>{yt(b(r,i().info),"$info",e)}),J(),W();var d=Fe(),n=P(d);O(n,()=>({"--gutter-block":"0.5rem","--gutter-inline":"0.25rem","--sticky-borders":"0 0 1px"})),Wt(n.lastChild,{breakpoint:"sm",children:(u,_)=>{fe(u,{get state(){return i()},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0}),$(n);var a=g(g(n,!0));O(a,()=>({"--gutter-inline":"0.25rem","--gutter-block":"0.75rem"})),at(a.lastChild,{breakpoint:"sm",children:(u,_)=>{var v=Pe(),C=P(v);O(C,()=>({"--cols":2})),U(C.lastChild,{children:(c,w)=>{var y=X(()=>At());ot(c,{get title(){return l(y)},children:(h,N)=>{U(h,{children:(M,z)=>{var B=Ie(),j=P(B);pt(j,{get state(){return i()},get ctx(){return R.Field},$$legacy:!0});var H=g(g(j,!0));gt(H,{get state(){return i()},get ctx(){return R.Field},$$legacy:!0}),p(M,B)},$$slots:{default:!0},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0}),$(C);var f=g(g(C,!0));O(f,()=>({"--cols":2})),U(f.lastChild,{children:(c,w)=>{var y=X(()=>Dt());ot(c,{get title(){return l(y)},children:(h,N)=>{U(h,{children:(M,z)=>{var B=Se(),j=P(B);pt(j,{get state(){return i()},get ctx(){return R.Template},$$legacy:!0});var H=g(g(j,!0));G(H,()=>s().templates,K=>{gt(K,{get state(){return i()},get ctx(){return R.Template},$$legacy:!0})},K=>{var T=Ce(),Q=k(T);Lt(Q,()=>qt(jt()),!1,!1),$(T),p(K,T)}),p(M,B)},$$slots:{default:!0},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0}),$(f),p(u,v)},$$slots:{default:!0},$$legacy:!0}),$(a),p(o,d),q()}function Ye(o,t){D(t,!1);let e=x(t,"data");W(),Te(o,{get state(){return e().state},$$legacy:!0}),q()}export{Ye as component,Xe as universal};
