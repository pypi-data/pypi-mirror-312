import{h as Ne,R as M}from"../chunks/backend.BdhjA4ya.mjs";import{a as x,b as T,e as ye,n as qe}from"../chunks/disclose-version.CfFqPxFi.mjs";import{p as V,t as y,b as J,M as c,N as n,l as ce,a as de,g as D,m as ue,s as me,K as Se,O as p,aM as te}from"../chunks/runtime.HDa-Uzkj.mjs";import{i as X}from"../chunks/lifecycle.BeemcHx2.mjs";import{p as B,a as Y}from"../chunks/props.QYk8O08b.mjs";import{s as we,b as Z,a as Re}from"../chunks/store.CtPiLHV-.mjs";import{p as Me}from"../chunks/stores.Bd2vy_C9.mjs";import{c as Ie,C as je}from"../chunks/Container.Bzc_5eLk.mjs";import{R as le}from"../chunks/Row.BE4FGQd0.mjs";import{s as F}from"../chunks/render.dASvSx6G.mjs";import{V as Ke,W as Pe,X as Ye,Y as Be,Z as Oe,_ as We,$ as $e,a0 as De,a1 as Ge,a2 as xe,a3 as Le,a4 as ze,a5 as Ue,a6 as He,a7 as Ve,a8 as Je,a9 as Xe,aa as Ze,ab as Qe,ac as et,ad as tt,ae as at,af as rt,ag as st,ah as it,q as he,ai as lt,aj as nt,ak as ot,al as vt,am as ct,an as dt,ao as ut,ap as mt,aq as ft,ar as Q,as as pt,at as bt,au as gt,av as _t,v as ht}from"../chunks/runtime-require.BMNCZg22.mjs";import{e as U,i as H}from"../chunks/theme.BSeXeARl.mjs";import{t as P,D as yt,T as Fe}from"../chunks/time.Dh4VeLPR.mjs";import{y as St,z as ne,A as wt,B as Rt,C as $t,D as Dt,E as xt,F as Lt,G as Ft,H as Tt,I as kt,J as Et,K as Ct,L as At,N as Nt,M as qt}from"../chunks/HoverColumns.Bf-xtFmO.mjs";import{m as Mt}from"../chunks/min.D1slsF82.mjs";import{t as It}from"../chunks/time.DNdJm98A.mjs";import{b as ee}from"../chunks/input.CCs2NzX5.mjs";import{b as jt}from"../chunks/this.DuXIBV3p.mjs";import{w as Kt}from"../chunks/index.BBTf1svy.mjs";const Pt=async({params:s})=>({info:await Ne({cid:BigInt(s.cardId)})}),ja=Object.freeze(Object.defineProperty({__proto__:null,load:Pt},Symbol.toStringTag,{value:"Module"}));var Yt=T('<div class="card-info-placeholder svelte-1k3aa26"> </div>');function Bt(s,v){V(v,!1),X();var a=Yt(),r=c(a);y(()=>F(r,Ke())),n(a),x(s,a),J()}var Ot=T('<tr><th class="align-start svelte-1ws7hzc"> </th><td> </td></tr>'),Wt=T('<table class="stats-table align-start svelte-1ws7hzc"><tbody></tbody></table>');function Gt(s,v){V(v,!1);let a=B(v,"stats",8);function r(e){return new Fe(Number(e)).dateString()}function o(e){const l=[];if(l.push({label:Pe(),value:r(e.added)}),e.firstReview!=null&&l.push({label:Ye(),value:r(e.firstReview)}),e.latestReview!=null&&l.push({label:Be(),value:r(e.latestReview)}),e.dueDate!=null&&l.push({label:Oe(),value:r(e.dueDate)}),e.duePosition!=null&&l.push({label:We(),value:e.duePosition}),e.interval&&l.push({label:$e(),value:P(e.interval*yt)}),e.memoryState){let _=P(e.memoryState.stability*86400,!1,!1);if(e.memoryState.stability>31){const d=e.memoryState.stability.toFixed(0);_+=` (${d})`}l.push({label:De(),value:_});const t=((e.memoryState.difficulty-1)/9*100).toFixed(0);if(l.push({label:Ge(),value:`${t}%`}),e.fsrsRetrievability){const d=(e.fsrsRetrievability*100).toFixed(0);l.push({label:xe(),value:`${d}%`})}}else e.ease&&l.push({label:Le(),value:`${e.ease/10}%`});l.push({label:ze(),value:e.reviews}),l.push({label:Ue(),value:e.lapses}),e.totalSecs&&(l.push({label:He(),value:P(e.averageSecs)}),l.push({label:Ve(),value:P(e.totalSecs)})),l.push({label:Je(),value:e.cardType}),l.push({label:Xe(),value:e.notetype});let m;if(e.originalDeck?m=`${e.deck} (${e.originalDeck})`:m=e.deck,l.push({label:Ze(),value:m}),l.push({label:Qe(),value:e.preset}),l.push({label:et(),value:e.cardId}),l.push({label:tt(),value:e.noteId}),e.customData){let _;try{const t=JSON.parse(e.customData);_=Object.entries(t).map(([d,u])=>`${d}=${u}`).join(" ")}catch{_=e.customData}l.push({label:at(),value:_})}return l}let w=ue();ce(()=>Se(a()),()=>{me(w,o(a()))}),de(),X();var h=Wt(),b=c(h);U(b,5,()=>D(w),H,(e,l)=>{var m=Ot(),_=c(m),t=c(_);n(_);var d=p(_),u=c(d);n(d),n(m),y(()=>{F(t,D(l).label),F(u,D(l).value)}),x(e,m)}),n(b),n(h),x(s,h),J()}const zt=19/81,Ut=-.5,Ht=1e3;function oe(s,v){return Math.pow(v/s*zt+1,Ut)}var S=(s=>(s[s.Week=0]="Week",s[s.Month=1]="Month",s[s.Year=2]="Year",s[s.AllTime=3]="AllTime",s))(S||{});const Vt={0:7,1:30,2:365,3:1/0};function Jt(s,v){return s.filter(a=>a.daysSinceFirstLearn<=v)}function ve(s){return s.reviewKind!==M.MANUAL&&s.reviewKind!==M.RESCHEDULED&&(s.reviewKind!==M.FILTERED||s.ease!==0)}function Xt(s){const v=[];for(const a of s){if(a.reviewKind===M.MANUAL&&a.ease===0)break;v.push(a)}return v.filter(a=>ve(a))}function Zt(s,v){const a=[];let r=0,o=0;const w=Math.min(v/Ht,1);let h=0;if(s.toReversed().forEach((t,d)=>{var E,L;const u=Number(t.time);if(d===0){r=u,o=((E=t.memoryState)==null?void 0:E.stability)||0,a.push({date:new Date(u*1e3),daysSinceFirstLearn:0,elapsedDaysSinceLastReview:0,retrievability:100,stability:o});return}const R=(u-r)/(24*60*60);let i=0;for(;i<R-w;){i+=w;const N=oe(o,i);a.push({date:new Date((r+i*86400)*1e3),daysSinceFirstLearn:a[a.length-1].daysSinceFirstLearn+w,elapsedDaysSinceLastReview:i,retrievability:N*100,stability:o})}h+=R,a.push({date:new Date((r+R*86400)*1e3),daysSinceFirstLearn:h,retrievability:100,elapsedDaysSinceLastReview:0,stability:o}),r=u,o=((L=t.memoryState)==null?void 0:L.stability)||0}),a.length===0)return[];const b=Date.now()/1e3,e=(b-r)/(24*60*60);let l=0;for(;l<e-w;){l+=w;const t=oe(o,l);a.push({date:new Date((r+l*86400)*1e3),daysSinceFirstLearn:a[a.length-1].daysSinceFirstLearn+w,elapsedDaysSinceLastReview:l,retrievability:t*100,stability:o})}h+=e;const m=oe(o,e);return a.push({date:new Date(b*1e3),daysSinceFirstLearn:h,elapsedDaysSinceLastReview:e,retrievability:m*100,stability:o}),Jt(a,v)}function Te(s,v){if(s.length===0)return 0;const a=(Date.now()/1e3-Number(s[s.length-1].time))/(24*60*60);return Math.min(a,Vt[v])}function Qt(s,v,a,r){const o=St(a),w=o.transition().duration(600);if(s.length===0){ne(o,!1);return}const h=Te(s,v),b=Zt(s,h);if(b.length===0){ne(o,!1);return}else ne(o,!0);o.select(".forgetting-curve-line").remove(),o.select(".hover-columns").remove();const e=Mt(b,i=>i.date),l=wt(b,i=>i.date),m=It().domain([e,l]).range([r.marginLeft,r.width-r.marginRight]),_=Math.max(0,100-1.2*(100-Math.min(...b.map(i=>i.retrievability)))),t=Rt().domain([_,100]).range([r.height-r.marginBottom,r.marginTop]);o.select(".x-ticks").call(i=>i.transition(w).call($t(m).ticks(5).tickSizeOuter(0))).attr("direction","ltr"),o.select(".y-ticks").attr("transform",`translate(${r.marginLeft},0)`).call(i=>i.transition(w).call(Dt(t).tickSizeOuter(0))).attr("direction","ltr");const d=xt().x(i=>m(i.date)).y(i=>t(i.retrievability));o.append("path").datum(b).attr("class","forgetting-curve-line").attr("fill","none").attr("stroke","steelblue").attr("stroke-width",1.5).attr("d",d);const u=o.append("line").attr("class","focus-line").attr("y1",r.marginTop).attr("y2",r.height-r.marginBottom).attr("stroke","black").attr("stroke-width",1).style("opacity",0);function R(i){return`${h>=365?"Date":"Date Time"}: ${h>=365?i.date.toLocaleDateString():i.date.toLocaleString()}<br>
        ${rt()}: ${P(i.elapsedDaysSinceLastReview*86400)}<br>${xe()}: ${i.retrievability.toFixed(2)}%<br>${De()}: ${P(i.stability*86400)}`}o.append("g").attr("class","hover-columns").selectAll("rect").data(b).join("rect").attr("x",i=>m(i.date)-1).attr("y",r.marginTop).attr("width",2).attr("height",r.height-r.marginTop-r.marginBottom).attr("fill","transparent").on("mousemove",(i,E)=>{const[L,N]=Lt(i,document.body);u.attr("x1",m(E.date)-1).attr("x2",m(E.date)+1).style("opacity",1),Ft(R(E),L,N)}).on("mouseout",()=>{u.style("opacity",0),Tt()})}var ea=T('<div class="svelte-1bf093q"><b> </b> <span class="hidden-xs svelte-1bf093q"> </span></div>'),ta=T("<div> </div>"),aa=T("<div> </div>"),ra=T('<div class="svelte-1bf093q"> </div>'),sa=T('<div class="svelte-1bf093q"> </div>'),ia=T('<div class="svelte-1bf093q"> </div>'),la=T('<div class="revlog-table svelte-1bf093q"><div class="column svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content svelte-1bf093q"></div></div> <div class="column hidden-xs svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content svelte-1bf093q"></div></div> <div class="column svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content svelte-1bf093q"></div></div> <div class="column svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content right svelte-1bf093q"></div></div> <div class="column hidden-xs svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content svelte-1bf093q"></div></div> <div class="column svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content right svelte-1bf093q"></div></div> <!></div>');function na(s,v){V(v,!1);const a=ue();let r=B(v,"revlog",8),o=B(v,"fsrsEnabled",8,!1);function w(t){switch(t.reviewKind){case M.LEARNING:return"revlog-learn";case M.REVIEW:return"revlog-review";case M.RELEARNING:return"revlog-relearn"}return""}function h(t){switch(t.reviewKind){case M.LEARNING:return mt();case M.REVIEW:return ut();case M.RELEARNING:return dt();case M.FILTERED:return ct();case M.MANUAL:return vt();case M.RESCHEDULED:return ot()}}function b(t){return t.buttonChosen===1?"revlog-ease1":""}function e(t,d){var R;const u=new Fe(Number(t.time));return{date:u.dateString(),time:u.timeString(),reviewKind:h(t),reviewKindClass:w(t),rating:t.buttonChosen,ratingClass:b(t),interval:P(t.interval),ease:l(t.ease),takenSecs:P(t.takenSecs,!0),elapsedTime:d,stability:(R=t.memoryState)!=null&&R.stability?P(t.memoryState.stability*86400):""}}function l(t){if(t===0)return"";const d=t/10;return d<=110?`D:${(d-10).toFixed(0)}%`:`${d.toFixed(0)}%`}ce(()=>(Se(r()),P),()=>{me(a,r().map((t,d)=>{let u,R=d+1;for(;R<r().length;){if(ve(r()[R])){u=r()[R];break}R+=1}let i="N/A";return ve(t)&&(i=u?P(Number(t.time)-Number(u.time)):"0"),e(t,i)}))}),de(),X();var m=ye(),_=te(m);Y(_,()=>r().length>0,t=>{var d=la(),u=c(d),R=c(u),i=c(R);y(()=>F(i,st())),n(R);var E=p(R,2);U(E,5,()=>D(a),H,(I,A)=>{var g=ea(),q=c(g),z=c(q);n(q);var ge=p(q,2),Ae=c(ge);n(ge),n(g),y(()=>{var _e;F(z,D(A).date),F(Ae,`@ ${(_e=D(A).time)!=null?_e:""}`)}),x(I,g)}),n(E),n(u);var L=p(u,2),N=c(L),O=c(N);y(()=>F(O,it())),n(N);var W=p(N,2);U(W,5,()=>D(a),H,(I,A)=>{var g=ta(),q=c(g);n(g),y(()=>{var z;he(g,`${(z=D(A).reviewKindClass)!=null?z:""} svelte-1bf093q`),F(q,D(A).reviewKind)}),x(I,g)}),n(W),n(L);var G=p(L,2),j=c(G),k=c(j);y(()=>F(k,lt())),n(j);var f=p(j,2);U(f,5,()=>D(a),H,(I,A)=>{var g=aa(),q=c(g);n(g),y(()=>{var z;he(g,`${(z=D(A).ratingClass)!=null?z:""} svelte-1bf093q`),F(q,D(A).rating)}),x(I,g)}),n(f),n(G);var C=p(G,2),K=c(C),$=c(K);y(()=>F($,$e())),n(K);var fe=p(K,2);U(fe,5,()=>D(a),H,(I,A)=>{var g=ra(),q=c(g);n(g),y(()=>F(q,D(A).interval)),x(I,g)}),n(fe),n(C);var ae=p(C,2),re=c(ae),ke=c(re);y(()=>F(ke,Le())),n(re);var pe=p(re,2);U(pe,5,()=>D(a),H,(I,A)=>{var g=sa(),q=c(g);n(g),y(()=>F(q,D(A).ease)),x(I,g)}),n(pe),n(ae);var se=p(ae,2),ie=c(se),Ee=c(ie);y(()=>F(Ee,nt())),n(ie);var be=p(ie,2);U(be,5,()=>D(a),H,(I,A)=>{var g=ia(),q=c(g);n(g),y(()=>F(q,D(A).takenSecs)),x(I,g)}),n(be),n(se);var Ce=p(se,2);Y(Ce,o,I=>{}),n(d),x(t,d)}),x(s,m),J()}var oa=T('<label class="svelte-6ja67r"><input type="radio" class="svelte-6ja67r"> </label>'),va=T('<label class="svelte-6ja67r"><input type="radio" class="svelte-6ja67r"> </label>'),ca=T('<label class="svelte-6ja67r"><input type="radio" class="svelte-6ja67r"> </label>'),da=T('<label class="svelte-6ja67r"><input type="radio" class="svelte-6ja67r"> </label>'),ua=T('<div class="time-range-selector svelte-6ja67r"><!> <!> <!> <!></div>'),ma=qe("<svg><!><!><!></svg>"),fa=T('<div class="forgetting-curve svelte-6ja67r"><!> <!></div>');function pa(s,v){V(v,!1);const a=we(),r=()=>Re(t,"$timeRange",a),o=[];let w=B(v,"revlog",8),h=ue(null);const b=qt(),e=ft(),l=Xt(w()),m=Te(l,S.AllTime);let _=S.Week;m>365?_=S.AllTime:m>30?_=S.Year:m>7&&(_=S.Month);const t=Kt(_);ce(()=>(r(),D(h)),()=>{Qt(l,r(),D(h),b)}),de(),X();var d=fa(),u=c(d);kt(u,{children:(i,E)=>{var L=ua(),N=c(L);Y(N,()=>m>0,j=>{var k=oa(),f=c(k);Q(f);var C,K=p(f);y(()=>{var $;return F(K,` ${($=pt())!=null?$:""}`)}),n(k),y(()=>{C!==(C=S.Week)&&(f.value=(f.__value=S.Week)==null?"":S.Week)}),ee(o,[],f,()=>(S.Week,r()),$=>Z(t,$)),x(j,k)});var O=p(N,2);Y(O,()=>m>7,j=>{var k=va(),f=c(k);Q(f);var C,K=p(f);y(()=>{var $;return F(K,` ${($=bt())!=null?$:""}`)}),n(k),y(()=>{C!==(C=S.Month)&&(f.value=(f.__value=S.Month)==null?"":S.Month)}),ee(o,[],f,()=>(S.Month,r()),$=>Z(t,$)),x(j,k)});var W=p(O,2);Y(W,()=>m>30,j=>{var k=ca(),f=c(k);Q(f);var C,K=p(f);y(()=>{var $;return F(K,` ${($=gt())!=null?$:""}`)}),n(k),y(()=>{C!==(C=S.Year)&&(f.value=(f.__value=S.Year)==null?"":S.Year)}),ee(o,[],f,()=>(S.Year,r()),$=>Z(t,$)),x(j,k)});var G=p(W,2);Y(G,()=>m>365,j=>{var k=da(),f=c(k);Q(f);var C,K=p(f);y(()=>{var $;return F(K,` ${($=_t())!=null?$:""}`)}),n(k),y(()=>{C!==(C=S.AllTime)&&(f.value=(f.__value=S.AllTime)==null?"":S.AllTime)}),ee(o,[],f,()=>(S.AllTime,r()),$=>Z(t,$)),x(j,k)}),n(L),x(i,L)},$$slots:{default:!0}});var R=p(u,2);Et(R,{title:e,children:(i,E)=>{var L=ma();jt(L,G=>me(h,G),()=>D(h));var N=c(L);Ct(N,{bounds:b});var O=p(N);At(O);var W=p(O);Nt(W,{bounds:b}),n(L),y(()=>ht(L,"viewBox",`0 0 ${b.width} ${b.height}`)),x(i,L)},$$slots:{default:!0}}),n(d),x(s,d),J()}var ba=T("<!> <!> <!>",1),ga=T('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function _a(s,v){V(v,!1);let a=B(v,"stats",8,null),r=B(v,"showRevlog",8,!0),o=B(v,"fsrsEnabled",24,()=>{var b;return((b=a())==null?void 0:b.memoryState)!=null});X();var w=ga(),h=te(w);Ie(h,()=>({"--gutter-inline":"1rem","--gutter-block":"0.5rem"})),je(h.lastChild,{breakpoint:"md",children:(b,e)=>{var l=ye(),m=te(l);Y(m,a,_=>{var t=ba(),d=te(t);le(d,{children:(i,E)=>{Gt(i,{get stats(){return a()}})},$$slots:{default:!0}});var u=p(d,2);Y(u,r,i=>{le(i,{children:(E,L)=>{na(E,{get revlog(){return a().revlog},get fsrsEnabled(){return o()}})},$$slots:{default:!0}})});var R=p(u,2);Y(R,o,i=>{le(i,{children:(E,L)=>{pa(E,{get revlog(){return a().revlog}})},$$slots:{default:!0}})}),x(_,t)},_=>{Bt(_,{})}),x(b,l)},$$slots:{default:!0}}),n(h),x(s,w),J()}function Ka(s,v){V(v,!1);const a=we(),r=()=>Re(Me,"$page",a);let o=B(v,"data",8);const w=r().url.searchParams.get("revlog")!=="0";X(),_a(s,{get stats(){return o().info},showRevlog:w}),J()}export{Ka as component,ja as universal};
