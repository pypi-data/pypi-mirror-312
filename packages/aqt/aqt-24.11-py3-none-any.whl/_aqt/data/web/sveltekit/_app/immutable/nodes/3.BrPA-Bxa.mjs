var wt=Object.defineProperty;var bt=(l,t,e)=>t in l?wt(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var O=(l,t,e)=>bt(l,typeof t!="symbol"?t+"":t,e);import{r as ht,u as xt,n as It,s as Ct}from"../chunks/backend.fkC9kjAd.mjs";import{aw as St,v as tt,q as Pt,a_ as Ot,a$ as Tt,b0 as kt,b1 as rt,b2 as Ft,b3 as zt,b4 as Bt,b5 as Et,U as Lt,b6 as Mt,b7 as jt,b8 as At}from"../chunks/runtime-require.DNOiO2i-.mjs";import{r as at}from"../chunks/index.C9wOYftf.mjs";import{i as ot,S as et,r as qt}from"../chunks/Select.CuXCm-VX.mjs";import{a as f,b as h,t as _t,e as Dt}from"../chunks/disclose-version.C7Ref1zK.mjs";import{p as D,l as S,s as N,L as M,g as o,a as K,aM as P,P as b,n as Rt,t as L,b as R,m as C,ay as Y,O as g,N as k,M as Wt}from"../chunks/runtime.BreniANL.mjs";import{i as W}from"../chunks/lifecycle.CyW130Fa.mjs";import{p as w,a as G}from"../chunks/props.CyhLJmEU.mjs";import{c as F,C as nt}from"../chunks/Container.BA026blb.mjs";import{s as X,a as J,d as yt}from"../chunks/store.BCoIkSvf.mjs";import{R as U}from"../chunks/Row.Bs46Alvy.mjs";import{L as Ht,S as Gt}from"../chunks/LabelButton.B49ZAgmI.mjs";import{T as lt}from"../chunks/TitledContainer.CEgJrMj0.mjs";import{e as $t,i as Nt}from"../chunks/theme.C2zODCPG.mjs";import{s as A,e as it}from"../chunks/render.DcSgmNQ4.mjs";import{C as Z}from"../chunks/Col.BRw5LzE5.mjs";import{B as Ut}from"../chunks/ButtonToolbar.B1nFHt_L.mjs";import{S as Jt,g as Kt,I as st,c as Qt,d as Vt,e as Xt,m as dt,o as Yt}from"../chunks/Shortcut.DmvJtCcr.mjs";import{t as ct,s as ut}from"../chunks/index.01ZVgqmA.mjs";import{B as Zt}from"../chunks/Badge.CwGJd0Es.mjs";function pt(l){return l.map(t=>t!=null?t:-1)}function ft(l){return l.map(t=>t===-1?null:t)}class vt{constructor(t){O(this,"fields");O(this,"templates");O(this,"oldNotetypeName");O(this,"isCloze");O(this,"info");var s,r,i,d,a,n;this.info=t;const e=(r=(s=t.input)==null?void 0:s.newTemplates)!=null?r:[];this.isCloze=(d=(i=t.input)==null?void 0:i.isCloze)!=null?d:!1,e.length>0&&(this.templates=ft(e)),this.fields=ft((n=(a=t.input)==null?void 0:a.newFields)!=null?n:[]),this.oldNotetypeName=t.oldNotetypeName}mapForContext(t){var e;return t==1?(e=this.templates)!=null?e:[]:this.fields}getOldIndex(t,e){const r=this.mapForContext(t)[e];return r!=null?r:this.getOldNamesIncludingNothing(t).length-1}getOldNamesIncludingNothing(t){return[...this.getOldNames(t),St()]}getOldNames(t){return t==1?this.info.oldTemplateNames:this.info.oldFieldNames}getOldNotetypeName(){return this.info.oldNotetypeName}getNewName(t,e){return(t==1?this.info.newTemplateNames:this.info.newFieldNames)[e]}unusedItems(t){const e=new Set(this.mapForContext(t).filter(d=>d!==null)),s=this.getOldNames(t);return[...Array(s.length).keys()].filter(d=>!e.has(d)).map(d=>s[d])}unchanged(){var t,e;return this.input().newNotetypeId===this.input().oldNotetypeId&&ot(this.fields,[...Array(this.fields.length).keys()])&&ot(this.templates,[...Array((e=(t=this.templates)==null?void 0:t.length)!=null?e:0).keys()])}input(){return this.info.input}intoInput(){const t=this.info.input;return t.newFields=pt(this.fields),this.templates&&(t.newTemplates=pt(this.templates)),t}}var q=(l=>(l[l.Field=0]="Field",l[l.Template=1]="Template",l))(q||{});class te{constructor(t,e){O(this,"info");O(this,"notetypes");O(this,"info_");O(this,"infoSetter");O(this,"notetypeNames");O(this,"notetypesSetter");this.info_=new vt(e),this.info=at(this.info_,s=>{this.infoSetter=s}),this.notetypeNames=t,this.notetypes=at(this.buildNotetypeList(),s=>{this.notetypesSetter=s})}async setTargetNotetypeIndex(t){this.info_.input().newNotetypeId=this.notetypeNames.entries[t].id,this.notetypesSetter(this.buildNotetypeList());const{oldNotetypeId:e,newNotetypeId:s}=this.info_.input(),r=await ht({oldNotetypeId:e,newNotetypeId:s});this.info_=new vt(r),this.info_.unusedItems(0),this.infoSetter(this.info_)}setOldIndex(t,e,s){const r=this.info_.mapForContext(t),i=this.info_.getOldNames(t),d=s<i.length?s:null;if(!(t==0)&&d!==null)for(let n=0;n<r.length;n++)r[n]===d&&(r[n]=null);r[e]=d,this.infoSetter(this.info_)}dataForSaving(){return this.info_.intoInput()}async save(){if(this.info_.unchanged()){alert("No changes to save");return}await xt(this.dataForSaving())}buildNotetypeList(){const t=this.info_.input().newNotetypeId;return this.notetypeNames.entries.map((e,s)=>({idx:s,name:e.name,current:e.id===t}))}}const ee=async({params:l})=>{const[t,e]=l.notetypeIds.split("/"),s=BigInt(t),r=e?BigInt(e):s,i=It({}),d=ht({oldNotetypeId:s,newNotetypeId:r}),[a,n]=await Promise.all([i,d]);return{state:new te(a,n)}},Ze=Object.freeze(Object.defineProperty({__proto__:null,load:ee},Symbol.toStringTag,{value:"Module"}));var se=h('<div class="svelte-1xardfc"></div>');function ne(l){var t=se();f(l,t)}var re=h("<!> <!>",1);function ae(l,t){D(t,!1);const e=X(),s=()=>J(c,"$info",e),r=C(),i=C();let d=w(t,"state",8),a=w(t,"ctx",8),n=w(t,"newIndex",8);const c=d().info;function $(v){N(r,v.detail.value),d().setOldIndex(a(),n(),o(r))}S(()=>(s(),M(a()),M(n())),()=>{N(r,s().getOldIndex(a(),n()))}),S(()=>(s(),M(a()),o(r)),()=>{N(i,s().getOldNamesIncludingNothing(a())[o(r)])}),K(),W(),U(l,{children:(v,x)=>{var p=re(),u=P(p);Z(u,{children:(m,_)=>{var y=Y(()=>s().getOldNamesIncludingNothing(a()));et(m,{get value(){return o(r)},get label(){return o(i)},get list(){return o(y)},$$events:{change:$}})},$$slots:{default:!0}});var I=b(u,2);Z(I,{children:(m,_)=>{Rt();var y=_t();L(()=>A(y,s().getNewName(a(),n()))),f(m,y)},$$slots:{default:!0}}),f(v,p)},$$slots:{default:!0}}),R()}var oe=h('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function mt(l,t){D(t,!1);const e=X(),s=()=>J(d,"$info",e);let r=w(t,"state",8),i=w(t,"ctx",8);const d=r().info;W();var a=oe(),n=P(a);F(n,()=>({"--height":"0.5rem"})),ne(n.lastChild),g(n);var c=b(n,2);F(c,()=>({"--gutter-inline":"0.5rem","--gutter-block":"0.15rem"})),nt(c.lastChild,{children:($,v)=>{var x=Dt(),p=P(x);$t(p,1,()=>s().mapForContext(i()),Nt,(u,I,m)=>{ae(u,{get state(){return r()},get ctx(){return i()},newIndex:m})}),f($,x)},$$slots:{default:!0}}),g(c),f(l,a),R()}var le=h('<div dir="ltr" role="group"><!></div>');function ie(l,t){D(t,!1);const e=C(),s=C();let r=w(t,"id",8,void 0),i=w(t,"class",8,""),d=w(t,"size",8,void 0),a=w(t,"wrap",8,void 0),n=C();S(()=>M(d()),()=>{N(e,d()?`--buttons-size: ${d()}rem; `:"")}),S(()=>M(a()),()=>{a()===void 0?N(n,""):N(n,a()?"--buttons-wrap: wrap; ":"--buttons-wrap: nowrap; ")}),S(()=>(o(e),o(n)),()=>{N(s,o(e)+o(n))}),K();var c=le(),$=k(c);Ct($,t,"default",{}),g(c),L(()=>{var v;tt(c,"id",r()),Pt(c,`button-group btn-group ${(v=i())!=null?v:""} svelte-svn7mu`),tt(c,"style",o(s)),c.dir=c.dir}),f(l,c),R()}var de=h('<div class="save svelte-1polrdz"> </div>'),ce=h('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <!>',1);function ue(l,t){D(t,!1);let e=w(t,"state",8);function s(){document.activeElement instanceof HTMLElement&&document.activeElement.blur(),e().save()}const r="Control+Enter";W(),ie(l,{children:(i,d)=>{var a=ce(),n=P(a),c=Y(()=>Kt(r));F(n,()=>({"--border-left-radius":"5px","--border-right-radius":"5px"})),Ht(n.lastChild,{primary:!0,get tooltip(){return o(c)},$$events:{click:s},children:(v,x)=>{var p=de(),u=k(p);L(()=>A(u,Ot())),g(p),f(v,p)},$$slots:{default:!0}}),g(n);var $=b(n,2);Jt($,{keyCombination:r,$$events:{action:s}}),f(i,a)},$$slots:{default:!0}}),R()}var pe=h('<div class="d-flex flex-row w-100"><!> <div class="arrow-container svelte-ng49hq"><!></div> <!></div> <!>',1);function fe(l,t){D(t,!1);const e=X(),s=()=>J(n,"$notetypes",e),r=()=>J(c,"$info",e),i=C(),d=C();let a=w(t,"state",8);const n=a().notetypes,c=a().info;let $=C(s().findIndex(v=>v.current));S(()=>s(),()=>{N(i,Array.from(s(),v=>v.name))}),S(()=>(o(i),o($)),()=>{N(d,o(i)[o($)])}),S(()=>(M(a()),o($)),()=>{a().setTargetNotetypeIndex(o($))}),K(),W(),Ut(l,{class:"justify-content-between",wrap:!1,children:(v,x)=>{var p=pe(),u=P(p),I=k(u);et(I,{get label(){return r().oldNotetypeName},value:1,list:[1],disabled:!0});var m=b(I,2),_=k(m);G(_,()=>window.getComputedStyle(document.body).direction=="rtl",B=>{st(B,{icon:Vt})},B=>{st(B,{icon:Qt})}),g(m);var y=b(m,2);et(y,{get list(){return o(i)},get value(){return o($)},set value(B){N($,B)},get label(){return o(d)},$$legacy:!0}),g(u);var z=b(u,2);ue(z,{get state(){return a()}}),f(v,p)},$$slots:{default:!0}}),R()}var ve=h('<div class="clickable svelte-18ivrjn" role="button" tabindex="0"><!> </div>'),me=h("<div> <!></div>"),ge=h("<li> </li>"),he=h("<ul></ul>"),_e=h('<div class="alert alert-warning"><!> <!></div>');function ye(l,t){D(t,!1);const e=C(),s=C();let r=w(t,"unused",8),i=w(t,"ctx",8),d=C();const a=3;let n=C(!0);S(()=>(M(i()),rt),()=>{N(d,i()===q.Field?Tt():kt())}),S(()=>(o(n),rt),()=>{N(e,o(n)?Ft():zt())}),S(()=>(o(n),dt),()=>{N(s,o(n)?Xt:dt)}),K(),W();var c=_e(),$=k(c);G($,()=>r().length>a,p=>{var u=ve(),I=Wt(()=>Yt(()=>N(n,!o(n)))),m=k(u);Zt(m,{iconSize:80,children:(y,z)=>{st(y,{get icon(){return o(s)}})},$$slots:{default:!0}});var _=b(m);g(u),L(()=>{var y;tt(u,"aria-expanded",!o(n)),A(_,` ${(y=o(e))!=null?y:""}`)}),it("click",u,()=>N(n,!o(n))),it("keydown",u,function(...y){var z;(z=o(I))==null||z.apply(this,y)}),f(p,u)});var v=b($),x=b(v);G(x,()=>o(n),p=>{var u=me(),I=k(u);L(()=>{var _;return A(I,`${(_=r().slice(0,a).join(", "))!=null?_:""} `)});var m=b(I);G(m,()=>r().length>a,_=>{var y=_t();L(()=>A(y,`... (+${r().length-a})`)),f(_,y)}),g(u),f(p,u)},p=>{var u=he();$t(u,5,r,Nt,(I,m)=>{var _=ge(),y=k(_);g(_),L(()=>A(y,o(m))),f(I,_)}),g(u),f(p,u)}),g(c),L(()=>{var p;return A(v,` ${(p=o(d))!=null?p:""} `)}),ct(1,c,()=>ut),ct(2,c,()=>ut),f(l,c),R()}var $e=h("<b> </b>"),Ne=h("<b> </b>"),we=h('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),be=h('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),xe=h('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Ie=h("<!> <!>",1);function gt(l,t){D(t,!1);const e=X(),s=()=>J(o(r),"$info",e),r=C(),i=C();let d=w(t,"state",8),a=w(t,"ctx",8);S(()=>M(d()),()=>{yt(N(r,d().info),"$info",e)}),S(()=>(s(),M(a()),q),()=>{N(i,s().isCloze&&a()===q.Template?[]:s().unusedItems(a()))}),K(),W();var n=Ie(),c=P(n);G(c,()=>o(i).length>0,v=>{ye(v,{get unused(){return o(i)},get ctx(){return a()}})});var $=b(c,2);G($,()=>s().templates||a()===q.Field,v=>{var x=xe(),p=P(x);F(p,()=>({"--gutter-inline":"0.5rem","--gutter-block":"0.2rem"})),nt(p.lastChild,{children:(u,I)=>{var m=be(),_=P(m);F(_,()=>({"--cols":2})),U(_.lastChild,{children:(y,z)=>{var B=we(),E=P(B);F(E,()=>({"--col-size":1})),Z(E.lastChild,{children:(H,Q)=>{var T=$e(),V=k(T);L(()=>A(V,Bt())),g(T),f(H,T)},$$slots:{default:!0}}),g(E);var j=b(E,2);F(j,()=>({"--col-size":1})),Z(j.lastChild,{children:(H,Q)=>{var T=Ne(),V=k(T);L(()=>A(V,Et())),g(T),f(H,T)},$$slots:{default:!0}}),g(j),f(y,B)},$$slots:{default:!0}}),g(_),f(u,m)},$$slots:{default:!0}}),g(p),f(v,x)}),f(l,n),R()}var Ce=h("<!> <!>",1),Se=h("<div><!></div>"),Pe=h("<!> <!>",1),Oe=h('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Te=h('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function ke(l,t){D(t,!1);const e=X(),s=()=>J(o(r),"$info",e),r=C();let i=w(t,"state",8);S(()=>M(i()),()=>{yt(N(r,i().info),"$info",e)}),K(),W();var d=Te(),a=P(d);F(a,()=>({"--gutter-block":"0.5rem","--gutter-inline":"0.25rem","--sticky-borders":"0 0 1px"})),Gt(a.lastChild,{breakpoint:"sm",children:(c,$)=>{fe(c,{get state(){return i()}})},$$slots:{default:!0}}),g(a);var n=b(a,2);F(n,()=>({"--gutter-inline":"0.25rem","--gutter-block":"0.75rem"})),nt(n.lastChild,{breakpoint:"sm",children:(c,$)=>{var v=Oe(),x=P(v);F(x,()=>({"--cols":2})),U(x.lastChild,{children:(u,I)=>{var m=Y(()=>jt());lt(u,{get title(){return o(m)},children:(_,y)=>{U(_,{children:(z,B)=>{var E=Ce(),j=P(E);gt(j,{get state(){return i()},get ctx(){return q.Field}});var H=b(j,2);mt(H,{get state(){return i()},get ctx(){return q.Field}}),f(z,E)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}}),g(x);var p=b(x,2);F(p,()=>({"--cols":2})),U(p.lastChild,{children:(u,I)=>{var m=Y(()=>At());lt(u,{get title(){return o(m)},children:(_,y)=>{U(_,{children:(z,B)=>{var E=Pe(),j=P(E);gt(j,{get state(){return i()},get ctx(){return q.Template}});var H=b(j,2);G(H,()=>s().templates,Q=>{mt(Q,{get state(){return i()},get ctx(){return q.Template}})},Q=>{var T=Se(),V=k(T);Lt(V,()=>qt(Mt()),!1,!1),g(T),f(Q,T)}),f(z,E)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}}),g(p),f(c,v)},$$slots:{default:!0}}),g(n),f(l,d),R()}function ts(l,t){D(t,!1);let e=w(t,"data",8);W(),ke(l,{get state(){return e().state}}),R()}export{ts as component,Ze as universal};
