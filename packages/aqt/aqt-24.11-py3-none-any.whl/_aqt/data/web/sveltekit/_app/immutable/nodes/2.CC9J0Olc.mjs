import{n as Me,R as P}from"../chunks/backend.DRML5B1x.mjs";import{a as R,d as F,r as o,e as d,s,D as $e,F as re,M as Ie}from"../chunks/disclose-version.CXWUuFGG.mjs";import{p as J,t as S,b as X,l as ue,a as me,g as K,m as fe,s as pe,N as we,ag as j}from"../chunks/runtime.BJSnJeWl.mjs";import{i as Z}from"../chunks/lifecycle.DW1_rEFA.mjs";import{p as W,i as B}from"../chunks/props.fkJSEmZ6.mjs";import{s as xe,b as ee,a as Re}from"../chunks/store.CAPRemx4.mjs";import{p as je}from"../chunks/stores.DsH-glSA.mjs";import{c as Pe,C as Ke}from"../chunks/Container.DdPX9a09.mjs";import{R as oe}from"../chunks/Row.COIbe2Oq.mjs";import{s as L}from"../chunks/render.CQvFnAiW.mjs";import{V as Ye,W as Be,X as We,Y as Oe,Z as Ge,_ as ze,$ as De,a0 as Le,a1 as Ve,a2 as Fe,a3 as Te,a4 as Ue,a5 as He,a6 as Je,a7 as Xe,a8 as Ze,a9 as Qe,aa as et,ab as tt,ac as at,ad as rt,ae as st,af as it,ag as lt,ah as nt,q as Se,ai as ot,aj as vt,ak as ct,al as dt,am as ut,an as mt,ao as ft,ap as pt,v as gt,aq as te,ar as bt,as as _t,at as ht,au as yt}from"../chunks/runtime-require.XfVPIJtJ.mjs";import{e as U,i as H}from"../chunks/theme.B6Eko5I8.mjs";import{t as Y,D as St,T as ke}from"../chunks/time.BdBxgeyd.mjs";import{y as $t,z as ve,A as wt,B as xt,C as Rt,D as Dt,E as Lt,F as Ft,G as Tt,H as kt,I as Ct,J as At,K as Et,N as Nt,L as qt}from"../chunks/HoverColumns.Do1LJyhv.mjs";import{m as Mt,I as It}from"../chunks/InputBox.BlOEgdEi.mjs";import{t as jt}from"../chunks/time.BSwB_FiG.mjs";import{b as ae}from"../chunks/input.CShFEa0B.mjs";import{b as Pt}from"../chunks/this.C9pg2j_S.mjs";import{w as Kt}from"../chunks/index.BB25h7Qo.mjs";const Yt=async({params:l})=>({info:await Me({cid:BigInt(l.cardId)})}),Pa=Object.freeze(Object.defineProperty({__proto__:null,load:Yt},Symbol.toStringTag,{value:"Module"}));var Bt=F('<div class="card-info-placeholder svelte-1k3aa26"> </div>');function Wt(l,c){J(c,!1),Z();var a=Bt(),r=d(a);S(()=>L(r,Ye())),o(a),R(l,a),X()}var Ot=F('<tr><th class="align-start svelte-1ws7hzc"> </th><td> </td></tr>'),Gt=F('<table class="stats-table align-start svelte-1ws7hzc"><tbody></tbody></table>');function zt(l,c){J(c,!1);let a=W(c,"stats");function r(e){return new ke(Number(e)).dateString()}function v(e){const n=[];if(n.push({label:Be(),value:r(e.added)}),e.firstReview!=null&&n.push({label:We(),value:r(e.firstReview)}),e.latestReview!=null&&n.push({label:Oe(),value:r(e.latestReview)}),e.dueDate!=null&&n.push({label:Ge(),value:r(e.dueDate)}),e.duePosition!=null&&n.push({label:ze(),value:e.duePosition}),e.interval&&n.push({label:De(),value:Y(e.interval*St)}),e.memoryState){let _=Y(e.memoryState.stability*86400,!1,!1);if(e.memoryState.stability>31){const u=e.memoryState.stability.toFixed(0);_+=` (${u})`}n.push({label:Le(),value:_});const t=((e.memoryState.difficulty-1)/9*100).toFixed(0);if(n.push({label:Ve(),value:`${t}%`}),e.fsrsRetrievability){const u=(e.fsrsRetrievability*100).toFixed(0);n.push({label:Fe(),value:`${u}%`})}}else e.ease&&n.push({label:Te(),value:`${e.ease/10}%`});n.push({label:Ue(),value:e.reviews}),n.push({label:He(),value:e.lapses}),e.totalSecs&&(n.push({label:Je(),value:Y(e.averageSecs)}),n.push({label:Xe(),value:Y(e.totalSecs)})),n.push({label:Ze(),value:e.cardType}),n.push({label:Qe(),value:e.notetype});let g;if(e.originalDeck?g=`${e.deck} (${e.originalDeck})`:g=e.deck,n.push({label:et(),value:g}),n.push({label:tt(),value:e.preset}),n.push({label:at(),value:e.cardId}),n.push({label:rt(),value:e.noteId}),e.customData){let _;try{const t=JSON.parse(e.customData);_=Object.entries(t).map(([u,m])=>`${u}=${m}`).join(" ")}catch{_=e.customData}n.push({label:st(),value:_})}return n}let w=fe();ue(()=>we(a()),()=>{pe(w,v(a()))}),me(),Z();var h=Gt(),p=d(h);U(p,9,()=>K(w),H,(e,n,g)=>{var _=Ot(),t=d(_),u=d(t);o(t);var m=s(t),y=d(m);o(m),o(_),S(()=>{L(u,j(n).label),L(y,j(n).value)}),R(e,_)}),o(p),o(h),R(l,h),X()}const Vt=19/81,Ut=-.5,Ht=1e3;function ce(l,c){return Math.pow(c/l*Vt+1,Ut)}var $=(l=>(l[l.Week=0]="Week",l[l.Month=1]="Month",l[l.Year=2]="Year",l[l.AllTime=3]="AllTime",l))($||{});const Jt={0:7,1:30,2:365,3:1/0};function Xt(l,c){return l.filter(a=>a.daysSinceFirstLearn<=c)}function de(l){return l.reviewKind!==P.MANUAL&&(l.reviewKind!==P.FILTERED||l.ease!==0)}function Zt(l){const c=[];for(const a of l){if(a.reviewKind===P.MANUAL&&a.ease===0)break;c.push(a)}return c.filter(a=>de(a))}function Qt(l,c){const a=[];let r=0,v=0;const w=Math.min(c/Ht,1);let h=0;if(l.toReversed().forEach((t,u)=>{var k,D;const m=Number(t.time);if(u===0){r=m,v=((k=t.memoryState)==null?void 0:k.stability)||0,a.push({date:new Date(m*1e3),daysSinceFirstLearn:0,elapsedDaysSinceLastReview:0,retrievability:100,stability:v});return}const y=(m-r)/(24*60*60);let i=0;for(;i<y-w;){i+=w;const E=ce(v,i);a.push({date:new Date((r+i*86400)*1e3),daysSinceFirstLearn:a[a.length-1].daysSinceFirstLearn+w,elapsedDaysSinceLastReview:i,retrievability:E*100,stability:v})}h+=y,a.push({date:new Date((r+y*86400)*1e3),daysSinceFirstLearn:h,retrievability:100,elapsedDaysSinceLastReview:0,stability:v}),r=m,v=((D=t.memoryState)==null?void 0:D.stability)||0}),a.length===0)return[];const p=Date.now()/1e3,e=(p-r)/(24*60*60);let n=0;for(;n<e-w;){n+=w;const t=ce(v,n);a.push({date:new Date((r+n*86400)*1e3),daysSinceFirstLearn:a[a.length-1].daysSinceFirstLearn+w,elapsedDaysSinceLastReview:n,retrievability:t*100,stability:v})}h+=e;const g=ce(v,e);return a.push({date:new Date(p*1e3),daysSinceFirstLearn:h,elapsedDaysSinceLastReview:e,retrievability:g*100,stability:v}),Xt(a,c)}function Ce(l,c){if(l.length===0)return 0;const a=(Date.now()/1e3-Number(l[l.length-1].time))/(24*60*60);return Math.min(a,Jt[c])}function ea(l,c,a,r){const v=$t(a),w=v.transition().duration(600);if(l.length===0){ve(v,!1);return}const h=Ce(l,c),p=Qt(l,h);if(p.length===0){ve(v,!1);return}else ve(v,!0);v.select(".forgetting-curve-line").remove(),v.select(".hover-columns").remove();const e=Mt(p,i=>i.date),n=wt(p,i=>i.date),g=jt().domain([e,n]).range([r.marginLeft,r.width-r.marginRight]),_=Math.max(0,100-1.2*(100-Math.min(...p.map(i=>i.retrievability)))),t=xt().domain([_,100]).range([r.height-r.marginBottom,r.marginTop]);v.select(".x-ticks").call(i=>i.transition(w).call(Rt(g).ticks(5).tickSizeOuter(0))).attr("direction","ltr"),v.select(".y-ticks").attr("transform",`translate(${r.marginLeft},0)`).call(i=>i.transition(w).call(Dt(t).tickSizeOuter(0))).attr("direction","ltr");const u=Lt().x(i=>g(i.date)).y(i=>t(i.retrievability));v.append("path").datum(p).attr("class","forgetting-curve-line").attr("fill","none").attr("stroke","steelblue").attr("stroke-width",1.5).attr("d",u);const m=v.append("line").attr("class","focus-line").attr("y1",r.marginTop).attr("y2",r.height-r.marginBottom).attr("stroke","black").attr("stroke-width",1).style("opacity",0);function y(i){return`${h>=365?"Date":"Date Time"}: ${h>=365?i.date.toLocaleDateString():i.date.toLocaleString()}<br>
        ${it()}: ${Y(i.elapsedDaysSinceLastReview*86400)}<br>${Fe()}: ${i.retrievability.toFixed(2)}%<br>${Le()}: ${Y(i.stability*86400)}`}v.append("g").attr("class","hover-columns").selectAll("rect").data(p).join("rect").attr("x",i=>g(i.date)-1).attr("y",r.marginTop).attr("width",2).attr("height",r.height-r.marginTop-r.marginBottom).attr("fill","transparent").on("mousemove",(i,k)=>{const[D,E]=Ft(i,document.body);m.attr("x1",g(k.date)-1).attr("x2",g(k.date)+1).style("opacity",1),Tt(y(k),D,E)}).on("mouseout",()=>{m.style("opacity",0),kt()})}var ta=F('<div class="svelte-1bf093q"><b> </b> <span class="hidden-xs svelte-1bf093q"> </span></div>'),aa=F("<div> </div>"),ra=F("<div> </div>"),sa=F('<div class="svelte-1bf093q"> </div>'),ia=F('<div class="svelte-1bf093q"> </div>'),la=F('<div class="svelte-1bf093q"> </div>'),na=F('<div class="revlog-table svelte-1bf093q"><div class="column svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content svelte-1bf093q"></div></div> <div class="column hidden-xs svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content svelte-1bf093q"></div></div> <div class="column svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content svelte-1bf093q"></div></div> <div class="column svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content right svelte-1bf093q"></div></div> <div class="column hidden-xs svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content svelte-1bf093q"></div></div> <div class="column svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content right svelte-1bf093q"></div></div> <!></div>');function oa(l,c){J(c,!1);const a=fe();let r=W(c,"revlog"),v=W(c,"fsrsEnabled",0,!1);function w(t){switch(t.reviewKind){case P.LEARNING:return"revlog-learn";case P.REVIEW:return"revlog-review";case P.RELEARNING:return"revlog-relearn"}return""}function h(t){switch(t.reviewKind){case P.LEARNING:return ft();case P.REVIEW:return mt();case P.RELEARNING:return ut();case P.FILTERED:return dt();case P.MANUAL:return ct()}}function p(t){return t.buttonChosen===1?"revlog-ease1":""}function e(t,u){var y;const m=new ke(Number(t.time));return{date:m.dateString(),time:m.timeString(),reviewKind:h(t),reviewKindClass:w(t),rating:t.buttonChosen,ratingClass:p(t),interval:Y(t.interval),ease:n(t.ease),takenSecs:Y(t.takenSecs,!0),elapsedTime:u,stability:(y=t.memoryState)!=null&&y.stability?Y(t.memoryState.stability*86400):""}}function n(t){if(t===0)return"";const u=t/10;return u<=110?`D:${(u-10).toFixed(0)}%`:`${u.toFixed(0)}%`}ue(()=>we(r()),()=>{pe(a,r().map((t,u)=>{let m,y=u+1;for(;y<r().length;){if(de(r()[y])){m=r()[y];break}y++}let i="N/A";return de(t)&&(i=m?Y(Number(t.time)-Number(m.time)):"0"),e(t,i)}))}),me(),Z();var g=$e(),_=re(g);B(_,()=>r().length>0,t=>{var u=na(),m=d(u),y=d(m),i=d(y);S(()=>L(i,lt())),o(y);var k=s(s(y,!0));U(k,9,()=>K(a),H,(q,A,Q)=>{var b=ta(),N=d(b),V=d(N);o(N);var he=s(s(N,!0)),qe=d(he);o(he),o(b),S(()=>{var ye;L(V,j(A).date),L(qe,`@ ${(ye=j(A).time)!=null?ye:""}`)}),R(q,b)}),o(k),o(m);var D=s(s(m,!0)),E=d(D),O=d(E);S(()=>L(O,nt())),o(E);var G=s(s(E,!0));U(G,9,()=>K(a),H,(q,A,Q)=>{var b=aa(),N=d(b);o(b),S(()=>{var V;Se(b,`${(V=j(A).reviewKindClass)!=null?V:""} svelte-1bf093q`),L(N,j(A).reviewKind)}),R(q,b)}),o(G),o(D);var z=s(s(D,!0)),M=d(z),T=d(M);S(()=>L(T,ot())),o(M);var f=s(s(M,!0));U(f,9,()=>K(a),H,(q,A,Q)=>{var b=ra(),N=d(b);o(b),S(()=>{var V;Se(b,`${(V=j(A).ratingClass)!=null?V:""} svelte-1bf093q`),L(N,j(A).rating)}),R(q,b)}),o(f),o(z);var C=s(s(z,!0)),I=d(C),x=d(I);S(()=>L(x,De())),o(I);var ge=s(s(I,!0));U(ge,9,()=>K(a),H,(q,A,Q)=>{var b=sa(),N=d(b);o(b),S(()=>L(N,j(A).interval)),R(q,b)}),o(ge),o(C);var se=s(s(C,!0)),ie=d(se),Ae=d(ie);S(()=>L(Ae,Te())),o(ie);var be=s(s(ie,!0));U(be,9,()=>K(a),H,(q,A,Q)=>{var b=ia(),N=d(b);o(b),S(()=>L(N,j(A).ease)),R(q,b)}),o(be),o(se);var le=s(s(se,!0)),ne=d(le),Ee=d(ne);S(()=>L(Ee,vt())),o(ne);var _e=s(s(ne,!0));U(_e,9,()=>K(a),H,(q,A,Q)=>{var b=la(),N=d(b);o(b),S(()=>L(N,j(A).takenSecs)),R(q,b)}),o(_e),o(le);var Ne=s(s(le,!0));B(Ne,v,q=>{}),o(u),R(t,u)}),R(l,g),X()}var va=F('<label class="svelte-6ja67r"><input type="radio" class="svelte-6ja67r"> </label>'),ca=F('<label class="svelte-6ja67r"><input type="radio" class="svelte-6ja67r"> </label>'),da=F('<label class="svelte-6ja67r"><input type="radio" class="svelte-6ja67r"> </label>'),ua=F('<label class="svelte-6ja67r"><input type="radio" class="svelte-6ja67r"> </label>'),ma=F('<div class="time-range-selector svelte-6ja67r"><!> <!> <!> <!></div>'),fa=Ie("<svg><!><!><!></svg>"),pa=F('<div class="forgetting-curve svelte-6ja67r"><!> <!></div>');function ga(l,c){J(c,!1);const a=xe(),r=()=>Re(t,"$timeRange",a),v=[];let w=W(c,"revlog"),h=fe(null);const p=qt(),e=pt(),n=Zt(w()),g=Ce(n,$.AllTime);let _=$.Week;g>365?_=$.AllTime:g>30?_=$.Year:g>7&&(_=$.Month);const t=Kt(_);ue(()=>(r(),K(h)),()=>{ea(n,r(),K(h),p)}),me(),Z();var u=pa(),m=d(u);It(m,{children:(i,k)=>{var D=ma(),E=d(D);B(E,()=>g>0,M=>{var T=va(),f=d(T);te(f);var C,I=s(f,!0);S(()=>{var x;return L(I,` ${(x=bt())!=null?x:""}`)}),o(T),S(()=>{C!==(C=$.Week)&&(f.value=(f.__value=$.Week)==null?"":$.Week)}),ae(v,[],f,()=>($.Week,r()),x=>ee(t,x)),R(M,T)});var O=s(s(E,!0));B(O,()=>g>7,M=>{var T=ca(),f=d(T);te(f);var C,I=s(f,!0);S(()=>{var x;return L(I,` ${(x=_t())!=null?x:""}`)}),o(T),S(()=>{C!==(C=$.Month)&&(f.value=(f.__value=$.Month)==null?"":$.Month)}),ae(v,[],f,()=>($.Month,r()),x=>ee(t,x)),R(M,T)});var G=s(s(O,!0));B(G,()=>g>30,M=>{var T=da(),f=d(T);te(f);var C,I=s(f,!0);S(()=>{var x;return L(I,` ${(x=ht())!=null?x:""}`)}),o(T),S(()=>{C!==(C=$.Year)&&(f.value=(f.__value=$.Year)==null?"":$.Year)}),ae(v,[],f,()=>($.Year,r()),x=>ee(t,x)),R(M,T)});var z=s(s(G,!0));B(z,()=>g>365,M=>{var T=ua(),f=d(T);te(f);var C,I=s(f,!0);S(()=>{var x;return L(I,` ${(x=yt())!=null?x:""}`)}),o(T),S(()=>{C!==(C=$.AllTime)&&(f.value=(f.__value=$.AllTime)==null?"":$.AllTime)}),ae(v,[],f,()=>($.AllTime,r()),x=>ee(t,x)),R(M,T)}),o(D),R(i,D)},$$slots:{default:!0},$$legacy:!0});var y=s(s(m,!0));Ct(y,{title:e,children:(i,k)=>{var D=fa();Pt(D,z=>pe(h,z),()=>K(h));var E=d(D);At(E,{bounds:p,$$legacy:!0});var O=s(E);Et(O);var G=s(O);Nt(G,{bounds:p,$$legacy:!0}),o(D),S(()=>gt(D,"viewBox",`0 0 ${p.width} ${p.height}`)),R(i,D)},$$slots:{default:!0},$$legacy:!0}),o(u),R(l,u),X()}var ba=F("<!> <!> <!>",1),_a=F('<div style="display: contents"><!></div>',1);function ha(l,c){J(c,!1);let a=W(c,"stats",0,null),r=W(c,"showRevlog",0,!0),v=W(c,"fsrsEnabled",8,()=>{var p;return((p=a())==null?void 0:p.memoryState)!=null});Z();var w=_a(),h=re(w);Pe(h,()=>({"--gutter-inline":"1rem","--gutter-block":"0.5rem"})),Ke(h.lastChild,{breakpoint:"md",children:(p,e)=>{var n=$e(),g=re(n);B(g,a,_=>{var t=ba(),u=re(t);oe(u,{children:(i,k)=>{zt(i,{get stats(){return a()},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0});var m=s(s(u,!0));B(m,r,i=>{oe(i,{children:(k,D)=>{oa(k,{get revlog(){return a().revlog},get fsrsEnabled(){return v()},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0})});var y=s(s(m,!0));B(y,v,i=>{oe(i,{children:(k,D)=>{ga(k,{get revlog(){return a().revlog},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0})}),R(_,t)},_=>{Wt(_,{$$legacy:!0})}),R(p,n)},$$slots:{default:!0},$$legacy:!0}),o(h),R(l,w),X()}function Ka(l,c){J(c,!1);const a=xe(),r=()=>Re(je,"$page",a);let v=W(c,"data");const w=r().url.searchParams.get("revlog")!=="0";Z(),ha(l,{get stats(){return v().info},showRevlog:w,$$legacy:!0}),X()}export{Ka as component,Pa as universal};
