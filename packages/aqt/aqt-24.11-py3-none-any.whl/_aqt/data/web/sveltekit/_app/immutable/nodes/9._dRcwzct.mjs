var jt=Object.defineProperty;var At=(a,t,e)=>t in a?jt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var k=(a,t,e)=>At(a,typeof t!="symbol"?t+"":t,e);import{j as kt,k as Lt,m as Dt,n as Ft,o as Gt,C as J,p as gt,q as Nt,s as Vt}from"../chunks/backend.fkC9kjAd.mjs";import{aw as Ut,ax as yt,ay as Ht,az as zt,aA as Wt,aB as qt,aC as Bt,aD as Kt,aE as Yt,aF as Jt,aG as Qt,aH as Xt,aI as Zt,aJ as te,aK as ee,aL as ae,aM as le,aN as se,aO as oe,aP as Ct,aQ as re,aR as ie,aS as ne,aT as ue,aU as de,aV as ce,aW as pe,aX as me,aY as $e,aZ as ve,K as It}from"../chunks/runtime-require.DNOiO2i-.mjs";import{w as ct,r as Ot}from"../chunks/index.C9wOYftf.mjs";import{c as tt}from"../chunks/cloneDeep.CihkQVl_.mjs";import{i as dt,S as ge}from"../chunks/Select.CuXCm-VX.mjs";import{t as F,a as c,b as M,e as ht}from"../chunks/disclose-version.C7Ref1zK.mjs";import{p as W,l as fe,a as he,aM as j,t as x,g as $,b as q,n as G,O as P,P as T,m as ot,s as rt,L as Pt,D as N,ay as w,N as et}from"../chunks/runtime.BreniANL.mjs";import{i as B}from"../chunks/lifecycle.CyW130Fa.mjs";import{p as S,a as bt}from"../chunks/props.CyhLJmEU.mjs";import{R as st}from"../chunks/Row.Bs46Alvy.mjs";import{I as be}from"../chunks/ImportPage.BEIXsXoy.mjs";import{a as ye}from"../chunks/await.DTvHgvMC.mjs";import{e as pt,i as mt}from"../chunks/theme.C2zODCPG.mjs";import{s as it,c as V,a as R,b as xt}from"../chunks/store.BCoIkSvf.mjs";import{T as _t}from"../chunks/TitledContainer.CEgJrMj0.mjs";import{s as E}from"../chunks/render.DcSgmNQ4.mjs";import{c as Q}from"../chunks/Container.BA026blb.mjs";import{C as $t}from"../chunks/Col.BRw5LzE5.mjs";import{H as L,E as lt,a as z,S as _e,b as Et,C as ke,R as Ne}from"../chunks/EnumSelectorRow.ChOxUdBm.mjs";import{T as Ce}from"../chunks/TagEditor.Cppc39MH.mjs";function Tt(){}function Y(a){return a.notetype.case==="globalNotetype"?a.notetype.value:null}function ft(a){return a.deck.case==="deckId"?a.deck.value:null}class Ie{constructor(t,e,s,l){k(this,"path");k(this,"deckNameIds");k(this,"notetypeNameIds");k(this,"defaultDelimiter");k(this,"defaultIsHtml");k(this,"defaultNotetypeId");k(this,"defaultDeckId");k(this,"metadata");k(this,"globalNotetype");k(this,"deckId");k(this,"fieldNames");k(this,"columnOptions");k(this,"lastMetadata");k(this,"lastGlobalNotetype");k(this,"lastDeckId");k(this,"fieldNamesSetter",Tt);k(this,"columnOptionsSetter",Tt);var r;this.path=t,this.deckNameIds=s.entries,this.notetypeNameIds=e.entries,this.lastMetadata=tt(l),this.metadata=ct(l),this.metadata.subscribe(this.onMetadataChanged.bind(this));const o=Y(l);this.lastGlobalNotetype=tt(Y(l)),this.globalNotetype=ct(tt(o)),this.globalNotetype.subscribe(this.onGlobalNotetypeChanged.bind(this)),this.lastDeckId=ft(l),this.deckId=ct(ft(l)),this.deckId.subscribe(this.onDeckIdChanged.bind(this)),this.fieldNames=Ot(o===null?Promise.resolve([]):kt({ntid:o.id}).then(i=>i.vals),i=>{this.fieldNamesSetter=i}),this.columnOptions=Ot(wt(l),i=>{this.columnOptionsSetter=i}),this.defaultDelimiter=l.delimiter,this.defaultIsHtml=l.isHtml,this.defaultNotetypeId=((r=this.lastGlobalNotetype)==null?void 0:r.id)||null,this.defaultDeckId=this.lastDeckId}doImport(){return Lt({path:this.path,metadata:{...this.lastMetadata,preview:[]}},{alertOnError:!1})}async onMetadataChanged(t){var l,o,r;if(dt(t,this.lastMetadata))return;const e=this.shouldRefetchMetadata(t);e&&(t=await Dt({path:this.path,delimiter:t.delimiter,notetypeId:(l=Y(t))==null?void 0:l.id,deckId:(o=ft(t))!=null?o:void 0,isHtml:t.isHtml}));const s=Y(t);this.globalNotetype.set(s),s!==null&&s.id!==((r=Y(this.lastMetadata))==null?void 0:r.id)&&this.fieldNamesSetter(kt({ntid:s.id}).then(i=>i.vals)),this.shouldRebuildColumnOptions(t)&&this.columnOptionsSetter(wt(t)),this.lastMetadata=tt(t),e&&this.metadata.set(t)}shouldRefetchMetadata(t){var e,s;return t.delimiter!==this.lastMetadata.delimiter||t.isHtml!==this.lastMetadata.isHtml||((e=Y(t))==null?void 0:e.id)!==((s=Y(this.lastMetadata))==null?void 0:s.id)}shouldRebuildColumnOptions(t){return!dt(t.columnLabels,this.lastMetadata.columnLabels)||!dt(t.preview[0],this.lastMetadata.preview[0])}onGlobalNotetypeChanged(t){dt(t,this.lastGlobalNotetype)||(this.lastGlobalNotetype=tt(t),t!==null&&this.metadata.update(e=>(e.notetype.value=t,e)))}onDeckIdChanged(t){t!==this.lastDeckId&&(this.lastDeckId=t,t!==null&&this.metadata.update(e=>(e.deck.value=t,e)))}}function wt(a){const t=Pe(a),e=Oe(a);return[{label:Ut(),value:0,disabled:!1}].concat(a.columnLabels.map((s,l)=>(l+=1,l===t?at(yt(),!0,l):l===e?at(Ht(),!0,l):l===a.guidColumn?at("GUID",!0,l):s===""?at(a.preview[0].vals[l-1],!1,l,!0):at(s,!1,l))))}function at(a,t,e,s){return{label:a?`${e}: ${a}`:e.toString(),shortLabel:s?e.toString():void 0,value:e,disabled:t}}function Oe(a){return a.deck.case==="deckColumn"?a.deck.value:null}function Pe(a){return a.notetype.case==="notetypeColumn"?a.notetype.value:null}const Te=async({params:a})=>{const[t,e,s]=await Promise.all([Ft({}),Gt({skipEmptyDefault:!1,includeFiltered:!1}),Dt({path:a.path},{alertOnError:!1})]);return{state:new Ie(a.path,t,e,s)}},ga=Object.freeze(Object.defineProperty({__proto__:null,load:Te},Symbol.toStringTag,{value:"Module"}));var we=M('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Se=M('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function St(a,t){W(t,!1);const e=ot();let s=S(t,"label",8),l=S(t,"columnOptions",8),o=S(t,"value",12);fe(()=>(Pt(l()),Pt(o())),()=>{var v;rt(e,(v=l().find(d=>d.value===o()))==null?void 0:v.label)}),he(),B();var r=Se(),i=j(r);Q(i,()=>({"--cols":2})),st(i.lastChild,{children:(v,d)=>{var n=we(),O=j(n);Q(O,()=>({"--col-size":1})),$t(O.lastChild,{children:(b,p)=>{G();var u=F();x(()=>E(u,s())),c(b,u)},$$slots:{default:!0}}),P(O);var h=T(O,2);Q(h,()=>({"--col-size":1})),$t(h.lastChild,{children:(b,p)=>{ge(b,{get value(){return o()},set value(u){o(u)},get label(){return $(e)},get list(){return l()},parser:u=>({content:u.label,value:u.value,disabled:u.disabled}),$$legacy:!0})},$$slots:{default:!0}}),P(h),c(v,n)},$$slots:{default:!0}}),P(i),c(a,r),q()}var Me=M("<!> <!>",1);function De(a,t){W(t,!1);const e=it(),s=()=>R(d,"$globalNotetype",e),l=()=>R(n,"$fieldNamesPromise",e),o=()=>R(O,"$columnOptions",e),r=()=>R(v,"$metadata",e);let i=S(t,"state",8);const v=i().metadata,d=i().globalNotetype,n=i().fieldNames,O=i().columnOptions;B();var h=w(()=>zt());_t(a,{get title(){return $(h)},children:(b,p)=>{var u=Me(),C=j(u);bt(C,()=>s()!==null,m=>{var K=ht(),U=j(K);ye(U,l,null,(X,A)=>{var nt=ht(),ut=j(nt);pt(ut,1,()=>$(A),mt,(vt,g,D)=>{var f=w(()=>D===0?o().slice(1):o());St(vt,{get label(){return $(g)},get columnOptions(){return $(f)},get value(){return s().fieldColumns[D]},set value(H){V(d,N(s).fieldColumns[D]=H,N(s))},$$legacy:!0})}),c(X,nt)}),c(m,K)});var y=T(C,2),_=w(()=>Wt());St(y,{get label(){return $(_)},get columnOptions(){return o()},get value(){return r().tagsColumn},set value(m){V(v,N(r).tagsColumn=m,N(r))},$$legacy:!0}),c(b,u)},$$slots:{default:!0}}),q()}function He(){return[{label:qt(),value:J.TAB},{label:Bt(),value:J.PIPE},{label:Kt(),value:J.SEMICOLON},{label:Yt(),value:J.COLON},{label:Jt(),value:J.COMMA},{label:Qt(),value:J.SPACE}]}function xe(){return[{label:Xt(),value:gt.UPDATE},{label:Zt(),value:gt.PRESERVE},{label:te(),value:gt.DUPLICATE}]}function Ee(){return[{label:yt(),value:Nt.NOTETYPE},{label:ee(),value:Nt.NOTETYPE_AND_DECK}]}var Re=M('<th class="svelte-13c6kdp"> </th>'),je=M('<td class="svelte-13c6kdp"> </td>'),Ae=M('<tr class="svelte-13c6kdp"></tr>'),Le=M('<div class="outer svelte-13c6kdp"><table class="preview svelte-13c6kdp"><thead><tr class="svelte-13c6kdp"></tr></thead><tbody></tbody></table></div>');function Fe(a,t){W(t,!1);const e=it(),s=()=>R(i,"$columnOptions",e),l=()=>R(r,"$metadata",e);let o=S(t,"state",8);const r=o().metadata,i=o().columnOptions;B();var v=Le(),d=et(v),n=et(d),O=et(n);pt(O,5,()=>s().slice(1),mt,(b,p)=>{let u=()=>$(p).label,C=()=>$(p).shortLabel;var y=Re(),_=et(y);P(y),x(()=>E(_,C()||u())),c(b,y)}),P(O),P(n);var h=T(n);pt(h,5,()=>l().preview,mt,(b,p)=>{var u=Ae();pt(u,5,()=>$(p).vals,mt,(C,y)=>{var _=je(),m=et(_);P(_),x(()=>E(m,$(y))),c(C,_)}),P(u),c(b,u)}),P(h),P(d),P(v),c(a,v),q()}var Ge=M("<!> <!> <!>",1);function Ve(a,t){W(t,!1);const e=it(),s=()=>R(o,"$metadata",e);let l=S(t,"state",8);const o=l().metadata,r={delimiter:{title:ae(),help:le(),url:L.TextImporting.root},isHtml:{title:se(),help:oe(),url:L.TextImporting.html}},i=Object.values(r);let v=ot(),d=ot();function n(h){$(v).show(),$(d).to(h)}B();var O=w(()=>Ct());_t(a,{get title(){return $(O)},children:(h,b)=>{var p=Ge(),u=j(p),C=w(He);lt(u,{get value(){return s().delimiter},set value(m){V(o,N(s).delimiter=m,N(s))},get defaultValue(){return l().defaultDelimiter},get choices(){return $(C)},get disabled(){return s().forceDelimiter},children:(m,K)=>{z(m,{$$events:{click:()=>n(Object.keys(r).indexOf("delimiter"))},children:(U,X)=>{G();var A=F();x(()=>E(A,r.delimiter.title)),c(U,A)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var y=T(u,2);_e(y,{get value(){return s().isHtml},set value(m){V(o,N(s).isHtml=m,N(s))},get defaultValue(){return l().defaultIsHtml},get disabled(){return s().forceIsHtml},children:(m,K)=>{z(m,{$$events:{click:()=>n(Object.keys(r).indexOf("isHtml"))},children:(U,X)=>{G();var A=F();x(()=>E(A,r.isHtml.title)),c(U,A)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var _=T(y,2);Fe(_,{get state(){return l()}}),c(h,p)},$$slots:{default:!0,tooltip:(h,b)=>{var p=w(()=>Ct());Et(h,{get title(){return $(p)},get url(){return L.TextImporting.root},slot:"tooltip",helpSections:i,$$events:{mount:u=>{rt(v,u.detail.modal),rt(d,u.detail.carousel)}}})}}}),q()}var Ue=M('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),ze=M('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function Mt(a,t){W(t,!1);const e=it(),s=()=>R(i,"$tagsWritable",e);let l=S(t,"tags",12),o=S(t,"keyCombination",8,void 0),r=S(t,"breakpoint",8,"md");const i=ct(l());B();var v=ze(),d=j(v);Q(d,()=>({"--cols":13})),st(d.lastChild,{children:(n,O)=>{var h=Ue(),b=j(h);Q(b,()=>({"--col-size":7})),$t(b.lastChild,{get breakpoint(){return r()},children:(u,C)=>{var y=ht(),_=j(y);Vt(_,t,"default",{}),c(u,y)},$$slots:{default:!0}}),P(b);var p=T(b,2);Q(p,()=>({"--col-size":6})),$t(p.lastChild,{get breakpoint(){return r()},children:(u,C)=>{ke(u,{children:(y,_)=>{Ce(y,{tags:i,get keyCombination(){return o()},$$events:{tagsupdate:({detail:m})=>l(m.tags)}})},$$slots:{default:!0,revert:(y,_)=>{Ne(y,{slot:"revert",get value(){return s()},set value(m){xt(i,m)},defaultValue:[],$$legacy:!0})}}})},$$slots:{default:!0}}),P(p),c(n,h)},$$slots:{default:!0}}),P(d),c(a,v),q()}var We=M("<!> <!> <!> <!> <!> <!>",1);function qe(a,t){W(t,!1);const e=it(),s=()=>R(v,"$globalNotetype",e),l=()=>R(d,"$deckId",e),o=()=>R(i,"$metadata",e);let r=S(t,"state",8);const i=r().metadata,v=r().globalNotetype,d=r().deckId,n={notetype:{title:yt(),help:re(),url:L.TextImporting.root},deck:{title:Ht(),help:ie(),url:L.TextImporting.root},dupeResolution:{title:ne(),help:ue(),url:L.TextImporting.updating},matchScope:{title:de(),help:ce(),url:L.TextImporting.updating},globalTags:{title:pe(),help:me(),url:L.TextImporting.root},updatedTags:{title:$e(),help:ve(),url:L.TextImporting.root}},O=Object.values(n);let h=ot(),b=ot();function p(C){$(h).show(),$(b).to(C)}B();var u=w(()=>It());_t(a,{get title(){return $(u)},children:(C,y)=>{var _=We(),m=j(_);bt(m,()=>s()!==null,g=>{var D=w(()=>r().notetypeNameIds.map(({id:f,name:H})=>({label:H,value:f})));lt(g,{get value(){return s().id},set value(f){V(v,N(s).id=f,N(s))},get defaultValue(){return r().defaultNotetypeId},get choices(){return $(D)},children:(f,H)=>{z(f,{$$events:{click:()=>p(Object.keys(n).indexOf("notetype"))},children:(I,Rt)=>{G();var Z=F();x(()=>E(Z,n.notetype.title)),c(I,Z)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0})});var K=T(m,2);bt(K,()=>l()!==null,g=>{var D=w(()=>r().deckNameIds.map(({id:f,name:H})=>({label:H,value:f})));lt(g,{get value(){return l()},set value(f){xt(d,f)},get defaultValue(){return r().defaultDeckId},get choices(){return $(D)},children:(f,H)=>{z(f,{$$events:{click:()=>p(Object.keys(n).indexOf("deck"))},children:(I,Rt)=>{G();var Z=F();x(()=>E(Z,n.deck.title)),c(I,Z)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0})});var U=T(K,2),X=w(xe);lt(U,{get value(){return o().dupeResolution},set value(g){V(i,N(o).dupeResolution=g,N(o))},defaultValue:0,get choices(){return $(X)},children:(g,D)=>{z(g,{$$events:{click:()=>p(Object.keys(n).indexOf("dupeResolution"))},children:(f,H)=>{G();var I=F();x(()=>E(I,n.dupeResolution.title)),c(f,I)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var A=T(U,2),nt=w(Ee);lt(A,{get value(){return o().matchScope},set value(g){V(i,N(o).matchScope=g,N(o))},defaultValue:0,get choices(){return $(nt)},children:(g,D)=>{z(g,{$$events:{click:()=>p(Object.keys(n).indexOf("matchScope"))},children:(f,H)=>{G();var I=F();x(()=>E(I,n.matchScope.title)),c(f,I)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var ut=T(A,2);Mt(ut,{get tags(){return o().globalTags},set tags(g){V(i,N(o).globalTags=g,N(o))},keyCombination:"Control+T",children:(g,D)=>{z(g,{$$events:{click:()=>p(Object.keys(n).indexOf("globalTags"))},children:(f,H)=>{G();var I=F();x(()=>E(I,n.globalTags.title)),c(f,I)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var vt=T(ut,2);Mt(vt,{get tags(){return o().updatedTags},set tags(g){V(i,N(o).updatedTags=g,N(o))},keyCombination:"Control+Shift+T",children:(g,D)=>{z(g,{$$events:{click:()=>p(Object.keys(n).indexOf("updatedTags"))},children:(f,H)=>{G();var I=F();x(()=>E(I,n.updatedTags.title)),c(f,I)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0}),c(C,_)},$$slots:{default:!0,tooltip:(C,y)=>{var _=w(()=>It());Et(C,{get title(){return $(_)},get url(){return L.TextImporting.root},slot:"tooltip",helpSections:O,$$events:{mount:m=>{rt(h,m.detail.modal),rt(b,m.detail.carousel)}}})}}}),q()}var Be=M("<!> <!> <!>",1);function Ke(a,t){W(t,!1);let e=S(t,"state",8);B(),be(a,{get path(){return e().path},get importer(){return e()},children:(s,l)=>{var o=Be(),r=j(o);st(r,{children:(d,n)=>{Ve(d,{get state(){return e()}})},$$slots:{default:!0}});var i=T(r,2);st(i,{children:(d,n)=>{qe(d,{get state(){return e()}})},$$slots:{default:!0}});var v=T(i,2);st(v,{children:(d,n)=>{De(d,{get state(){return e()}})},$$slots:{default:!0}}),c(s,o)},$$slots:{default:!0}}),q()}function fa(a,t){W(t,!1);let e=S(t,"data",8);B(),Ke(a,{get state(){return e().state}}),q()}export{fa as component,ga as universal};
