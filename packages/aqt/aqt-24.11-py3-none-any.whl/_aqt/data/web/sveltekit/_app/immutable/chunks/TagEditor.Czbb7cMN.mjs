import{a as D,d as B,F as te,e as Z,s as C,r as K,t as we,D as ft,$ as st}from"./disclose-version.CXWUuFGG.mjs";import{p as le,R as dt,t as G,b as re,V as Y,g as e,a0 as H,s as u,m as R,l as he,a as Be,N as ze,ag as m,a1 as We,U as Ot,ai as ot,ah as lt}from"./runtime.BJSnJeWl.mjs";import{e as E,s as ue}from"./render.CQvFnAiW.mjs";import{p as b,i as $e}from"./props.fkJSEmZ6.mjs";import{c as gt}from"./Container.CxVXZ9-Q.mjs";import{p as qt,e as ht,i as Ft}from"./theme.swshwi0b.mjs";import{r as zt,aq as Ht,v as be,q as mt,t as oe,bu as Kt,bv as Ut,bw as Vt,bx as Gt}from"./runtime-require.AM6bqlff.mjs";import{b as vt}from"./IconButton.DVHuyWt4.mjs";import{r as Jt,p as ke,s as Qt,t as Xt,e as pt,I as je,v as Yt,w as Zt,S as Ee,g as Re,x as en,o as tn,b as yt,y as nn,z as an,A as sn,B as on,h as ln,i as rn}from"./Shortcut.C_u0IeGk.mjs";import{i as fe}from"./lifecycle.DW1_rEFA.mjs";import{s as Ae,b as rt,a as _e}from"./store.CAPRemx4.mjs";import{b as L,s as me,d as ve,B as cn}from"./backend.AWOyeTAw.mjs";import{c as de,o as $t}from"./index-client.D9hOaSri.mjs";import{d as un,w as bt}from"./index.BB25h7Qo.mjs";import{d as Ke,W as _t,P as St,D as Oe,B as fn}from"./Badge.WCeL609F.mjs";import{a as dn}from"./input.BFdbOG1j.mjs";import{b as Ue}from"./this.C9pg2j_S.mjs";import{W as gn}from"./WithTooltip.CGKCwsR4.mjs";function Tt(a){const t=a.getRootNode();return t.getSelection?t.getSelection():document.getSelection()}function hn(a){const t=a.rangeCount;return t===0?null:a.getRangeAt(t-1)}const ma=Symbol("direction"),Ve=Symbol("tagActionsShortcuts");function mn(a,t,f){document.execCommand(a,t,f)}function wt(a,t,f){if(!a.parentNode||a===t)return f;{const i=a.parentNode,_=[Array.prototype.indexOf.call(a.parentNode.childNodes,a),...f];return wt(i,t,_)}}function ct(a,t){return wt(a,t,[])}function Ge(a,t){if(t.length===0)return a;if(a.childNodes[t[0]]){const[f,...i]=t;return Ge(a.childNodes[f],i)}else return null}var Je=(a=>(a[a.Before=-1]="Before",a[a.Equal=0]="Equal",a[a.After=1]="After",a))(Je||{});function vn(a,t){const f=Math.min(a.coordinates.length,t.coordinates.length);for(let i=0;i<=f;i++){if(a.coordinates.length===i)return t.coordinates.length===i?a.offset<t.offset?-1:a.offset>t.offset?1:0:-1;if(t.coordinates.length===i)return 1;if(a.coordinates[i]<t.coordinates[i])return-1;if(a.coordinates[i]>t.coordinates[i])return 1}throw new Error("compareLocations: Should never happen")}function pn(a){const t=Tt(a),f=hn(t);if(!f)return null;const i=f.collapsed,g={coordinates:ct(t.anchorNode,a),offset:t.anchorOffset};if(i)return{anchor:g,collapsed:i};const l={coordinates:ct(t.focusNode,a),offset:t.focusOffset},v=vn(g,l)===Je.After?"backward":"forward";return{anchor:g,focus:l,collapsed:i,direction:v}}function yn(a){a.empty()}function $n(a,t,f,i){const _=i.focus,g=_.offset,o=Ge(a,_.coordinates);i.direction==="forward"?(f.setEnd(o,g),t.addRange(f)):(t.addRange(f),t.extend(o,g))}function bn(a){return pn(a)}function _n(a,t){const f=Tt(a);yn(f);const i=new Range,_=Ge(a,t.anchor.coordinates);i.setStart(_,t.anchor.offset),t.collapsed?(i.collapse(!0),f.addRange(i)):$n(a,f,i,t)}zt("anki/location",{Position:Je,restoreSelection:_n,saveSelection:bn});const ee="∷";function He(a){return a.replace(/::/g,ee)}function Ie(a){return a.replace(/\u2237/gu,"::")}function it(a){let t=a.trim();for(;t.startsWith(":")||t.startsWith(ee);)t=t.slice(1).trimStart();for(;t.endsWith(":")||t.endsWith(ee);)t=t.slice(0,-1).trimEnd();return t}function qe(a){return{id:Math.random().toString(36).substring(2),name:a,selected:!1,flash:()=>{}}}function Sn(a){return a.name}var Tn=B('<input type="text" tabindex="-1" size="1">');const Ce=bt(null);un(Ce,a=>()=>a==null?void 0:a.blur());function wn(a,t){le(t,!1);const f=Ae(),i=()=>_e(Ce,"$currentTagInput",f);let _=b(t,"id",0,void 0),g=b(t,"class",0,""),o=b(t,"name",4),l=b(t,"input",4),d=b(t,"disabled");const v=de();function T(){return l().selectionStart===l().selectionEnd}function k(){return l().selectionStart===0&&l().selectionEnd===0}function S(){return l().selectionStart===l().value.length&&l().selectionEnd===l().value.length}function r(s){l().setSelectionRange(s,s)}function O(){return o().length===0}async function A(s){const N=l().value.length;v("tagjoinprevious"),await Y(),r(l().value.length-N),s.preventDefault()}async function U(s,N){if(N>o().length)return;o().slice(0,N).endsWith(ee)&&(o(o().slice(0,N-1)+o().slice(N,o().length)),await Y(),s.preventDefault(),r(N-1),v("taginput"))}function I(s){k()?A(s):U(s,l().selectionStart)}async function W(s){const N=l().value.length;v("tagjoinnext"),await Y(),r(N),s.preventDefault()}function j(s){S()?W(s):U(s,l().selectionStart+2)}function w(){o(it(o())),o().length===0&&v("tagdelete"),v("tagaccept")}function F(s){v("tagsplit",{start:l().selectionStart,end:l().selectionEnd}),s.preventDefault()}async function y(s,N=!1){const P=l().selectionStart,Q=l().selectionEnd,z=o().slice(0,P),ne=o().slice(Q,o().length);if(z.endsWith(ee)){s.preventDefault(),s.stopPropagation();return}else if(z.endsWith(":")){s.preventDefault(),o(`${z.slice(0,-1)}${ee}${o().slice(Q,o().length)}`),await Y(),r(P),v("taginput");return}else if(ne.startsWith(":"))s.preventDefault(),o(`${z}${ee}${o().slice(Q+1,o().length)}`);else{if(N)return;s.preventDefault(),o(`${z}${ee}${ne}`)}await Y(),r(P+1),v("taginput")}function h(s){switch(s.code){case"Enter":F(s);break;case"Backspace":T()&&I(s);break;case"Delete":T()&&j(s);break}Qt(s)?O()?A(s):k()&&(v("tagmoveprevious"),s.preventDefault()):Xt(s)?O()?W(s):S()&&(v("tagmovenext"),s.preventDefault()):s.key===" "?y(s,!1):s.key===":"&&y(s,!0)}function q(s){const N=document.getSelection();s.clipboardData.setData("text/plain",Ie(N.toString()))}function M(s){if(!s.clipboardData)return;const P=(o()+s.clipboardData.getData("text/plain")).split(/\s+/).map(it).filter(z=>z.length>0).map(He);if(P.length===0)return;const Q=P.pop();for(const z of P.reverse())o(z),v("tagadd");o(Q)}function x(s){o().length===0&&(s.preventDefault(),s.stopPropagation(),v("tagselectall"))}const{selectAllShortcut:X}=dt(Ve);$t(()=>{Jt(x,X,{target:l()}),l().focus()});function J(s){return rt(Ce,s),{destroy(){i()===s&&rt(Ce,null)}}}fe();var $=Tn();Ue($,s=>l(s),()=>l()),Ht($),G(()=>{var s;be($,"id",_()),mt($,`tag-input ${(s=g())!=null?s:""} svelte-1nk8ij0`),oe($,"disabled",d())}),dn($,o,s=>o(s)),E("focus",$,function(s){L.call(this,t,s)}),E("blur",$,ke(w),!1),E("keydown",$,h,!1),E("keydown",$,function(s){L.call(this,t,s)}),E("keyup",$,function(s){L.call(this,t,s)}),E("input",$,()=>v("taginput"),!1),E("copy",$,ke(q),!1),E("paste",$,ke(M),!1),Ke($,s=>J(s)),D(a,$),re()}var kn=B("<!> <!>",1),Cn=B('<div class="tag-add-button svelte-1fo7hj6" role="button"><!> <span class="tags-info svelte-1fo7hj6"><!></span></div> <!>',1);function An(a,t){le(t,!1);const f=Ae(),i=()=>_e(Ce,"$currentTagInput",f);let _=b(t,"keyCombination");const g=de();function o(){g("tagappend")}fe();var l=Cn(),d=te(l);const v=H(()=>Kt()),T=H(()=>Re(_()));G(()=>be(d,"title",`${e(v)} (${e(T)})`));var k=Z(d);pt(k,{children:(A,U)=>{var I=kn(),W=te(I);je(W,{icon:Yt,$$legacy:!0});var j=C(C(W,!0));je(j,{icon:Zt,$$legacy:!0}),D(A,I)},$$slots:{default:!0},$$legacy:!0});var S=C(C(k,!0)),r=Z(S);me(r,ve(t),{}),K(S),K(d);var O=C(C(d,!0));Ee(O,{get keyCombination(){return _()},$$events:{action:()=>g("tagappend")},$$legacy:!0}),G(()=>be(d,"tabindex",i()?-1:0)),E("click",d,o,!1),E("focus",d,o,!1),D(a,l),re()}var Nn=B('<div class="tags-selected-button svelte-y9jxqs" role="button" tabindex="0"><!></div>'),Dn=B("<!> <!> <!>",1);function Pn(a,t){le(t,!1);const f=de();let i=R(!1);const{selectAllShortcut:_,copyShortcut:g,removeShortcut:o}=dt(Ve);fe(),_t(a,{get show(){return e(i)},preferredPlacement:"top",get portalTarget(){return document.body},shift:0,children:(l,d)=>{const v=H(()=>d.asReference);var T=Nn(),k=Z(T);pt(k,{children:(S,r)=>{je(S,{icon:en,$$legacy:!0})},$$slots:{default:!0},$$legacy:!0}),K(T),Ke(T,S=>e(v)(S)),E("click",T,()=>u(i,!e(i)),!1),E("keydown",T,tn(()=>u(i,!e(i))),!1),D(l,T)},$$slots:{default:!0,floating:(l,d)=>{St(l,{slot:"floating",children:(v,T)=>{var k=Dn(),S=te(k);Oe(S,{$$events:{click:()=>f("tagselectall")},children:(A,U)=>{var I=we();const W=H(()=>Ut()),j=H(()=>Re(_));G(()=>ue(I,`${e(W)} (${e(j)})`)),D(A,I)},$$slots:{default:!0},$$legacy:!0});var r=C(C(S,!0));Oe(r,{$$events:{click:()=>f("tagcopy")},children:(A,U)=>{var I=we();const W=H(()=>Vt()),j=H(()=>Re(g));G(()=>ue(I,`${e(W)} (${e(j)})`)),D(A,I)},$$slots:{default:!0},$$legacy:!0});var O=C(C(r,!0));Oe(O,{$$events:{click:()=>f("tagdelete")},children:(A,U)=>{var I=we();const W=H(()=>Gt()),j=H(()=>Re(o));G(()=>ue(I,`${e(W)} (${e(j)})`)),D(A,I)},$$slots:{default:!0},$$legacy:!0}),D(v,k)},$$slots:{default:!0},$$legacy:!0})}},$$legacy:!0}),re()}var xn=B('<div class="tag-options-button gap svelte-16efk4p"><!></div>');function En(a,t){let f=b(t,"badgeHeight",4),i=b(t,"tagsSelected"),_=b(t,"keyCombination");var g=xn(),o=Z(g);$e(o,i,l=>{Pn(l,{$$events:{tagselectall(d){L.call(this,t,d)},tagcopy(d){L.call(this,t,d)},tagdelete(d){L.call(this,t,d)}},$$legacy:!0})},l=>{An(l,{get keyCombination(){return _()},$$events:{tagappend(d){L.call(this,t,d)}},$$legacy:!0})}),K(g),yt(g,"offsetHeight",l=>f(l)),E("mousedown",g,ke(function(l){L.call(this,t,l)})),D(a,g)}function Rn(a,t){let f=b(t,"class",0,"");fn(a,{get class(){var i;return`d-flex align-items-center ms-1 ${(i=f())!=null?i:""}`},iconSize:80,$$events:{click(i){L.call(this,t,i)}},children:(i,_)=>{je(i,{icon:nn,$$legacy:!0})},$$slots:{default:!0},$$legacy:!0})}var In=B('<button tabindex="-1"><!></button>');function Fe(a,t){le(t,!1);let f=b(t,"class",0,""),i=b(t,"tagName"),_=b(t,"tooltip",0,void 0),g=b(t,"selected",0,!1);const o=de();let l=R(!1);function d(){u(l,!0),setTimeout(()=>u(l,!1),300)}let v=R();$t(()=>o("mount",{button:e(v)})),fe();var T=In();Ue(T,S=>u(v,S),()=>e(v));var k=Z(T);return me(k,ve(t),{}),K(T),G(()=>{var S;mt(T,`tag d-inline-flex align-items-center text-nowrap ps-2 pe-1 ${(S=f())!=null?S:""} svelte-1ywoj88`),be(T,"title",_()),be(T,"data-addon-tag",i()),oe(T,"selected",g()),oe(T,"flashing",e(l))}),E("mousemove",T,function(S){L.call(this,t,S)}),E("click",T,function(S){L.call(this,t,S)}),D(a,T),vt(t,"flash",d),re({flash:d})}var Wn=B(" <!>",1),jn=B("<span> </span> <!>",1),Bn=B("<span> </span> <!>",1),Mn=B('<div class="svelte-11ejbji"><!></div>');function Ln(a,t){le(t,!1);const f=Ae(),i=()=>_e(qt,"$pageTheme",f),_=R();let g=b(t,"name"),o=b(t,"class",0,""),l=b(t,"tooltip"),d=b(t,"selected",4),v=b(t,"active"),T=b(t,"shorten"),k=b(t,"flash",4);const S=de();let r=R(!1),O=R(!1);function A(y){u(r,an(y)),u(O,sn(y))}function U(){e(O)?S("tagrange"):e(r)?S("tagselect"):S("tagclick")}function I(y){const h=y.split(ee);return h.length===1?y:`…${ee}`+h[h.length-1]}function W(y){return y.split(ee).length>1}const j="tag-icon-hover";he(()=>(e(r),e(O)),()=>{u(_,e(r)||e(O))}),Be(),fe();var w=Mn(),F=Z(w);$e(F,v,y=>{Fe(y,{get class(){return o()},get tagName(){return g()},$$events:{mousemove:A,click:U},children:(h,q)=>{var M=Wn(),x=te(M,!0),X=C(x);me(X,ve(t),{get selectMode(){return e(_)},hoverClass:j}),G(()=>{var J;return ue(x,`${(J=g())!=null?J:""} `)}),D(h,M)},$$slots:{default:!0},$$legacy:!0})},y=>{var h=ft(),q=te(h);$e(q,()=>T()&&W(g()),M=>{gn(M,{get tooltip(){return l()},trigger:"hover",placement:"top",children:(x,X)=>{const J=H(()=>X.createTooltip);Fe(x,{get class(){return o()},get tagName(){return g()},get flash(){return k()},set flash($){k($)},get selected(){return d()},set selected($){d($)},$$events:{mousemove:A,click:U,mount:$=>e(J)($.detail.button)},children:($,s)=>{var N=jn(),P=te(N),Q=Z(P);G(()=>ue(Q,I(g()))),K(P);var z=C(C(P,!0));me(z,ve(t),{get selectMode(){return e(_)},hoverClass:j}),D($,N)},$$slots:{default:!0},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0})},M=>{Fe(M,{get class(){return o()},get tagName(){return g()},get flash(){return k()},set flash(x){k(x)},get selected(){return d()},set selected(x){d(x)},$$events:{mousemove:A,click:U},children:(x,X)=>{var J=Bn(),$=te(J),s=Z($);K($);var N=C(C($,!0));me(N,ve(t),{get selectMode(){return e(_)},hoverClass:j}),G(()=>ue(s,g())),D(x,J)},$$slots:{default:!0},$$legacy:!0})},!0),D(y,h)}),K(w),G(()=>{oe(w,"select-mode",e(_)),oe(w,"night-mode",i().isDark),oe(w,"empty",g()==="")}),E("keydown",st.body,A,!1),E("keyup",st.body,A,!1),D(a,w),re()}function On(a,t){le(t,!1);let f=b(t,"name"),i=b(t,"class",0,""),_=b(t,"tooltip"),g=b(t,"selected"),o=b(t,"active"),l=b(t,"shorten"),d=b(t,"flash");const v=de();function T(){v("tagdelete")}fe(),Ln(a,{get name(){return f()},get class(){return i()},get tooltip(){return _()},get selected(){return g()},get active(){return o()},get shorten(){return l()},get flash(){return d()},$$events:{tagrange(k){L.call(this,t,k)},tagselect(k){L.call(this,t,k)},tagclick:()=>v("tagedit")},children:(k,S)=>{const r=H(()=>S.selectMode),O=H(()=>S.hoverClass);Rn(k,{get class(){return e(O)},$$events:{click:()=>{e(r)||T()}},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0}),re()}var qn=B('<div class="tag-spacer svelte-1k3couf" role="textbox" tabindex="-1"><br></div>');function Fn(a,t){var f=qn();K(f),E("click",f,function(i){L.call(this,t,i)}),D(a,f)}var zn=B('<div tabindex="-1" class="autocomplete-item svelte-1pjq6zk" role="button"><!></div>');function ut(a,t){le(t,!1);let f=b(t,"selected",0,!1),i=b(t,"active",0,!1),_=b(t,"suggestion"),g=R();he(()=>(ze(f()),e(g)),()=>{f()&&e(g)&&e(g).scrollIntoViewIfNeeded({behavior:"smooth",block:"start"})}),Be();var o=zn();Ue(o,d=>u(g,d),()=>e(g));var l=Z(o);me(l,ve(t),{}),K(o),G(()=>{be(o,"data-addon-suggestion",_()),oe(o,"selected",f()),oe(o,"active",i())}),E("mousedown",o,ke(function(d){L.call(this,t,d)})),E("mouseup",o,function(d){L.call(this,t,d)}),E("mouseenter",o,function(d){L.call(this,t,d)}),E("mouseleave",o,function(d){L.call(this,t,d)}),D(a,o),re()}var Hn=B('<span class="autocomplete-reference svelte-1bkz961"><!></span>'),Kn=B('<div class="autocomplete-menu svelte-1bkz961"></div>'),Un=B('<div style="display: contents"><!></div>',1);function Vn(a,t){le(t,!1);const f=Ae(),i=()=>_e(g(),"$show",f);let _=b(t,"suggestionsPromise"),g=b(t,"show"),o=R([]),l=R(null),d=R(!1);const v=de();function T(){e(l)===null?u(l,0):e(l)>=e(o).length-1?u(l,null):We(l)}function k(){e(l)===null?u(l,e(o).length-1):e(l)===0?u(l,null):We(l,-1)}async function S(){var h;v("select",{selected:e(o)[(h=e(l))!=null?h:-1]})}async function r(){T(),await S()}async function O(){k(),await S()}async function A(){var h;u(d,!0),v("choose",{chosen:e(o)[(h=e(l))!=null?h:-1]}),await Y(),g().set(!1)}async function U(){await Y(),v("update")}function I(){return e(l)!==null}function W(){return{selectPrevious:O,selectNext:r,chooseSelected:A,update:U,hasSelected:I}}function j(h){u(l,h),u(d,!0)}function w(h){j(h)}async function F(h){u(d,!1),v("select",{selected:e(o)[h]})}function y(h,q){h.buttons===1&&j(q)}he(()=>(ze(_()),ze(g())),()=>{_().then(h=>{g().set(h.length>0),on()&&navigator.userAgent.match(/Chrome\/77/)&&(h=h.slice(0,10)),u(o,h)})}),Be(),fe(),_t(a,{keepOnKeyup:!0,get show(){return i()},preferredPlacement:"top",get portalTarget(){return document.body},$$events:{close:()=>g().set(!1)},children:(h,q)=>{const M=H(()=>q.asReference);var x=Hn(),X=Z(x);me(X,ve(t),{createAutocomplete:W}),K(x),Ke(x,J=>e(M)(J)),D(h,x)},$$slots:{default:!0,floating:(h,q)=>{var M=Un(),x=te(M);gt(x,()=>({"--popover-padding-inline":"0"})),St(x.lastChild,{slot:"floating",children:(X,J)=>{var $=Kn();ht($,9,()=>e(o),Ft,(s,N,P)=>{var Q=ft(),z=te(Q);$e(z,()=>m(P)===e(l),ne=>{ut(ne,{selected:!0,get active(){return e(d)},get suggestion(){return m(N)},$$events:{mousedown:()=>w(m(P)),mouseup:()=>{F(m(P)),A()},mouseenter:ae=>y(ae,m(P)),mouseleave:()=>u(d,!1)},children:(ae,ce)=>{var ie=we();G(()=>ue(ie,m(N))),D(ae,ie)},$$slots:{default:!0},$$legacy:!0})},ne=>{ut(ne,{get suggestion(){return m(N)},$$events:{mousedown:()=>w(m(P)),mouseup:()=>{F(m(P)),A()},mouseenter:ae=>y(ae,m(P))},children:(ae,ce)=>{var ie=we();G(()=>ue(ie,m(N))),D(ae,ie)},$$slots:{default:!0},$$legacy:!0})}),D(s,Q)}),K($),D(X,$)},$$slots:{default:!0},$$legacy:!0}),K(x),D(h,M)}},$$legacy:!0}),re()}var Gn=B("<!> <!> <!>",1),Jn=B('<div class="tag-relative svelte-1tsu84n"><!> <!></div>'),Qn=B('<!> <div class="tag-editor svelte-1tsu84n"><div style="display: contents"><!></div> <!> <!></div>',1);function va(a,t){le(t,!1);const f=Ae(),i=()=>_e(d(),"$tags",f),_=()=>_e(A,"$show",f),g=R(),o=R(),l=R();let d=b(t,"tags"),v=b(t,"keyCombination",0,"Control+Shift+T");const T="Control+A",k="Control+C",S="Backspace";Ot(Ve,{selectAllShortcut:T,copyShortcut:k,removeShortcut:S});let r=R();function O(n){u(r,n.map(c=>qe(He(c))))}const A=bt(!1),U=de(),I=Promise.resolve([]);let W=R(I);function j(){const n=e(r).map(c=>c.name).map(Ie);U("tagsupdate",{tags:n}),u(W,I)}let w=R(null),F=null,y=R(""),h=R(),q=R(),M=R(!1);async function x(n){const{tags:c}=await cn({input:n,matchLimit:500});return c}const X=/^:?([^:].*?[^:]):?$/;function J(){const c=e(r)[e(w)].name;if(u(M,c.length===0),e(M))u(W,I);else{const p=Ie(c),V=X.test(p)?p.replace(X,"$1"):p;u(W,x(V).then(se=>(u(M,se.length===0),se.map(He))))}}function $(n){const c=e(r)[e(w)];u(y,n!=null?n:c.name);const p=e(h).value.length;e(h).setSelectionRange(p,p)}async function s(n){n.name=e(y),u(r,e(r)),await Y(),e(h)&&e(q).update()}function N(n){F===null&&(F=n)}function P(){pe();const n=e(r)[e(r).length-1];(!n||n.name.length>0)&&Q(e(r).length-1,"");const c=e(w)===null;u(w,null),c&&Xe()}function Q(n,c){e(r).splice(n+1,0,qe(c)),u(r,e(r)),N(n+1)}function z(n){const c=e(r).map(Sn);c.splice(n,1);const p=c.indexOf(e(y));return p>=0?(e(r)[p>=n?p+1:p].flash(),!1):!0}async function ne(n,c,p){const V=e(y).slice(0,c),se=e(y).slice(p);u(y,V),await Y(),Q(n,se),u(w,null),await Y(),n!==e(w)&&e(h).setSelectionRange(0,0)}function ae(n){z(n)&&(e(r).splice(n,0,qe(e(y))),We(w),u(r,e(r)))}function ce(n){const c=e(r).splice(n,1)[0];return u(r,e(r)),F!==null&&F>n&&F--,c}function ie(n){return n===0}function Qe(n){return n===e(r).length-1}function kt(n){if(ie(n))return;const c=ce(n-1);u(y,c.name+e(y)),We(w,-1),s(e(r)[e(w)])}function Ct(n){if(Qe(n))return;const c=ce(n+1);u(y,e(y)+c.name),s(e(r)[e(w)])}function At(n){ie(n)||(F=n-1,u(w,null),e(h).blur())}async function Nt(n){if(Qe(n)){e(y).length!==0&&(Q(n,""),u(w,null));return}F=n+1,u(w,null),e(h).blur(),await Y(),e(h).setSelectionRange(0,0)}function Dt(n,c){e(r).includes(n)&&(z(c)||ce(c))}function Xe(){u(w,F),F=null}function Pt(n){if(ln(n)){e(q).selectPrevious(),n.preventDefault();return}else if(rn(n)){e(q).selectNext(),n.preventDefault();return}switch(n.code){case"Tab":if(_())n.shiftKey?e(q).selectPrevious():e(q).selectNext();else break;n.preventDefault();break;case"Enter":e(q).chooseSelected(),n.preventDefault();break}}let Se=null,Ne=null;function Ye(n){lt(r,e(r)[n].selected=!e(r)[n].selected),u(r,e(r)),Se=n}function xt(n){if(Se===null){Ye(n);return}Ne=n;const c=Math.min(Se,Ne),p=Math.max(Se,Ne);for(let V=c;V<=p;V++)lt(r,e(r)[V].selected=!0);u(r,e(r))}function pe(){u(r,e(r).map(n=>({...n,selected:!1}))),Se=null,Ne=null}function Et(n){const c=n.currentTarget;(n.relatedTarget===null||!c.contains(n.relatedTarget))&&pe()}function Rt(n){const c=document.createElement("textarea");c.value=n,c.setAttribute("readonly",""),c.style.position="absolute",c.style.left="-9999px",document.body.appendChild(c),c.select(),mn("copy"),document.body.removeChild(c)}function Me(){for(const n of e(r))n.selected=!0;u(r,e(r))}function Ze(){const n=e(r).filter(c=>c.selected).map(c=>Ie(c.name)).join(`
`);Rt(n),pe()}function et(){e(r).map((n,c)=>[n.selected,c]).filter(([n])=>n).reverse().forEach(([,n])=>ce(n)),pe(),j()}let Le=R(),De=R();he(()=>i(),()=>{O(i())}),he(()=>(e(Le),e(De)),()=>{u(g,Math.floor(e(Le)/e(De)))}),he(()=>(e(o),e(g)),()=>{u(o,e(o)||e(g)>2)}),he(()=>e(r),()=>{u(l,e(r).some(n=>n.selected))}),Be(),fe();var tt=Qn(),nt=te(tt);$e(nt,()=>e(l),n=>{var c=Gn(),p=te(c);Ee(p,{keyCombination:T,$$events:{action:Me},$$legacy:!0});var V=C(C(p,!0));Ee(V,{keyCombination:k,$$events:{action:Ze},$$legacy:!0});var se=C(C(V,!0));Ee(se,{keyCombination:S,$$events:{action:et},$$legacy:!0}),D(n,c)});var Pe=C(C(nt,!0)),xe=Z(Pe);gt(xe,()=>({"--icon-align":"baseline"})),En(xe.lastChild,{get badgeHeight(){return e(De)},set badgeHeight(n){u(De,n)},get tagsSelected(){return e(l)},get keyCombination(){return v()},$$events:{tagselectall:Me,tagcopy:Ze,tagdelete:et,tagappend:P},$$legacy:!0}),K(xe);var at=C(C(xe,!0));ht(at,7,()=>e(r),(n,c)=>m(n).id,(n,c,p)=>{var V=Jn(),se=Z(V),Wt=H(()=>m(p)===e(w)?e(y):m(c).name),jt=H(()=>m(p)===e(w));On(se,{class:"ms-0",get name(){return e(Wt)},get tooltip(){return m(c).name},get active(){return e(jt)},get shorten(){return e(o)},get flash(){return m(c).flash},set flash(Te){m(c).flash=Te,ot(()=>e(r))},get selected(){return m(c).selected},set selected(Te){m(c).selected=Te,ot(()=>e(r))},$$events:{tagedit:()=>{u(w,m(p)),pe()},tagselect:()=>Ye(m(p)),tagrange:()=>xt(m(p)),tagdelete:()=>{pe(),ce(m(p)),j()}},$$legacy:!0});var Bt=C(C(se,!0));$e(Bt,()=>m(p)===e(w),Te=>{Vn(Te,{get suggestionsPromise(){return e(W)},show:A,$$events:{update:J,select:({detail:ge})=>$(ge.selected),choose:({detail:ge})=>{$(ge.chosen),ne(m(p),ge.chosen.length,ge.chosen.length)}},children:(ge,Mt)=>{const Lt=H(()=>Mt.createAutocomplete);wn(ge,{get id(){return m(c).id},class:"position-absolute start-0 top-0 bottom-0 ps-2 py-0",get disabled(){return e(M)},get name(){return e(y)},set name(ye){u(y,ye)},get input(){return e(h)},set input(ye){u(h,ye)},$$events:{focus:()=>{U("tagsFocused"),u(y,m(c).name),u(q,e(Lt)())},keydown:Pt,keyup:()=>{e(y).length===0&&(A==null||A.set(!1))},taginput:()=>s(m(c)),tagsplit:({detail:ye})=>ne(m(p),ye.start,ye.end),tagadd:()=>ae(m(p)),tagdelete:()=>ce(m(p)),tagselectall:async()=>{e(r).length<=1||(e(h).blur(),await Y(),Me())},tagjoinprevious:()=>kt(m(p)),tagjoinnext:()=>Ct(m(p)),tagmoveprevious:()=>At(m(p)),tagmovenext:()=>Nt(m(p)),tagaccept:()=>{Dt(m(c),m(p)),m(c)&&s(m(c)),j(),Xe()}},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0})}),K(V),G(()=>oe(V,"hide-tag",m(p)===e(w))),D(n,V)});var It=C(C(at,!0));return Fn(It,{$$events:{click:P},$$legacy:!0}),K(Pe),E("focusout",Pe,Et,!1),yt(Pe,"offsetHeight",n=>u(Le,n)),D(a,tt),vt(t,"appendEmptyTag",P),re({appendEmptyTag:P})}export{va as T,ma as d,mn as e};
