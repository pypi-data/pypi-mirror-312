import{n as Me,R as q}from"../chunks/backend.CJ3aQY-w.mjs";import{a as R,d as F,r as o,e as d,s,D as $e,F as re,M as Ie}from"../chunks/disclose-version.CXWUuFGG.mjs";import{p as J,t as S,b as X,l as ue,a as me,g as P,m as fe,s as pe,N as we,ag as K}from"../chunks/runtime.BJSnJeWl.mjs";import{i as Z}from"../chunks/lifecycle.DW1_rEFA.mjs";import{p as W,i as B}from"../chunks/props.fkJSEmZ6.mjs";import{s as xe,b as ee,a as Re}from"../chunks/store.CAPRemx4.mjs";import{p as je}from"../chunks/stores.vKwaDQ25.mjs";import{c as Ke,C as Pe}from"../chunks/Container.Bejr1Sze.mjs";import{R as oe}from"../chunks/Row.Ctd7J_Qx.mjs";import{s as L}from"../chunks/render.CQvFnAiW.mjs";import{V as Ye,W as Be,X as We,Y as Oe,Z as Ge,_ as ze,$ as De,a0 as Le,a1 as Ue,a2 as Fe,a3 as Te,a4 as He,a5 as Ve,a6 as Je,a7 as Xe,a8 as Ze,a9 as Qe,aa as et,ab as tt,ac as at,ad as rt,ae as st,af as it,ag as lt,ah as nt,q as Se,ai as ot,aj as vt,ak as ct,al as dt,am as ut,an as mt,ao as ft,ap as pt,aq as gt,v as bt,ar as te,as as _t,at as ht,au as yt,av as St}from"../chunks/runtime-require.xejYRuTk.mjs";import{e as H,i as V}from"../chunks/theme.ChRgnSdP.mjs";import{t as Y,D as $t,T as ke}from"../chunks/time.DXBFJJA9.mjs";import{y as wt,z as ve,A as xt,B as Rt,C as Dt,D as Lt,E as Ft,F as Tt,G as kt,H as Et,I as Ct,J as At,K as Nt,N as qt,L as Mt}from"../chunks/HoverColumns.iQYqBoln.mjs";import{m as It,I as jt}from"../chunks/InputBox.eflzsSvl.mjs";import{t as Kt}from"../chunks/time.ecLVQE0O.mjs";import{b as ae}from"../chunks/input.05BvnVQv.mjs";import{b as Pt}from"../chunks/this.C9pg2j_S.mjs";import{w as Yt}from"../chunks/index.BB25h7Qo.mjs";const Bt=async({params:i})=>({info:await Me({cid:BigInt(i.cardId)})}),Pa=Object.freeze(Object.defineProperty({__proto__:null,load:Bt},Symbol.toStringTag,{value:"Module"}));var Wt=F('<div class="card-info-placeholder svelte-1k3aa26"> </div>');function Ot(i,c){J(c,!1),Z();var a=Wt(),r=d(a);S(()=>L(r,Ye())),o(a),R(i,a),X()}var Gt=F('<tr><th class="align-start svelte-1ws7hzc"> </th><td> </td></tr>'),zt=F('<table class="stats-table align-start svelte-1ws7hzc"><tbody></tbody></table>');function Ut(i,c){J(c,!1);let a=W(c,"stats");function r(e){return new ke(Number(e)).dateString()}function v(e){const n=[];if(n.push({label:Be(),value:r(e.added)}),e.firstReview!=null&&n.push({label:We(),value:r(e.firstReview)}),e.latestReview!=null&&n.push({label:Oe(),value:r(e.latestReview)}),e.dueDate!=null&&n.push({label:Ge(),value:r(e.dueDate)}),e.duePosition!=null&&n.push({label:ze(),value:e.duePosition}),e.interval&&n.push({label:De(),value:Y(e.interval*$t)}),e.memoryState){let _=Y(e.memoryState.stability*86400,!1,!1);if(e.memoryState.stability>31){const u=e.memoryState.stability.toFixed(0);_+=` (${u})`}n.push({label:Le(),value:_});const t=((e.memoryState.difficulty-1)/9*100).toFixed(0);if(n.push({label:Ue(),value:`${t}%`}),e.fsrsRetrievability){const u=(e.fsrsRetrievability*100).toFixed(0);n.push({label:Fe(),value:`${u}%`})}}else e.ease&&n.push({label:Te(),value:`${e.ease/10}%`});n.push({label:He(),value:e.reviews}),n.push({label:Ve(),value:e.lapses}),e.totalSecs&&(n.push({label:Je(),value:Y(e.averageSecs)}),n.push({label:Xe(),value:Y(e.totalSecs)})),n.push({label:Ze(),value:e.cardType}),n.push({label:Qe(),value:e.notetype});let g;if(e.originalDeck?g=`${e.deck} (${e.originalDeck})`:g=e.deck,n.push({label:et(),value:g}),n.push({label:tt(),value:e.preset}),n.push({label:at(),value:e.cardId}),n.push({label:rt(),value:e.noteId}),e.customData){let _;try{const t=JSON.parse(e.customData);_=Object.entries(t).map(([u,m])=>`${u}=${m}`).join(" ")}catch{_=e.customData}n.push({label:st(),value:_})}return n}let w=fe();ue(()=>we(a()),()=>{pe(w,v(a()))}),me(),Z();var h=zt(),p=d(h);H(p,9,()=>P(w),V,(e,n,g)=>{var _=Gt(),t=d(_),u=d(t);o(t);var m=s(t),y=d(m);o(m),o(_),S(()=>{L(u,K(n).label),L(y,K(n).value)}),R(e,_)}),o(p),o(h),R(i,h),X()}const Ht=19/81,Vt=-.5,Jt=1e3;function ce(i,c){return Math.pow(c/i*Ht+1,Vt)}var $=(i=>(i[i.Week=0]="Week",i[i.Month=1]="Month",i[i.Year=2]="Year",i[i.AllTime=3]="AllTime",i))($||{});const Xt={0:7,1:30,2:365,3:1/0};function Zt(i,c){return i.filter(a=>a.daysSinceFirstLearn<=c)}function de(i){return i.reviewKind!==q.MANUAL&&i.reviewKind!==q.RESCHEDULED&&(i.reviewKind!==q.FILTERED||i.ease!==0)}function Qt(i){const c=[];for(const a of i){if(a.reviewKind===q.MANUAL&&a.ease===0)break;c.push(a)}return c.filter(a=>de(a))}function ea(i,c){const a=[];let r=0,v=0;const w=Math.min(c/Jt,1);let h=0;if(i.toReversed().forEach((t,u)=>{var k,D;const m=Number(t.time);if(u===0){r=m,v=((k=t.memoryState)==null?void 0:k.stability)||0,a.push({date:new Date(m*1e3),daysSinceFirstLearn:0,elapsedDaysSinceLastReview:0,retrievability:100,stability:v});return}const y=(m-r)/(24*60*60);let l=0;for(;l<y-w;){l+=w;const A=ce(v,l);a.push({date:new Date((r+l*86400)*1e3),daysSinceFirstLearn:a[a.length-1].daysSinceFirstLearn+w,elapsedDaysSinceLastReview:l,retrievability:A*100,stability:v})}h+=y,a.push({date:new Date((r+y*86400)*1e3),daysSinceFirstLearn:h,retrievability:100,elapsedDaysSinceLastReview:0,stability:v}),r=m,v=((D=t.memoryState)==null?void 0:D.stability)||0}),a.length===0)return[];const p=Date.now()/1e3,e=(p-r)/(24*60*60);let n=0;for(;n<e-w;){n+=w;const t=ce(v,n);a.push({date:new Date((r+n*86400)*1e3),daysSinceFirstLearn:a[a.length-1].daysSinceFirstLearn+w,elapsedDaysSinceLastReview:n,retrievability:t*100,stability:v})}h+=e;const g=ce(v,e);return a.push({date:new Date(p*1e3),daysSinceFirstLearn:h,elapsedDaysSinceLastReview:e,retrievability:g*100,stability:v}),Zt(a,c)}function Ee(i,c){if(i.length===0)return 0;const a=(Date.now()/1e3-Number(i[i.length-1].time))/(24*60*60);return Math.min(a,Xt[c])}function ta(i,c,a,r){const v=wt(a),w=v.transition().duration(600);if(i.length===0){ve(v,!1);return}const h=Ee(i,c),p=ea(i,h);if(p.length===0){ve(v,!1);return}else ve(v,!0);v.select(".forgetting-curve-line").remove(),v.select(".hover-columns").remove();const e=It(p,l=>l.date),n=xt(p,l=>l.date),g=Kt().domain([e,n]).range([r.marginLeft,r.width-r.marginRight]),_=Math.max(0,100-1.2*(100-Math.min(...p.map(l=>l.retrievability)))),t=Rt().domain([_,100]).range([r.height-r.marginBottom,r.marginTop]);v.select(".x-ticks").call(l=>l.transition(w).call(Dt(g).ticks(5).tickSizeOuter(0))).attr("direction","ltr"),v.select(".y-ticks").attr("transform",`translate(${r.marginLeft},0)`).call(l=>l.transition(w).call(Lt(t).tickSizeOuter(0))).attr("direction","ltr");const u=Ft().x(l=>g(l.date)).y(l=>t(l.retrievability));v.append("path").datum(p).attr("class","forgetting-curve-line").attr("fill","none").attr("stroke","steelblue").attr("stroke-width",1.5).attr("d",u);const m=v.append("line").attr("class","focus-line").attr("y1",r.marginTop).attr("y2",r.height-r.marginBottom).attr("stroke","black").attr("stroke-width",1).style("opacity",0);function y(l){return`${h>=365?"Date":"Date Time"}: ${h>=365?l.date.toLocaleDateString():l.date.toLocaleString()}<br>
        ${it()}: ${Y(l.elapsedDaysSinceLastReview*86400)}<br>${Fe()}: ${l.retrievability.toFixed(2)}%<br>${Le()}: ${Y(l.stability*86400)}`}v.append("g").attr("class","hover-columns").selectAll("rect").data(p).join("rect").attr("x",l=>g(l.date)-1).attr("y",r.marginTop).attr("width",2).attr("height",r.height-r.marginTop-r.marginBottom).attr("fill","transparent").on("mousemove",(l,k)=>{const[D,A]=Tt(l,document.body);m.attr("x1",g(k.date)-1).attr("x2",g(k.date)+1).style("opacity",1),kt(y(k),D,A)}).on("mouseout",()=>{m.style("opacity",0),Et()})}var aa=F('<div class="svelte-1bf093q"><b> </b> <span class="hidden-xs svelte-1bf093q"> </span></div>'),ra=F("<div> </div>"),sa=F("<div> </div>"),ia=F('<div class="svelte-1bf093q"> </div>'),la=F('<div class="svelte-1bf093q"> </div>'),na=F('<div class="svelte-1bf093q"> </div>'),oa=F('<div class="revlog-table svelte-1bf093q"><div class="column svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content svelte-1bf093q"></div></div> <div class="column hidden-xs svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content svelte-1bf093q"></div></div> <div class="column svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content svelte-1bf093q"></div></div> <div class="column svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content right svelte-1bf093q"></div></div> <div class="column hidden-xs svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content svelte-1bf093q"></div></div> <div class="column svelte-1bf093q"><div class="column-head svelte-1bf093q"> </div> <div class="column-content right svelte-1bf093q"></div></div> <!></div>');function va(i,c){J(c,!1);const a=fe();let r=W(c,"revlog"),v=W(c,"fsrsEnabled",0,!1);function w(t){switch(t.reviewKind){case q.LEARNING:return"revlog-learn";case q.REVIEW:return"revlog-review";case q.RELEARNING:return"revlog-relearn"}return""}function h(t){switch(t.reviewKind){case q.LEARNING:return pt();case q.REVIEW:return ft();case q.RELEARNING:return mt();case q.FILTERED:return ut();case q.MANUAL:return dt();case q.RESCHEDULED:return ct()}}function p(t){return t.buttonChosen===1?"revlog-ease1":""}function e(t,u){var y;const m=new ke(Number(t.time));return{date:m.dateString(),time:m.timeString(),reviewKind:h(t),reviewKindClass:w(t),rating:t.buttonChosen,ratingClass:p(t),interval:Y(t.interval),ease:n(t.ease),takenSecs:Y(t.takenSecs,!0),elapsedTime:u,stability:(y=t.memoryState)!=null&&y.stability?Y(t.memoryState.stability*86400):""}}function n(t){if(t===0)return"";const u=t/10;return u<=110?`D:${(u-10).toFixed(0)}%`:`${u.toFixed(0)}%`}ue(()=>we(r()),()=>{pe(a,r().map((t,u)=>{let m,y=u+1;for(;y<r().length;){if(de(r()[y])){m=r()[y];break}y++}let l="N/A";return de(t)&&(l=m?Y(Number(t.time)-Number(m.time)):"0"),e(t,l)}))}),me(),Z();var g=$e(),_=re(g);B(_,()=>r().length>0,t=>{var u=oa(),m=d(u),y=d(m),l=d(y);S(()=>L(l,lt())),o(y);var k=s(s(y,!0));H(k,9,()=>P(a),V,(M,C,Q)=>{var b=aa(),N=d(b),U=d(N);o(N);var he=s(s(N,!0)),qe=d(he);o(he),o(b),S(()=>{var ye;L(U,K(C).date),L(qe,`@ ${(ye=K(C).time)!=null?ye:""}`)}),R(M,b)}),o(k),o(m);var D=s(s(m,!0)),A=d(D),O=d(A);S(()=>L(O,nt())),o(A);var G=s(s(A,!0));H(G,9,()=>P(a),V,(M,C,Q)=>{var b=ra(),N=d(b);o(b),S(()=>{var U;Se(b,`${(U=K(C).reviewKindClass)!=null?U:""} svelte-1bf093q`),L(N,K(C).reviewKind)}),R(M,b)}),o(G),o(D);var z=s(s(D,!0)),I=d(z),T=d(I);S(()=>L(T,ot())),o(I);var f=s(s(I,!0));H(f,9,()=>P(a),V,(M,C,Q)=>{var b=sa(),N=d(b);o(b),S(()=>{var U;Se(b,`${(U=K(C).ratingClass)!=null?U:""} svelte-1bf093q`),L(N,K(C).rating)}),R(M,b)}),o(f),o(z);var E=s(s(z,!0)),j=d(E),x=d(j);S(()=>L(x,De())),o(j);var ge=s(s(j,!0));H(ge,9,()=>P(a),V,(M,C,Q)=>{var b=ia(),N=d(b);o(b),S(()=>L(N,K(C).interval)),R(M,b)}),o(ge),o(E);var se=s(s(E,!0)),ie=d(se),Ce=d(ie);S(()=>L(Ce,Te())),o(ie);var be=s(s(ie,!0));H(be,9,()=>P(a),V,(M,C,Q)=>{var b=la(),N=d(b);o(b),S(()=>L(N,K(C).ease)),R(M,b)}),o(be),o(se);var le=s(s(se,!0)),ne=d(le),Ae=d(ne);S(()=>L(Ae,vt())),o(ne);var _e=s(s(ne,!0));H(_e,9,()=>P(a),V,(M,C,Q)=>{var b=na(),N=d(b);o(b),S(()=>L(N,K(C).takenSecs)),R(M,b)}),o(_e),o(le);var Ne=s(s(le,!0));B(Ne,v,M=>{}),o(u),R(t,u)}),R(i,g),X()}var ca=F('<label class="svelte-6ja67r"><input type="radio" class="svelte-6ja67r"> </label>'),da=F('<label class="svelte-6ja67r"><input type="radio" class="svelte-6ja67r"> </label>'),ua=F('<label class="svelte-6ja67r"><input type="radio" class="svelte-6ja67r"> </label>'),ma=F('<label class="svelte-6ja67r"><input type="radio" class="svelte-6ja67r"> </label>'),fa=F('<div class="time-range-selector svelte-6ja67r"><!> <!> <!> <!></div>'),pa=Ie("<svg><!><!><!></svg>"),ga=F('<div class="forgetting-curve svelte-6ja67r"><!> <!></div>');function ba(i,c){J(c,!1);const a=xe(),r=()=>Re(t,"$timeRange",a),v=[];let w=W(c,"revlog"),h=fe(null);const p=Mt(),e=gt(),n=Qt(w()),g=Ee(n,$.AllTime);let _=$.Week;g>365?_=$.AllTime:g>30?_=$.Year:g>7&&(_=$.Month);const t=Yt(_);ue(()=>(r(),P(h)),()=>{ta(n,r(),P(h),p)}),me(),Z();var u=ga(),m=d(u);jt(m,{children:(l,k)=>{var D=fa(),A=d(D);B(A,()=>g>0,I=>{var T=ca(),f=d(T);te(f);var E,j=s(f,!0);S(()=>{var x;return L(j,` ${(x=_t())!=null?x:""}`)}),o(T),S(()=>{E!==(E=$.Week)&&(f.value=(f.__value=$.Week)==null?"":$.Week)}),ae(v,[],f,()=>($.Week,r()),x=>ee(t,x)),R(I,T)});var O=s(s(A,!0));B(O,()=>g>7,I=>{var T=da(),f=d(T);te(f);var E,j=s(f,!0);S(()=>{var x;return L(j,` ${(x=ht())!=null?x:""}`)}),o(T),S(()=>{E!==(E=$.Month)&&(f.value=(f.__value=$.Month)==null?"":$.Month)}),ae(v,[],f,()=>($.Month,r()),x=>ee(t,x)),R(I,T)});var G=s(s(O,!0));B(G,()=>g>30,I=>{var T=ua(),f=d(T);te(f);var E,j=s(f,!0);S(()=>{var x;return L(j,` ${(x=yt())!=null?x:""}`)}),o(T),S(()=>{E!==(E=$.Year)&&(f.value=(f.__value=$.Year)==null?"":$.Year)}),ae(v,[],f,()=>($.Year,r()),x=>ee(t,x)),R(I,T)});var z=s(s(G,!0));B(z,()=>g>365,I=>{var T=ma(),f=d(T);te(f);var E,j=s(f,!0);S(()=>{var x;return L(j,` ${(x=St())!=null?x:""}`)}),o(T),S(()=>{E!==(E=$.AllTime)&&(f.value=(f.__value=$.AllTime)==null?"":$.AllTime)}),ae(v,[],f,()=>($.AllTime,r()),x=>ee(t,x)),R(I,T)}),o(D),R(l,D)},$$slots:{default:!0},$$legacy:!0});var y=s(s(m,!0));Ct(y,{title:e,children:(l,k)=>{var D=pa();Pt(D,z=>pe(h,z),()=>P(h));var A=d(D);At(A,{bounds:p,$$legacy:!0});var O=s(A);Nt(O);var G=s(O);qt(G,{bounds:p,$$legacy:!0}),o(D),S(()=>bt(D,"viewBox",`0 0 ${p.width} ${p.height}`)),R(l,D)},$$slots:{default:!0},$$legacy:!0}),o(u),R(i,u),X()}var _a=F("<!> <!> <!>",1),ha=F('<div style="display: contents"><!></div>',1);function ya(i,c){J(c,!1);let a=W(c,"stats",0,null),r=W(c,"showRevlog",0,!0),v=W(c,"fsrsEnabled",8,()=>{var p;return((p=a())==null?void 0:p.memoryState)!=null});Z();var w=ha(),h=re(w);Ke(h,()=>({"--gutter-inline":"1rem","--gutter-block":"0.5rem"})),Pe(h.lastChild,{breakpoint:"md",children:(p,e)=>{var n=$e(),g=re(n);B(g,a,_=>{var t=_a(),u=re(t);oe(u,{children:(l,k)=>{Ut(l,{get stats(){return a()},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0});var m=s(s(u,!0));B(m,r,l=>{oe(l,{children:(k,D)=>{va(k,{get revlog(){return a().revlog},get fsrsEnabled(){return v()},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0})});var y=s(s(m,!0));B(y,v,l=>{oe(l,{children:(k,D)=>{ba(k,{get revlog(){return a().revlog},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0})}),R(_,t)},_=>{Ot(_,{$$legacy:!0})}),R(p,n)},$$slots:{default:!0},$$legacy:!0}),o(h),R(i,w),X()}function Ya(i,c){J(c,!1);const a=xe(),r=()=>Re(je,"$page",a);let v=W(c,"data");const w=r().url.searchParams.get("revlog")!=="0";Z(),ya(i,{get stats(){return v().info},showRevlog:w,$$legacy:!0}),X()}export{Ya as component,Pa as universal};
