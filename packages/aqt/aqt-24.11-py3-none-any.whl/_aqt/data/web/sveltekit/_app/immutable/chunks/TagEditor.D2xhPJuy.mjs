import{h as ot,b as Ot,U as Ft,c as Ut,a as N,d as B,r as H,F as Y,e as ee,s as A,t as ke,D as He,$ as lt}from"./disclose-version.CXWUuFGG.mjs";import{c as zt,W as Ht,o as Kt,k as Vt,p as le,R as gt,t as Z,b as re,V as X,g as e,a0 as z,s as u,m as I,l as he,a as Be,N as Ue,ag as m,a1 as We,U as Zt,ai as rt,ah as ct}from"./runtime.BJSnJeWl.mjs";import{e as E,s as ue}from"./render.CQvFnAiW.mjs";import{p as T,i as $e}from"./props.fkJSEmZ6.mjs";import{c as ht}from"./Container.DdPX9a09.mjs";import{p as Gt,e as mt,i as Jt}from"./theme.B6Eko5I8.mjs";import{r as Qt,aq as Xt,v as _e,q as vt,t as oe,bu as Yt,bv as en,bw as tn,bx as nn}from"./runtime-require.XfVPIJtJ.mjs";import{b as pt}from"./IconButton.CHADxjdB.mjs";import{r as an,p as we,s as sn,t as on,e as yt,I as je,v as ln,w as rn,S as Ee,g as Ie,x as cn,o as un,b as $t,y as fn,z as dn,A as gn,B as hn,h as mn,i as vn}from"./Shortcut.BeOdFNIa.mjs";import{i as fe}from"./lifecycle.DW1_rEFA.mjs";import{s as Ae,b as it,a as be}from"./store.CAPRemx4.mjs";import{b as L,s as me,d as ve,B as pn}from"./backend.DRML5B1x.mjs";import{c as de,o as _t}from"./index-client.D9hOaSri.mjs";import{d as yn,w as bt}from"./index.BB25h7Qo.mjs";import{d as Ke,W as St,P as Tt,D as qe,B as $n}from"./Badge.D2YMzTXS.mjs";import{a as _n}from"./input.CShFEa0B.mjs";import{b as Ve}from"./this.C9pg2j_S.mjs";import{W as bn}from"./WithTooltip.CnD4sClt.mjs";function Sn(a,t,f){ot&&Ot();var c=a,p=Ft,d;zt(()=>{Ht(p,p=t())&&(d&&Kt(d),d=Vt(()=>f(c)))}),ot&&(c=Ut)}function kt(a){const t=a.getRootNode();return t.getSelection?t.getSelection():document.getSelection()}function Tn(a){const t=a.rangeCount;return t===0?null:a.getRangeAt(t-1)}const ka=Symbol("direction"),Ze=Symbol("tagActionsShortcuts");function kn(a,t,f){document.execCommand(a,t,f)}function wt(a,t,f){if(!a.parentNode||a===t)return f;{const c=a.parentNode,p=[Array.prototype.indexOf.call(a.parentNode.childNodes,a),...f];return wt(c,t,p)}}function ut(a,t){return wt(a,t,[])}function Ge(a,t){if(t.length===0)return a;if(a.childNodes[t[0]]){const[f,...c]=t;return Ge(a.childNodes[f],c)}else return null}var Je=(a=>(a[a.Before=-1]="Before",a[a.Equal=0]="Equal",a[a.After=1]="After",a))(Je||{});function wn(a,t){const f=Math.min(a.coordinates.length,t.coordinates.length);for(let c=0;c<=f;c++){if(a.coordinates.length===c)return t.coordinates.length===c?a.offset<t.offset?-1:a.offset>t.offset?1:0:-1;if(t.coordinates.length===c)return 1;if(a.coordinates[c]<t.coordinates[c])return-1;if(a.coordinates[c]>t.coordinates[c])return 1}throw new Error("compareLocations: Should never happen")}function Cn(a){const t=kt(a),f=Tn(t);if(!f)return null;const c=f.collapsed,d={coordinates:ut(t.anchorNode,a),offset:t.anchorOffset};if(c)return{anchor:d,collapsed:c};const l={coordinates:ut(t.focusNode,a),offset:t.focusOffset},v=wn(d,l)===Je.After?"backward":"forward";return{anchor:d,focus:l,collapsed:c,direction:v}}function An(a){a.empty()}function Nn(a,t,f,c){const p=c.focus,d=p.offset,o=Ge(a,p.coordinates);c.direction==="forward"?(f.setEnd(o,d),t.addRange(f)):(t.addRange(f),t.extend(o,d))}function Dn(a){return Cn(a)}function Pn(a,t){const f=kt(a);An(f);const c=new Range,p=Ge(a,t.anchor.coordinates);c.setStart(p,t.anchor.offset),t.collapsed?(c.collapse(!0),f.addRange(c)):Nn(a,f,c,t)}Qt("anki/location",{Position:Je,restoreSelection:Pn,saveSelection:Dn});const te="∷";function ze(a){return a.replace(/::/g,te)}function Re(a){return a.replace(/\u2237/gu,"::")}function ft(a){let t=a.trim();for(;t.startsWith(":")||t.startsWith(te);)t=t.slice(1).trimStart();for(;t.endsWith(":")||t.endsWith(te);)t=t.slice(0,-1).trimEnd();return t}function Oe(a){return{id:Math.random().toString(36).substring(2),name:a,selected:!1,flash:()=>{}}}function xn(a){return a.name}var En=B('<input type="text" tabindex="-1" size="1">');const Ce=bt(null);yn(Ce,a=>()=>a==null?void 0:a.blur());function In(a,t){le(t,!1);const f=Ae(),c=()=>be(Ce,"$currentTagInput",f);let p=T(t,"id",0,void 0),d=T(t,"class",0,""),o=T(t,"name",4),l=T(t,"input",4),h=T(t,"disabled");const v=de();function y(){return l().selectionStart===l().selectionEnd}function $(){return l().selectionStart===0&&l().selectionEnd===0}function k(){return l().selectionStart===l().value.length&&l().selectionEnd===l().value.length}function r(s){l().setSelectionRange(s,s)}function q(){return o().length===0}async function C(s){const D=l().value.length;v("tagjoinprevious"),await X(),r(l().value.length-D),s.preventDefault()}async function K(s,D){if(D>o().length)return;o().slice(0,D).endsWith(te)&&(o(o().slice(0,D-1)+o().slice(D,o().length)),await X(),s.preventDefault(),r(D-1),v("taginput"))}function R(s){$()?C(s):K(s,l().selectionStart)}async function W(s){const D=l().value.length;v("tagjoinnext"),await X(),r(D),s.preventDefault()}function j(s){k()?W(s):K(s,l().selectionStart+2)}function w(){o(ft(o())),o().length===0&&v("tagdelete"),v("tagaccept")}function F(s){v("tagsplit",{start:l().selectionStart,end:l().selectionEnd}),s.preventDefault()}async function b(s,D=!1){const P=l().selectionStart,J=l().selectionEnd,U=o().slice(0,P),ne=o().slice(J,o().length);if(U.endsWith(te)){s.preventDefault(),s.stopPropagation();return}else if(U.endsWith(":")){s.preventDefault(),o(`${U.slice(0,-1)}${te}${o().slice(J,o().length)}`),await X(),r(P),v("taginput");return}else if(ne.startsWith(":"))s.preventDefault(),o(`${U}${te}${o().slice(J+1,o().length)}`);else{if(D)return;s.preventDefault(),o(`${U}${te}${ne}`)}await X(),r(P+1),v("taginput")}function g(s){switch(s.code){case"Enter":F(s);break;case"Backspace":y()&&R(s);break;case"Delete":y()&&j(s);break}sn(s)?q()?C(s):$()&&(v("tagmoveprevious"),s.preventDefault()):on(s)?q()?W(s):k()&&(v("tagmovenext"),s.preventDefault()):s.key===" "?b(s,!1):s.key===":"&&b(s,!0)}function O(s){const D=document.getSelection();s.clipboardData.setData("text/plain",Re(D.toString()))}function M(s){if(!s.clipboardData)return;const P=(o()+s.clipboardData.getData("text/plain")).split(/\s+/).map(ft).filter(U=>U.length>0).map(ze);if(P.length===0)return;const J=P.pop();for(const U of P.reverse())o(U),v("tagadd");o(J)}function x(s){o().length===0&&(s.preventDefault(),s.stopPropagation(),v("tagselectall"))}const{selectAllShortcut:Q}=gt(Ze);_t(()=>{an(x,Q,{target:l()}),l().focus()});function G(s){return it(Ce,s),{destroy(){c()===s&&it(Ce,null)}}}fe();var S=En();Ve(S,s=>l(s),()=>l()),Xt(S),Z(()=>{var s;_e(S,"id",p()),vt(S,`tag-input ${(s=d())!=null?s:""} svelte-1nk8ij0`),oe(S,"disabled",h())}),_n(S,o,s=>o(s)),E("focus",S,function(s){L.call(this,t,s)}),E("blur",S,we(w),!1),E("keydown",S,g,!1),E("keydown",S,function(s){L.call(this,t,s)}),E("keyup",S,function(s){L.call(this,t,s)}),E("input",S,()=>v("taginput"),!1),E("copy",S,we(O),!1),E("paste",S,we(M),!1),Ke(S,s=>G(s)),N(a,S),re()}var Rn=B("<!> <!>",1),Wn=B('<div class="tag-add-button svelte-1fo7hj6" role="button"><!> <span class="tags-info svelte-1fo7hj6"><!></span></div> <!>',1);function jn(a,t){le(t,!1);const f=Ae(),c=()=>be(Ce,"$currentTagInput",f);let p=T(t,"keyCombination");const d=de();function o(){d("tagappend")}fe();var l=Wn(),h=Y(l);const v=z(()=>Yt()),y=z(()=>Ie(p()));Z(()=>_e(h,"title",`${e(v)} (${e(y)})`));var $=ee(h);yt($,{children:(C,K)=>{var R=Rn(),W=Y(R);je(W,{icon:ln,$$legacy:!0});var j=A(A(W,!0));je(j,{icon:rn,$$legacy:!0}),N(C,R)},$$slots:{default:!0},$$legacy:!0});var k=A(A($,!0)),r=ee(k);me(r,ve(t),{}),H(k),H(h);var q=A(A(h,!0));Ee(q,{get keyCombination(){return p()},$$events:{action:()=>d("tagappend")},$$legacy:!0}),Z(()=>_e(h,"tabindex",c()?-1:0)),E("click",h,o,!1),E("focus",h,o,!1),N(a,l),re()}var Bn=B('<div class="tags-selected-button svelte-y9jxqs" role="button" tabindex="0"><!></div>'),Mn=B("<!> <!> <!>",1);function Ln(a,t){le(t,!1);const f=de();let c=I(!1);const{selectAllShortcut:p,copyShortcut:d,removeShortcut:o}=gt(Ze);fe(),St(a,{get show(){return e(c)},preferredPlacement:"top",get portalTarget(){return document.body},shift:0,children:(l,h)=>{const v=z(()=>h.asReference);var y=Bn(),$=ee(y);yt($,{children:(k,r)=>{je(k,{icon:cn,$$legacy:!0})},$$slots:{default:!0},$$legacy:!0}),H(y),Ke(y,k=>e(v)(k)),E("click",y,()=>u(c,!e(c)),!1),E("keydown",y,un(()=>u(c,!e(c))),!1),N(l,y)},$$slots:{default:!0,floating:(l,h)=>{Tt(l,{slot:"floating",children:(v,y)=>{var $=Mn(),k=Y($);qe(k,{$$events:{click:()=>f("tagselectall")},children:(C,K)=>{var R=ke();const W=z(()=>en()),j=z(()=>Ie(p));Z(()=>ue(R,`${e(W)} (${e(j)})`)),N(C,R)},$$slots:{default:!0},$$legacy:!0});var r=A(A(k,!0));qe(r,{$$events:{click:()=>f("tagcopy")},children:(C,K)=>{var R=ke();const W=z(()=>tn()),j=z(()=>Ie(d));Z(()=>ue(R,`${e(W)} (${e(j)})`)),N(C,R)},$$slots:{default:!0},$$legacy:!0});var q=A(A(r,!0));qe(q,{$$events:{click:()=>f("tagdelete")},children:(C,K)=>{var R=ke();const W=z(()=>nn()),j=z(()=>Ie(o));Z(()=>ue(R,`${e(W)} (${e(j)})`)),N(C,R)},$$slots:{default:!0},$$legacy:!0}),N(v,$)},$$slots:{default:!0},$$legacy:!0})}},$$legacy:!0}),re()}var qn=B('<div class="tag-options-button gap svelte-16efk4p"><!></div>');function On(a,t){let f=T(t,"badgeHeight",4),c=T(t,"tagsSelected"),p=T(t,"keyCombination");var d=qn(),o=ee(d);Sn(o,c,l=>{var h=He(),v=Y(h);$e(v,c,y=>{Ln(y,{$$events:{tagselectall($){L.call(this,t,$)},tagcopy($){L.call(this,t,$)},tagdelete($){L.call(this,t,$)}},$$legacy:!0})},y=>{jn(y,{get keyCombination(){return p()},$$events:{tagappend($){L.call(this,t,$)}},$$legacy:!0})}),N(l,h)}),H(d),$t(d,"offsetHeight",l=>f(l)),E("mousedown",d,we(function(l){L.call(this,t,l)})),N(a,d)}function Fn(a,t){let f=T(t,"class",0,"");$n(a,{get class(){var c;return`d-flex align-items-center ms-1 ${(c=f())!=null?c:""}`},iconSize:80,$$events:{click(c){L.call(this,t,c)}},children:(c,p)=>{je(c,{icon:fn,$$legacy:!0})},$$slots:{default:!0},$$legacy:!0})}var Un=B('<button tabindex="-1"><!></button>');function Fe(a,t){le(t,!1);let f=T(t,"class",0,""),c=T(t,"tagName"),p=T(t,"tooltip",0,void 0),d=T(t,"selected",0,!1);const o=de();let l=I(!1);function h(){u(l,!0),setTimeout(()=>u(l,!1),300)}let v=I();_t(()=>o("mount",{button:e(v)})),fe();var y=Un();Ve(y,k=>u(v,k),()=>e(v));var $=ee(y);return me($,ve(t),{}),H(y),Z(()=>{var k;vt(y,`tag d-inline-flex align-items-center text-nowrap ps-2 pe-1 ${(k=f())!=null?k:""} svelte-1ywoj88`),_e(y,"title",p()),_e(y,"data-addon-tag",c()),oe(y,"selected",d()),oe(y,"flashing",e(l))}),E("mousemove",y,function(k){L.call(this,t,k)}),E("click",y,function(k){L.call(this,t,k)}),N(a,y),pt(t,"flash",h),re({flash:h})}var zn=B(" <!>",1),Hn=B("<span> </span> <!>",1),Kn=B("<span> </span> <!>",1),Vn=B('<div class="svelte-11ejbji"><!></div>');function Zn(a,t){le(t,!1);const f=Ae(),c=()=>be(Gt,"$pageTheme",f),p=I();let d=T(t,"name"),o=T(t,"class",0,""),l=T(t,"tooltip"),h=T(t,"selected",4),v=T(t,"active"),y=T(t,"shorten"),$=T(t,"flash",4);const k=de();let r=I(!1),q=I(!1);function C(b){u(r,dn(b)),u(q,gn(b))}function K(){e(q)?k("tagrange"):e(r)?k("tagselect"):k("tagclick")}function R(b){const g=b.split(te);return g.length===1?b:`…${te}`+g[g.length-1]}function W(b){return b.split(te).length>1}const j="tag-icon-hover";he(()=>(e(r),e(q)),()=>{u(p,e(r)||e(q))}),Be(),fe();var w=Vn(),F=ee(w);$e(F,v,b=>{Fe(b,{get class(){return o()},get tagName(){return d()},$$events:{mousemove:C,click:K},children:(g,O)=>{var M=zn(),x=Y(M,!0),Q=A(x);me(Q,ve(t),{get selectMode(){return e(p)},hoverClass:j}),Z(()=>{var G;return ue(x,`${(G=d())!=null?G:""} `)}),N(g,M)},$$slots:{default:!0},$$legacy:!0})},b=>{var g=He(),O=Y(g);$e(O,()=>y()&&W(d()),M=>{bn(M,{get tooltip(){return l()},trigger:"hover",placement:"top",children:(x,Q)=>{const G=z(()=>Q.createTooltip);Fe(x,{get class(){return o()},get tagName(){return d()},get flash(){return $()},set flash(S){$(S)},get selected(){return h()},set selected(S){h(S)},$$events:{mousemove:C,click:K,mount:S=>e(G)(S.detail.button)},children:(S,s)=>{var D=Hn(),P=Y(D),J=ee(P);Z(()=>ue(J,R(d()))),H(P);var U=A(A(P,!0));me(U,ve(t),{get selectMode(){return e(p)},hoverClass:j}),N(S,D)},$$slots:{default:!0},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0})},M=>{Fe(M,{get class(){return o()},get tagName(){return d()},get flash(){return $()},set flash(x){$(x)},get selected(){return h()},set selected(x){h(x)},$$events:{mousemove:C,click:K},children:(x,Q)=>{var G=Kn(),S=Y(G),s=ee(S);H(S);var D=A(A(S,!0));me(D,ve(t),{get selectMode(){return e(p)},hoverClass:j}),Z(()=>ue(s,d())),N(x,G)},$$slots:{default:!0},$$legacy:!0})},!0),N(b,g)}),H(w),Z(()=>{oe(w,"select-mode",e(p)),oe(w,"night-mode",c().isDark),oe(w,"empty",d()==="")}),E("keydown",lt.body,C,!1),E("keyup",lt.body,C,!1),N(a,w),re()}function Gn(a,t){le(t,!1);let f=T(t,"name"),c=T(t,"class",0,""),p=T(t,"tooltip"),d=T(t,"selected"),o=T(t,"active"),l=T(t,"shorten"),h=T(t,"flash");const v=de();function y(){v("tagdelete")}fe(),Zn(a,{get name(){return f()},get class(){return c()},get tooltip(){return p()},get selected(){return d()},get active(){return o()},get shorten(){return l()},get flash(){return h()},$$events:{tagrange($){L.call(this,t,$)},tagselect($){L.call(this,t,$)},tagclick:()=>v("tagedit")},children:($,k)=>{const r=z(()=>k.selectMode),q=z(()=>k.hoverClass);Fn($,{get class(){return e(q)},$$events:{click:C=>{e(r)||(y(),C.stopPropagation())}},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0}),re()}var Jn=B('<div class="tag-spacer svelte-1k3couf" role="textbox" tabindex="-1"><br></div>');function Qn(a,t){var f=Jn();H(f),E("click",f,function(c){L.call(this,t,c)}),N(a,f)}var Xn=B('<div tabindex="-1" class="autocomplete-item svelte-1pjq6zk" role="button"><!></div>');function dt(a,t){le(t,!1);let f=T(t,"selected",0,!1),c=T(t,"active",0,!1),p=T(t,"suggestion"),d=I();he(()=>(Ue(f()),e(d)),()=>{f()&&e(d)&&e(d).scrollIntoViewIfNeeded({behavior:"smooth",block:"start"})}),Be();var o=Xn();Ve(o,h=>u(d,h),()=>e(d));var l=ee(o);me(l,ve(t),{}),H(o),Z(()=>{_e(o,"data-addon-suggestion",p()),oe(o,"selected",f()),oe(o,"active",c())}),E("mousedown",o,we(function(h){L.call(this,t,h)})),E("mouseup",o,function(h){L.call(this,t,h)}),E("mouseenter",o,function(h){L.call(this,t,h)}),E("mouseleave",o,function(h){L.call(this,t,h)}),N(a,o),re()}var Yn=B('<span class="autocomplete-reference svelte-1bkz961"><!></span>'),ea=B('<div class="autocomplete-menu svelte-1bkz961"></div>'),ta=B('<div style="display: contents"><!></div>',1);function na(a,t){le(t,!1);const f=Ae(),c=()=>be(d(),"$show",f);let p=T(t,"suggestionsPromise"),d=T(t,"show"),o=I([]),l=I(null),h=I(!1);const v=de();function y(){e(l)===null?u(l,0):e(l)>=e(o).length-1?u(l,null):We(l)}function $(){e(l)===null?u(l,e(o).length-1):e(l)===0?u(l,null):We(l,-1)}async function k(){var g;v("select",{selected:e(o)[(g=e(l))!=null?g:-1]})}async function r(){y(),await k()}async function q(){$(),await k()}async function C(){var g;e(o).length&&(u(h,!0),v("choose",{chosen:e(o)[(g=e(l))!=null?g:-1]}),await X(),d().set(!1))}async function K(){await X(),v("update")}function R(){return e(l)!==null}function W(){return{selectPrevious:q,selectNext:r,chooseSelected:C,update:K,hasSelected:R}}function j(g){u(l,g),u(h,!0)}function w(g){j(g)}async function F(g){u(h,!1),v("select",{selected:e(o)[g]})}function b(g,O){g.buttons===1&&j(O)}he(()=>(Ue(p()),Ue(d())),()=>{p().then(g=>{d().set(g.length>0),hn()&&navigator.userAgent.match(/Chrome\/77/)&&(g=g.slice(0,10)),u(o,g)})}),Be(),fe(),St(a,{keepOnKeyup:!0,get show(){return c()},preferredPlacement:"top",$$events:{close:()=>d().set(!1)},children:(g,O)=>{const M=z(()=>O.asReference);var x=Yn(),Q=ee(x);me(Q,ve(t),{createAutocomplete:W}),H(x),Ke(x,G=>e(M)(G)),N(g,x)},$$slots:{default:!0,floating:(g,O)=>{var M=ta(),x=Y(M);ht(x,()=>({"--popover-padding-inline":"0"})),Tt(x.lastChild,{slot:"floating",children:(Q,G)=>{var S=ea();mt(S,9,()=>e(o),Jt,(s,D,P)=>{var J=He(),U=Y(J);$e(U,()=>m(P)===e(l),ne=>{dt(ne,{selected:!0,get active(){return e(h)},get suggestion(){return m(D)},$$events:{mousedown:()=>w(m(P)),mouseup:()=>{F(m(P)),C()},mouseenter:ae=>b(ae,m(P)),mouseleave:()=>u(h,!1)},children:(ae,ce)=>{var ie=ke();Z(()=>ue(ie,m(D))),N(ae,ie)},$$slots:{default:!0},$$legacy:!0})},ne=>{dt(ne,{get suggestion(){return m(D)},$$events:{mousedown:()=>w(m(P)),mouseup:()=>{F(m(P)),C()},mouseenter:ae=>b(ae,m(P))},children:(ae,ce)=>{var ie=ke();Z(()=>ue(ie,m(D))),N(ae,ie)},$$slots:{default:!0},$$legacy:!0})}),N(s,J)}),H(S),N(Q,S)},$$slots:{default:!0},$$legacy:!0}),H(x),N(g,M)}},$$legacy:!0}),re()}var aa=B("<!> <!> <!>",1),sa=B('<div class="tag-relative svelte-1tsu84n"><!> <!></div>'),oa=B('<!> <div class="tag-editor svelte-1tsu84n"><div style="display: contents"><!></div> <!> <!></div>',1);function wa(a,t){le(t,!1);const f=Ae(),c=()=>be(h(),"$tags",f),p=()=>be(C,"$show",f),d=I(),o=I(),l=I();let h=T(t,"tags"),v=T(t,"keyCombination",0,"Control+Shift+T");const y="Control+A",$="Control+C",k="Backspace";Zt(Ze,{selectAllShortcut:y,copyShortcut:$,removeShortcut:k});let r=I();function q(n){u(r,n.map(i=>Oe(ze(i))))}const C=bt(!1),K=de(),R=Promise.resolve([]);let W=I(R);function j(){const n=e(r).map(i=>i.name).map(Re);K("tagsupdate",{tags:n}),u(W,R)}let w=I(null),F=null,b=I(""),g=I(),O=I(),M=I(!1);async function x(n){const{tags:i}=await pn({input:n,matchLimit:500});return i}const Q=/^:?([^:].*?[^:]):?$/;function G(){const i=e(r)[e(w)].name;if(u(M,i.length===0),e(M))u(W,R);else{const _=Re(i),V=Q.test(_)?_.replace(Q,"$1"):_;u(W,x(V).then(se=>(u(M,se.length===0),se.map(ze))))}}function S(n){const i=e(r)[e(w)];u(b,n!=null?n:i.name);const _=e(g).value.length;e(g).setSelectionRange(_,_)}async function s(n){n.name=e(b),u(r,e(r)),await X(),e(g)&&e(O).update()}function D(n){F===null&&(F=n)}function P(){pe();const n=e(r)[e(r).length-1];(!n||n.name.length>0)&&J(e(r).length-1,"");const i=e(w)===null;u(w,null),i&&Xe()}function J(n,i){e(r).splice(n+1,0,Oe(i)),u(r,e(r)),D(n+1)}function U(n){const i=e(r).map(xn);i.splice(n,1);const _=i.indexOf(e(b));return _>=0?(e(r)[_>=n?_+1:_].flash(),!1):!0}async function ne(n,i,_){const V=e(b).slice(0,i),se=e(b).slice(_);u(b,V),await X(),J(n,se),u(w,null),await X(),n!==e(w)&&e(g).setSelectionRange(0,0)}function ae(n){U(n)&&(e(r).splice(n,0,Oe(e(b))),We(w),u(r,e(r)))}function ce(n){const i=e(r).splice(n,1)[0];return u(r,e(r)),F!==null&&F>n&&F--,i}function ie(n){return n===0}function Qe(n){return n===e(r).length-1}function Ct(n){if(ie(n))return;const i=ce(n-1);u(b,i.name+e(b)),We(w,-1),s(e(r)[e(w)])}function At(n){if(Qe(n))return;const i=ce(n+1);u(b,e(b)+i.name),s(e(r)[e(w)])}function Nt(n){ie(n)||(F=n-1,u(w,null),e(g).blur())}async function Dt(n){if(Qe(n)){e(b).length!==0&&(J(n,""),u(w,null));return}F=n+1,u(w,null),e(g).blur(),await X(),e(g).setSelectionRange(0,0)}function Pt(n,i){e(r).includes(n)&&(U(i)||ce(i))}function Xe(){u(w,F),F=null}function xt(n){if(mn(n)){e(O).selectPrevious(),n.preventDefault();return}else if(vn(n)){e(O).selectNext(),n.preventDefault();return}switch(n.code){case"Tab":if(p())n.shiftKey?e(O).selectPrevious():e(O).selectNext();else break;n.preventDefault();break;case"Enter":e(O).chooseSelected(),n.preventDefault();break}}let Se=null,Ne=null;function Ye(n){ct(r,e(r)[n].selected=!e(r)[n].selected),u(r,e(r)),Se=n}function Et(n){if(Se===null){Ye(n);return}Ne=n;const i=Math.min(Se,Ne),_=Math.max(Se,Ne);for(let V=i;V<=_;V++)ct(r,e(r)[V].selected=!0);u(r,e(r))}function pe(){u(r,e(r).map(n=>({...n,selected:!1}))),Se=null,Ne=null}function It(n){const i=n.currentTarget;(n.relatedTarget===null||!i.contains(n.relatedTarget))&&pe()}function Rt(n){const i=document.createElement("textarea");i.value=n,i.setAttribute("readonly",""),i.style.position="absolute",i.style.left="-9999px",document.body.appendChild(i),i.select(),kn("copy"),document.body.removeChild(i)}function Me(){for(const n of e(r))n.selected=!0;u(r,e(r))}function et(){const n=e(r).filter(i=>i.selected).map(i=>Re(i.name)).join(`
`);Rt(n),pe()}function tt(){e(r).map((n,i)=>[n.selected,i]).filter(([n])=>n).reverse().forEach(([,n])=>ce(n)),pe(),j()}let Le=I(),De=I();he(()=>c(),()=>{q(c())}),he(()=>(e(Le),e(De)),()=>{u(d,Math.floor(e(Le)/e(De)))}),he(()=>(e(o),e(d)),()=>{u(o,e(o)||e(d)>2)}),he(()=>e(r),()=>{u(l,e(r).some(n=>n.selected))}),Be(),fe();var nt=oa(),at=Y(nt);$e(at,()=>e(l),n=>{var i=aa(),_=Y(i);Ee(_,{keyCombination:y,$$events:{action:Me},$$legacy:!0});var V=A(A(_,!0));Ee(V,{keyCombination:$,$$events:{action:et},$$legacy:!0});var se=A(A(V,!0));Ee(se,{keyCombination:k,$$events:{action:tt},$$legacy:!0}),N(n,i)});var Pe=A(A(at,!0)),xe=ee(Pe);ht(xe,()=>({"--icon-align":"baseline"})),On(xe.lastChild,{get badgeHeight(){return e(De)},set badgeHeight(n){u(De,n)},get tagsSelected(){return e(l)},get keyCombination(){return v()},$$events:{tagselectall:Me,tagcopy:et,tagdelete:tt,tagappend:P},$$legacy:!0}),H(xe);var st=A(A(xe,!0));mt(st,7,()=>e(r),(n,i)=>m(n).id,(n,i,_)=>{var V=sa(),se=ee(V),jt=z(()=>m(_)===e(w)?e(b):m(i).name),Bt=z(()=>m(_)===e(w));Gn(se,{class:"ms-0",get name(){return e(jt)},get tooltip(){return m(i).name},get active(){return e(Bt)},get shorten(){return e(o)},get flash(){return m(i).flash},set flash(Te){m(i).flash=Te,rt(()=>e(r))},get selected(){return m(i).selected},set selected(Te){m(i).selected=Te,rt(()=>e(r))},$$events:{tagedit:()=>{u(w,m(_)),pe()},tagselect:()=>Ye(m(_)),tagrange:()=>Et(m(_)),tagdelete:()=>{pe(),ce(m(_)),j()}},$$legacy:!0});var Mt=A(A(se,!0));$e(Mt,()=>m(_)===e(w),Te=>{na(Te,{get suggestionsPromise(){return e(W)},show:C,$$events:{update:G,select:({detail:ge})=>S(ge.selected),choose:({detail:ge})=>{S(ge.chosen),ne(m(_),ge.chosen.length,ge.chosen.length)}},children:(ge,Lt)=>{const qt=z(()=>Lt.createAutocomplete);In(ge,{get id(){return m(i).id},class:"position-absolute start-0 top-0 bottom-0 ps-2 py-0",get disabled(){return e(M)},get name(){return e(b)},set name(ye){u(b,ye)},get input(){return e(g)},set input(ye){u(g,ye)},$$events:{focus:()=>{K("tagsFocused"),u(b,m(i).name),u(O,e(qt)())},keydown:xt,keyup:()=>{e(b).length===0&&(C==null||C.set(!1))},taginput:()=>s(m(i)),tagsplit:({detail:ye})=>ne(m(_),ye.start,ye.end),tagadd:()=>ae(m(_)),tagdelete:()=>ce(m(_)),tagselectall:async()=>{e(r).length<=1||(e(g).blur(),await X(),Me())},tagjoinprevious:()=>Ct(m(_)),tagjoinnext:()=>At(m(_)),tagmoveprevious:()=>Nt(m(_)),tagmovenext:()=>Dt(m(_)),tagaccept:()=>{Pt(m(i),m(_)),m(i)&&s(m(i)),j(),Xe()}},$$legacy:!0})},$$slots:{default:!0},$$legacy:!0})}),H(V),Z(()=>oe(V,"hide-tag",m(_)===e(w))),N(n,V)});var Wt=A(A(st,!0));return Qn(Wt,{$$events:{click:P},$$legacy:!0}),H(Pe),E("focusout",Pe,It,!1),$t(Pe,"offsetHeight",n=>u(Le,n)),N(a,nt),pt(t,"appendEmptyTag",P),re({appendEmptyTag:P})}export{wa as T,ka as d,kn as e};
