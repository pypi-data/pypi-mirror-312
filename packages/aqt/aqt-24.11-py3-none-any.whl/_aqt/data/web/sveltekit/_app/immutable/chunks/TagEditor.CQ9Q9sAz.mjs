import{a as C,b as j,t as ke,e as Ue}from"./disclose-version.CfFqPxFi.mjs";import{h as lt,d as Ft,c as Ht,P as Kt,x as Ut,w as Yt,z as Zt,al as Vt,p as le,Y as mt,t as K,B as ee,b as re,$ as J,aM as Q,M as X,O as V,N as U,g as e,ay as q,aY as Ae,s as u,n as _e,m as x,L as Gt,l as he,a as Be,a_ as rt,K as He,aC as je,_ as Jt,a$ as ct,aZ as it}from"./runtime.HDa-Uzkj.mjs";import{e as D,s as ue}from"./render.dASvSx6G.mjs";import{p as w,a as be}from"./props.QYk8O08b.mjs";import{c as vt}from"./Container.Bg8eoZF8.mjs";import{p as Qt,e as pt,i as Xt}from"./theme.s4KsMAK4.mjs";import{r as en,ar as tn,v as ye,q as _t,t as oe,bw as nn,bx as an,by as sn,bz as on}from"./runtime-require.BBZ7uOG6.mjs";import{b as bt}from"./IconButton.oCTBfok1.mjs";import{s as ln,b as B,p as $e,t as rn,v as cn,f as yt,I as Me,w as un,x as fn,S as Ie,g as Re,y as dn,o as gn,a as St,z as hn,A as mn,B as vn,C as ut,j as pn,i as _n}from"./Shortcut.C6rkVHcI.mjs";import{i as fe}from"./lifecycle.BeemcHx2.mjs";import{s as Ne,b as ft,a as Se}from"./store.CtPiLHV-.mjs";import{s as me,x as bn}from"./backend.CfM7jizc.mjs";import{c as de,o as Tt}from"./index-client.BU-Y10jg.mjs";import{d as yn,w as wt}from"./index.BBTf1svy.mjs";import{d as Ye,W as kt,P as $t,D as ze,B as Sn}from"./Badge.Dgvf7yW4.mjs";import{a as Tn}from"./input.DOaqAHqV.mjs";import{b as Ze}from"./this.DuXIBV3p.mjs";import{W as wn}from"./WithTooltip.CdnE-Bs1.mjs";function kn(a,t,d){lt&&Ft();var c=a,p=Vt,f;Ht(()=>{Kt(p,p=t())&&(f&&Ut(f),f=Yt(()=>d(c)))}),lt&&(c=Zt)}function Ct(a){const t=a.getRootNode();return t.getSelection?t.getSelection():document.getSelection()}function $n(a){const t=a.rangeCount;return t===0?null:a.getRangeAt(t-1)}const Ca=Symbol("direction"),Ve=Symbol("tagActionsShortcuts");function Cn(a,t,d){document.execCommand(a,t,d)}function At(a,t,d){if(!a.parentNode||a===t)return d;{const c=a.parentNode,p=[Array.prototype.indexOf.call(a.parentNode.childNodes,a),...d];return At(c,t,p)}}function dt(a,t){return At(a,t,[])}function Ge(a,t){if(t.length===0)return a;if(a.childNodes[t[0]]){const[d,...c]=t;return Ge(a.childNodes[d],c)}else return null}var Je=(a=>(a[a.Before=-1]="Before",a[a.Equal=0]="Equal",a[a.After=1]="After",a))(Je||{});function An(a,t){const d=Math.min(a.coordinates.length,t.coordinates.length);for(let c=0;c<=d;c++){if(a.coordinates.length===c)return t.coordinates.length===c?a.offset<t.offset?-1:a.offset>t.offset?1:0:-1;if(t.coordinates.length===c)return 1;if(a.coordinates[c]<t.coordinates[c])return-1;if(a.coordinates[c]>t.coordinates[c])return 1}throw new Error("compareLocations: Should never happen")}function Nn(a){const t=Ct(a),d=$n(t);if(!d)return null;const c=d.collapsed,f={coordinates:dt(t.anchorNode,a),offset:t.anchorOffset};if(c)return{anchor:f,collapsed:c};const r={coordinates:dt(t.focusNode,a),offset:t.focusOffset},v=An(f,r)===Je.After?"backward":"forward";return{anchor:f,focus:r,collapsed:c,direction:v}}function Pn(a){a.empty()}function Dn(a,t,d,c){const p=c.focus,f=p.offset,l=Ge(a,p.coordinates);c.direction==="forward"?(d.setEnd(l,f),t.addRange(d)):(t.addRange(d),t.extend(l,f))}function xn(a){return Nn(a)}function En(a,t){const d=Ct(a);Pn(d);const c=new Range,p=Ge(a,t.anchor.coordinates);c.setStart(p,t.anchor.offset),t.collapsed?(c.collapse(!0),d.addRange(c)):Dn(a,d,c,t)}en("anki/location",{Position:Je,restoreSelection:En,saveSelection:xn});const te="âˆ·";function Ke(a){return a.replace(/::/g,te)}function We(a){return a.replace(/\u2237/gu,"::")}function gt(a){let t=a.trim();for(;t.startsWith(":")||t.startsWith(te);)t=t.slice(1).trimStart();for(;t.endsWith(":")||t.endsWith(te);)t=t.slice(0,-1).trimEnd();return t}function qe(a){return{id:Math.random().toString(36).substring(2),name:a,selected:!1,flash:()=>{}}}function In(a){return a.name}const Ce=wt(null);yn(Ce,a=>()=>a==null?void 0:a.blur());var Rn=j('<input type="text" tabindex="-1" size="1">');function Wn(a,t){le(t,!1);const d=Ne(),c=()=>Se(Ce,"$currentTagInput",d);let p=w(t,"id",8,void 0),f=w(t,"class",8,""),l=w(t,"name",12),r=w(t,"input",12),m=w(t,"disabled",8);const v=de();function _(){return r().selectionStart===r().selectionEnd}function b(){return r().selectionStart===0&&r().selectionEnd===0}function $(){return r().selectionStart===r().value.length&&r().selectionEnd===r().value.length}function s(o){r().setSelectionRange(o,o)}function E(){return l().length===0}async function k(o){const A=r().value.length;v("tagjoinprevious"),await J(),s(r().value.length-A),o.preventDefault()}async function F(o,A){if(A>l().length)return;l().slice(0,A).endsWith(te)&&(l(l().slice(0,A-1)+l().slice(A,l().length)),await J(),o.preventDefault(),s(A-1),v("taginput"))}function I(o){b()?k(o):F(o,r().selectionStart)}async function R(o){const A=r().value.length;v("tagjoinnext"),await J(),s(A),o.preventDefault()}function W(o){$()?R(o):F(o,r().selectionStart+2)}function g(){l(gt(l())),l().length===0&&v("tagdelete"),v("tagaccept")}function O(o){v("tagsplit",{start:r().selectionStart,end:r().selectionEnd}),o.preventDefault()}async function S(o,A=!1){const N=r().selectionStart,Z=r().selectionEnd,z=l().slice(0,N),ne=l().slice(Z,l().length);if(z.endsWith(te)){o.preventDefault(),o.stopPropagation();return}else if(z.endsWith(":")){o.preventDefault(),l(`${z.slice(0,-1)}${te}${l().slice(Z,l().length)}`),await J(),s(N),v("taginput");return}else if(ne.startsWith(":"))o.preventDefault(),l(`${z}${te}${l().slice(Z+1,l().length)}`);else{if(A)return;o.preventDefault(),l(`${z}${te}${ne}`)}await J(),s(N+1),v("taginput")}function h(o){switch(o.code){case"Enter":O(o);break;case"Backspace":_()&&I(o);break;case"Delete":_()&&W(o);break}rn(o)?E()?k(o):b()&&(v("tagmoveprevious"),o.preventDefault()):cn(o)?E()?R(o):$()&&(v("tagmovenext"),o.preventDefault()):o.key===" "?S(o,!1):o.key===":"&&S(o,!0)}function L(o){const A=document.getSelection();o.clipboardData.setData("text/plain",We(A.toString()))}function M(o){if(!o.clipboardData)return;const N=(l()+o.clipboardData.getData("text/plain")).split(/\s+/).map(gt).filter(z=>z.length>0).map(Ke);if(N.length===0)return;const Z=N.pop();for(const z of N.reverse())l(z),v("tagadd");l(Z)}function P(o){l().length===0&&(o.preventDefault(),o.stopPropagation(),v("tagselectall"))}const{selectAllShortcut:G}=mt(Ve);Tt(()=>{ln(P,G,{target:r()}),r().focus()});function Y(o){return ft(Ce,o),{destroy(){c()===o&&ft(Ce,null)}}}fe();var T=Rn();Ze(T,o=>r(o),()=>r()),tn(T),K(()=>{var o;ye(T,"id",p()),_t(T,`tag-input ${(o=f())!=null?o:""} svelte-1nk8ij0`),oe(T,"disabled",m())}),ee(()=>Tn(T,l)),ee(()=>D("focus",T,function(o){B.call(this,t,o)})),ee(()=>D("blur",T,$e(g))),ee(()=>D("keydown",T,h)),ee(()=>D("keydown",T,function(o){B.call(this,t,o)})),ee(()=>D("keyup",T,function(o){B.call(this,t,o)})),ee(()=>D("input",T,()=>v("taginput"))),ee(()=>D("copy",T,$e(L))),ee(()=>D("paste",T,$e(M))),Ye(T,o=>Y(o)),C(a,T),re()}var jn=j("<!> <!>",1),Mn=j('<div class="tag-add-button svelte-1fo7hj6" role="button"><!> <span class="tags-info svelte-1fo7hj6"><!></span></div> <!>',1);function Bn(a,t){le(t,!1);const d=Ne(),c=()=>Se(Ce,"$currentTagInput",d);let p=w(t,"keyCombination",8);const f=de();function l(){f("tagappend")}fe();var r=Mn(),m=Q(r);const v=q(()=>{var k;return(k=nn())!=null?k:""}),_=q(()=>{var k;return(k=Re(p()))!=null?k:""});K(()=>ye(m,"title",`${e(v)} (${e(_)})`));var b=X(m);yt(b,{children:(k,F)=>{var I=jn(),R=Q(I);Me(R,{icon:un});var W=V(R,2);Me(W,{icon:fn}),C(k,I)},$$slots:{default:!0}});var $=V(b,2),s=X($);me(s,t,"default",{}),U($),U(m);var E=V(m,2);Ie(E,{get keyCombination(){return p()},$$events:{action:()=>f("tagappend")}}),K(()=>ye(m,"tabindex",c()?-1:0)),D("click",m,l),D("focus",m,l),C(a,r),re()}var Ln=j('<div class="tags-selected-button svelte-y9jxqs" role="button" tabindex="0"><!></div>'),On=j("<!> <!> <!>",1);function zn(a,t){le(t,!1);const d=de();let c=x(!1);const{selectAllShortcut:p,copyShortcut:f,removeShortcut:l}=mt(Ve);fe(),kt(a,{get show(){return e(c)},preferredPlacement:"top",portalTarget:document.body,shift:0,children:Ae,$$slots:{default:(r,m)=>{const v=q(()=>m.asReference);var _=Ln(),b=Gt(()=>gn(()=>u(c,!e(c)))),$=X(_);yt($,{children:(s,E)=>{Me(s,{icon:dn})},$$slots:{default:!0}}),U(_),Ye(_,s=>e(v)(s)),ee(()=>D("click",_,()=>u(c,!e(c)))),ee(()=>D("keydown",_,function(...s){var E;(E=e(b))==null||E.apply(this,s)})),C(r,_)},floating:(r,m)=>{$t(r,{slot:"floating",children:(v,_)=>{var b=On(),$=Q(b);ze($,{$$events:{click:()=>d("tagselectall")},children:(k,F)=>{_e();var I=ke();const R=q(()=>{var g;return(g=an())!=null?g:""}),W=q(()=>{var g;return(g=Re(p))!=null?g:""});K(()=>ue(I,`${e(R)} (${e(W)})`)),C(k,I)},$$slots:{default:!0}});var s=V($,2);ze(s,{$$events:{click:()=>d("tagcopy")},children:(k,F)=>{_e();var I=ke();const R=q(()=>{var g;return(g=sn())!=null?g:""}),W=q(()=>{var g;return(g=Re(f))!=null?g:""});K(()=>ue(I,`${e(R)} (${e(W)})`)),C(k,I)},$$slots:{default:!0}});var E=V(s,2);ze(E,{$$events:{click:()=>d("tagdelete")},children:(k,F)=>{_e();var I=ke();const R=q(()=>{var g;return(g=on())!=null?g:""}),W=q(()=>{var g;return(g=Re(l))!=null?g:""});K(()=>ue(I,`${e(R)} (${e(W)})`)),C(k,I)},$$slots:{default:!0}}),C(v,b)},$$slots:{default:!0}})}}}),re()}var qn=j('<div class="tag-options-button gap svelte-16efk4p"><!></div>');function Fn(a,t){let d=w(t,"badgeHeight",12),c=w(t,"tagsSelected",8),p=w(t,"keyCombination",8);var f=qn(),l=X(f);kn(l,c,r=>{var m=Ue(),v=Q(m);be(v,c,_=>{zn(_,{$$events:{tagselectall(b){B.call(this,t,b)},tagcopy(b){B.call(this,t,b)},tagdelete(b){B.call(this,t,b)}}})},_=>{Bn(_,{get keyCombination(){return p()},$$events:{tagappend(b){B.call(this,t,b)}}})}),C(r,m)}),U(f),St(f,"offsetHeight",d),D("mousedown",f,$e(function(r){B.call(this,t,r)})),C(a,f)}function Hn(a,t){let d=w(t,"class",8,"");Sn(a,{get class(){var c;return`d-flex align-items-center ms-1 ${(c=d())!=null?c:""}`},iconSize:80,$$events:{click(c){B.call(this,t,c)}},children:(c,p)=>{Me(c,{icon:hn})},$$slots:{default:!0}})}var Kn=j('<button tabindex="-1"><!></button>');function Fe(a,t){le(t,!1);let d=w(t,"class",8,""),c=w(t,"tagName",8),p=w(t,"tooltip",8,void 0),f=w(t,"selected",8,!1);const l=de();let r=x(!1);function m(){u(r,!0),setTimeout(()=>u(r,!1),300)}let v=x();Tt(()=>l("mount",{button:e(v)})),fe();var _=Kn();Ze(_,$=>u(v,$),()=>e(v));var b=X(_);return me(b,t,"default",{}),U(_),K(()=>{var $;_t(_,`tag d-inline-flex align-items-center text-nowrap ps-2 pe-1 ${($=d())!=null?$:""} svelte-1ywoj88`),ye(_,"title",p()),ye(_,"data-addon-tag",c()),oe(_,"selected",f()),oe(_,"flashing",e(r))}),D("mousemove",_,function($){B.call(this,t,$)}),D("click",_,function($){B.call(this,t,$)}),C(a,_),bt(t,"flash",m),re({flash:m})}var Un=j(" <!>",1),Yn=j("<span> </span> <!>",1),Zn=j("<span> </span> <!>",1),Vn=j('<div class="svelte-11ejbji"><!></div>');function Gn(a,t){le(t,!1);const d=Ne(),c=()=>Se(Qt,"$pageTheme",d),p=x();let f=w(t,"name",8),l=w(t,"class",8,""),r=w(t,"tooltip",8),m=w(t,"selected",12),v=w(t,"active",8),_=w(t,"shorten",8),b=w(t,"flash",12);const $=de();let s=x(!1),E=x(!1);function k(S){u(s,mn(S)),u(E,vn(S))}function F(){e(E)?$("tagrange"):e(s)?$("tagselect"):$("tagclick")}function I(S){const h=S.split(te);return h.length===1?S:`â€¦${te}`+h[h.length-1]}function R(S){return S.split(te).length>1}const W="tag-icon-hover";he(()=>(e(s),e(E)),()=>{u(p,e(s)||e(E))}),Be(),fe();var g=Vn();D("keydown",rt.body,k),D("keyup",rt.body,k);var O=X(g);be(O,v,S=>{Fe(S,{get class(){return l()},get tagName(){return f()},$$events:{mousemove:k,click:F},children:(h,L)=>{_e();var M=Un(),P=Q(M),G=V(P);me(G,t,"default",{get selectMode(){return e(p)},hoverClass:W}),K(()=>{var Y;return ue(P,`${(Y=f())!=null?Y:""} `)}),C(h,M)},$$slots:{default:!0}})},S=>{var h=Ue(),L=Q(h);be(L,()=>_()&&R(f()),M=>{wn(M,{get tooltip(){return r()},trigger:"hover",placement:"top",children:Ae,$$slots:{default:(P,G)=>{const Y=q(()=>G.createTooltip);Fe(P,{get class(){return l()},get tagName(){return f()},get flash(){return b()},set flash(T){b(T)},get selected(){return m()},set selected(T){m(T)},$$events:{mousemove:k,click:F,mount:T=>e(Y)(T.detail.button)},children:(T,o)=>{var A=Yn(),N=Q(A),Z=X(N);K(()=>ue(Z,I(f()))),U(N);var z=V(N,2);me(z,t,"default",{get selectMode(){return e(p)},hoverClass:W}),C(T,A)},$$slots:{default:!0},$$legacy:!0})}}})},M=>{Fe(M,{get class(){return l()},get tagName(){return f()},get flash(){return b()},set flash(P){b(P)},get selected(){return m()},set selected(P){m(P)},$$events:{mousemove:k,click:F},children:(P,G)=>{var Y=Zn(),T=Q(Y),o=X(T);U(T);var A=V(T,2);me(A,t,"default",{get selectMode(){return e(p)},hoverClass:W}),K(()=>ue(o,f())),C(P,Y)},$$slots:{default:!0},$$legacy:!0})},!0),C(S,h)}),U(g),K(()=>{oe(g,"select-mode",e(p)),oe(g,"night-mode",c().isDark),oe(g,"empty",f()==="")}),C(a,g),re()}function Jn(a,t){le(t,!1);let d=w(t,"name",8),c=w(t,"class",8,""),p=w(t,"tooltip",8),f=w(t,"selected",8),l=w(t,"active",8),r=w(t,"shorten",8),m=w(t,"flash",8);const v=de();function _(){v("tagdelete")}fe(),Gn(a,{get name(){return d()},get class(){return c()},get tooltip(){return p()},get selected(){return f()},get active(){return l()},get shorten(){return r()},get flash(){return m()},$$events:{tagrange(b){B.call(this,t,b)},tagselect(b){B.call(this,t,b)},tagclick:()=>v("tagedit")},children:Ae,$$slots:{default:(b,$)=>{const s=q(()=>$.selectMode),E=q(()=>$.hoverClass);Hn(b,{get class(){return e(E)},$$events:{click:k=>{e(s)||(_(),k.stopPropagation())}}})}}}),re()}var Qn=j('<div class="tag-spacer svelte-1k3couf" role="textbox" tabindex="-1"><br></div>');function Xn(a,t){var d=Qn();D("click",d,function(c){B.call(this,t,c)}),C(a,d)}var ea=j('<div tabindex="-1" class="autocomplete-item svelte-1pjq6zk" role="button"><!></div>');function ht(a,t){le(t,!1);let d=w(t,"selected",8,!1),c=w(t,"active",8,!1),p=w(t,"suggestion",8),f=x();he(()=>(He(d()),e(f)),()=>{d()&&e(f)&&e(f).scrollIntoViewIfNeeded({behavior:"smooth",block:"start"})}),Be();var l=ea();Ze(l,m=>u(f,m),()=>e(f));var r=X(l);me(r,t,"default",{}),U(l),K(()=>{ye(l,"data-addon-suggestion",p()),oe(l,"selected",d()),oe(l,"active",c())}),D("mousedown",l,$e(function(m){B.call(this,t,m)})),D("mouseup",l,function(m){B.call(this,t,m)}),D("mouseenter",l,function(m){B.call(this,t,m)}),D("mouseleave",l,function(m){B.call(this,t,m)}),C(a,l),re()}var ta=j('<span class="autocomplete-reference svelte-1bkz961"><!></span>'),na=j('<div class="autocomplete-menu svelte-1bkz961"></div>'),aa=j('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function sa(a,t){le(t,!1);const d=Ne(),c=()=>Se(f(),"$show",d);let p=w(t,"suggestionsPromise",8),f=w(t,"show",8),l=x([]),r=x(null),m=x(!1);const v=de();function _(){e(r)===null?u(r,0):e(r)>=e(l).length-1?u(r,null):je(r)}function b(){e(r)===null?u(r,e(l).length-1):e(r)===0?u(r,null):je(r,-1)}async function $(){var h;v("select",{selected:e(l)[(h=e(r))!=null?h:-1]})}async function s(){_(),await $()}async function E(){b(),await $()}async function k(){var h;e(l).length&&(u(m,!0),v("choose",{chosen:e(l)[(h=e(r))!=null?h:-1]}),await J(),f().set(!1))}async function F(){await J(),v("update")}function I(){return e(r)!==null}function R(){return{selectPrevious:E,selectNext:s,chooseSelected:k,update:F,hasSelected:I}}function W(h){u(r,h),u(m,!0)}function g(h){W(h)}async function O(h){u(m,!1),v("select",{selected:e(l)[h]})}function S(h,L){h.buttons===1&&W(L)}he(()=>(He(p()),He(f()),ut),()=>{p().then(h=>{f().set(h.length>0),ut()&&navigator.userAgent.match(/Chrome\/77/)&&(h=h.slice(0,10)),u(l,h)})}),Be(),fe(),kt(a,{keepOnKeyup:!0,get show(){return c()},preferredPlacement:"top",$$events:{close:()=>f().set(!1)},children:Ae,$$slots:{default:(h,L)=>{const M=q(()=>L.asReference);var P=ta(),G=X(P);me(G,t,"default",{createAutocomplete:R}),U(P),Ye(P,Y=>e(M)(Y)),C(h,P)},floating:(h,L)=>{var M=aa(),P=Q(M);vt(P,()=>({"--popover-padding-inline":"0"})),$t(P.lastChild,{slot:"floating",children:(G,Y)=>{var T=na();pt(T,5,()=>e(l),Xt,(o,A,N)=>{var Z=Ue(),z=Q(Z);be(z,()=>N===e(r),ne=>{ht(ne,{selected:!0,get active(){return e(m)},get suggestion(){return e(A)},$$events:{mousedown:()=>g(N),mouseup:()=>{O(N),k()},mouseenter:ae=>S(ae,N),mouseleave:()=>u(m,!1)},children:(ae,ce)=>{_e();var ie=ke();K(()=>ue(ie,e(A))),C(ae,ie)},$$slots:{default:!0}})},ne=>{ht(ne,{get suggestion(){return e(A)},$$events:{mousedown:()=>g(N),mouseup:()=>{O(N),k()},mouseenter:ae=>S(ae,N)},children:(ae,ce)=>{_e();var ie=ke();K(()=>ue(ie,e(A))),C(ae,ie)},$$slots:{default:!0}})}),C(o,Z)}),U(T),C(G,T)},$$slots:{default:!0}}),U(P),C(h,M)}}}),re()}var oa=j("<!> <!> <!>",1),la=j('<div class="tag-relative svelte-1tsu84n"><!> <!></div>'),ra=j('<!> <div class="tag-editor svelte-1tsu84n"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <!> <!></div>',1);function Aa(a,t){le(t,!1);const d=Ne(),c=()=>Se(m(),"$tags",d),p=()=>Se(k,"$show",d),f=x(),l=x(),r=x();let m=w(t,"tags",8),v=w(t,"keyCombination",8,"Control+Shift+T");const _="Control+A",b="Control+C",$="Backspace";Jt(Ve,{selectAllShortcut:_,copyShortcut:b,removeShortcut:$});let s=x();function E(n){u(s,n.map(i=>qe(Ke(i))))}const k=wt(!1),F=de(),I=Promise.resolve([]);let R=x(I);function W(){const n=e(s).map(i=>i.name).map(We);F("tagsupdate",{tags:n}),u(R,I)}let g=x(null),O=null,S=x(""),h=x(),L=x(),M=x(!1);async function P(n){const{tags:i}=await bn({input:n,matchLimit:500});return i}const G=/^:?([^:].*?[^:]):?$/;function Y(){const i=e(s)[e(g)].name;if(u(M,i.length===0),e(M))u(R,I);else{const y=We(i),H=G.test(y)?y.replace(G,"$1"):y;u(R,P(H).then(se=>(u(M,se.length===0),se.map(Ke))))}}function T(n){const i=e(s)[e(g)];u(S,n!=null?n:i.name);const y=e(h).value.length;e(h).setSelectionRange(y,y)}async function o(n){n.name=e(S),u(s,e(s)),await J(),e(h)&&e(L).update()}function A(n){O===null&&(O=n)}function N(){ve();const n=e(s)[e(s).length-1];(!n||n.name.length>0)&&Z(e(s).length-1,"");const i=e(g)===null;u(g,null),i&&Xe()}function Z(n,i){e(s).splice(n+1,0,qe(i)),u(s,e(s)),A(n+1)}function z(n){const i=e(s).map(In);i.splice(n,1);const y=i.indexOf(e(S));return y>=0?(e(s)[y>=n?y+1:y].flash(),!1):!0}async function ne(n,i,y){const H=e(S).slice(0,i),se=e(S).slice(y);u(S,H),await J(),Z(n,se),u(g,null),await J(),n!==e(g)&&e(h).setSelectionRange(0,0)}function ae(n){z(n)&&(e(s).splice(n,0,qe(e(S))),je(g),u(s,e(s)))}function ce(n){const i=e(s).splice(n,1)[0];return u(s,e(s)),O!==null&&O>n&&(O-=1),i}function ie(n){return n===0}function Qe(n){return n===e(s).length-1}function Nt(n){if(ie(n))return;const i=ce(n-1);u(S,i.name+e(S)),je(g,-1),o(e(s)[e(g)])}function Pt(n){if(Qe(n))return;const i=ce(n+1);u(S,e(S)+i.name),o(e(s)[e(g)])}function Dt(n){ie(n)||(O=n-1,u(g,null),e(h).blur())}async function xt(n){if(Qe(n)){e(S).length!==0&&(Z(n,""),u(g,null));return}O=n+1,u(g,null),e(h).blur(),await J(),e(h).setSelectionRange(0,0)}function Et(n,i){e(s).includes(n)&&(z(i)||ce(i))}function Xe(){u(g,O),O=null}function It(n){if(pn(n)){e(L).selectPrevious(),n.preventDefault();return}else if(_n(n)){e(L).selectNext(),n.preventDefault();return}switch(n.code){case"Tab":if(p())n.shiftKey?e(L).selectPrevious():e(L).selectNext();else break;n.preventDefault();break;case"Enter":e(L).chooseSelected(),n.preventDefault();break}}let Te=null,Pe=null;function et(n){it(s,e(s)[n].selected=!e(s)[n].selected),u(s,e(s)),Te=n}function Rt(n){if(Te===null){et(n);return}Pe=n;const i=Math.min(Te,Pe),y=Math.max(Te,Pe);for(let H=i;H<=y;(H+=1)-1)it(s,e(s)[H].selected=!0);u(s,e(s))}function ve(){u(s,e(s).map(n=>({...n,selected:!1}))),Te=null,Pe=null}function Wt(n){const i=n.currentTarget;(n.relatedTarget===null||!i.contains(n.relatedTarget))&&ve()}function jt(n){const i=document.createElement("textarea");i.value=n,i.setAttribute("readonly",""),i.style.position="absolute",i.style.left="-9999px",document.body.appendChild(i),i.select(),Cn("copy"),document.body.removeChild(i)}function Le(){for(const n of e(s))n.selected=!0;u(s,e(s))}function tt(){const n=e(s).filter(i=>i.selected).map(i=>We(i.name)).join(`
`);jt(n),ve()}function nt(){e(s).map((n,i)=>[n.selected,i]).filter(([n])=>n).reverse().forEach(([,n])=>ce(n)),ve(),W()}let Oe=x(),De=x();he(()=>c(),()=>{E(c())}),he(()=>(e(Oe),e(De)),()=>{u(f,Math.floor(e(Oe)/e(De)))}),he(()=>(e(l),e(f)),()=>{u(l,e(l)||e(f)>2)}),he(()=>e(s),()=>{u(r,e(s).some(n=>n.selected))}),Be(),fe();var at=ra(),st=Q(at);be(st,()=>e(r),n=>{var i=oa(),y=Q(i);Ie(y,{keyCombination:_,$$events:{action:Le}});var H=V(y,2);Ie(H,{keyCombination:b,$$events:{action:tt}});var se=V(H,2);Ie(se,{keyCombination:$,$$events:{action:nt}}),C(n,i)});var xe=V(st,2),Ee=X(xe);vt(Ee,()=>({"--icon-align":"baseline"})),Fn(Ee.lastChild,{get badgeHeight(){return e(De)},set badgeHeight(n){u(De,n)},get tagsSelected(){return e(r)},get keyCombination(){return v()},$$events:{tagselectall:Le,tagcopy:tt,tagdelete:nt,tagappend:N},$$legacy:!0}),U(Ee);var ot=V(Ee,2);pt(ot,3,()=>e(s),n=>n.id,(n,i,y)=>{var H=la(),se=X(H),Bt=q(()=>e(y)===e(g)?e(S):e(i).name),Lt=q(()=>e(y)===e(g));Jn(se,{class:"ms-0",get name(){return e(Bt)},get tooltip(){return e(i).name},get active(){return e(Lt)},get shorten(){return e(l)},get flash(){return e(i).flash},set flash(we){e(i).flash=we,ct(()=>e(s))},get selected(){return e(i).selected},set selected(we){e(i).selected=we,ct(()=>e(s))},$$events:{tagedit:()=>{u(g,e(y)),ve()},tagselect:()=>et(e(y)),tagrange:()=>Rt(e(y)),tagdelete:()=>{ve(),ce(e(y)),W()}},$$legacy:!0});var Ot=V(se,2);be(Ot,()=>e(y)===e(g),we=>{sa(we,{get suggestionsPromise(){return e(R)},show:k,$$events:{update:Y,select:({detail:ge})=>T(ge.selected),choose:({detail:ge})=>{T(ge.chosen),ne(e(y),ge.chosen.length,ge.chosen.length)}},children:Ae,$$slots:{default:(ge,zt)=>{const qt=q(()=>zt.createAutocomplete);Wn(ge,{get id(){return e(i).id},class:"position-absolute start-0 top-0 bottom-0 ps-2 py-0",get disabled(){return e(M)},get name(){return e(S)},set name(pe){u(S,pe)},get input(){return e(h)},set input(pe){u(h,pe)},$$events:{focus:()=>{F("tagsFocused"),u(S,e(i).name),u(L,e(qt)())},keydown:It,keyup:()=>{e(S).length===0&&(k==null||k.set(!1))},taginput:()=>o(e(i)),tagsplit:({detail:pe})=>ne(e(y),pe.start,pe.end),tagadd:()=>ae(e(y)),tagdelete:()=>ce(e(y)),tagselectall:async()=>{e(s).length<=1||(e(h).blur(),await J(),Le())},tagjoinprevious:()=>Nt(e(y)),tagjoinnext:()=>Pt(e(y)),tagmoveprevious:()=>Dt(e(y)),tagmovenext:()=>xt(e(y)),tagaccept:()=>{Et(e(i),e(y)),e(i)&&o(e(i)),W(),Xe()}},$$legacy:!0})}}})}),U(H),K(()=>oe(H,"hide-tag",e(y)===e(g))),C(n,H)});var Mt=V(ot,2);return Xn(Mt,{$$events:{click:N}}),U(xe),D("focusout",xe,Wt),St(xe,"offsetHeight",n=>u(Oe,n)),C(a,at),bt(t,"appendEmptyTag",N),re({appendEmptyTag:N})}export{Aa as T,Ca as d,Cn as e};
